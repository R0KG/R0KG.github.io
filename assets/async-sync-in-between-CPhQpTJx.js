import{_ as as}from"./WrapperPost.vue_vue_type_script_setup_true_lang-h66aYrYB.js";import{_ as ls}from"./GitHubLink.vue_vue_type_script_setup_true_lang-BHBYo4gN.js";import{e as q,j as A,g as v,o as x,k as B,a as s,m as is,F as I,D as L,n as F,t as V,r as K,c as G,P as rs,f as os,I as ps,b as t,w as ss,u as ds,d as S}from"./app-BJ_3SEP9.js";import"./logo-github-CITidJVY.js";function X(y){return function(){return y}}const W=Math.PI,j=2*W,T=1e-6,hs=j-T;function ts(y){this._+=y[0];for(let e=1,a=y.length;e<a;++e)this._+=arguments[e]+y[e]}function gs(y){let e=Math.floor(y);if(!(e>=0))throw new Error(`invalid digits: ${y}`);if(e>15)return ts;const a=10**e;return function(l){this._+=l[0];for(let n=1,d=l.length;n<d;++n)this._+=Math.round(arguments[n]*a)/a+l[n]}}class cs{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?ts:gs(e)}moveTo(e,a){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,a){this._append`L${this._x1=+e},${this._y1=+a}`}quadraticCurveTo(e,a,l,n){this._append`Q${+e},${+a},${this._x1=+l},${this._y1=+n}`}bezierCurveTo(e,a,l,n,d,h){this._append`C${+e},${+a},${+l},${+n},${this._x1=+d},${this._y1=+h}`}arcTo(e,a,l,n,d){if(e=+e,a=+a,l=+l,n=+n,d=+d,d<0)throw new Error(`negative radius: ${d}`);let h=this._x1,k=this._y1,m=l-e,c=n-a,p=h-e,u=k-a,b=p*p+u*u;if(this._x1===null)this._append`M${this._x1=e},${this._y1=a}`;else if(b>T)if(!(Math.abs(u*m-c*p)>T)||!d)this._append`L${this._x1=e},${this._y1=a}`;else{let C=l-h,_=n-k,$=m*m+c*c,E=C*C+_*_,o=Math.sqrt($),D=Math.sqrt(b),i=d*Math.tan((W-Math.acos(($+b-E)/(2*o*D)))/2),g=i/D,r=i/o;Math.abs(g-1)>T&&this._append`L${e+g*p},${a+g*u}`,this._append`A${d},${d},0,0,${+(u*C>p*_)},${this._x1=e+r*m},${this._y1=a+r*c}`}}arc(e,a,l,n,d,h){if(e=+e,a=+a,l=+l,h=!!h,l<0)throw new Error(`negative radius: ${l}`);let k=l*Math.cos(n),m=l*Math.sin(n),c=e+k,p=a+m,u=1^h,b=h?n-d:d-n;this._x1===null?this._append`M${c},${p}`:(Math.abs(this._x1-c)>T||Math.abs(this._y1-p)>T)&&this._append`L${c},${p}`,l&&(b<0&&(b=b%j+j),b>hs?this._append`A${l},${l},0,1,${u},${e-k},${a-m}A${l},${l},0,1,${u},${this._x1=c},${this._y1=p}`:b>T&&this._append`A${l},${l},0,${+(b>=W)},${u},${this._x1=e+l*Math.cos(d)},${this._y1=a+l*Math.sin(d)}`)}rect(e,a,l,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+a}h${l=+l}v${+n}h${-l}Z`}toString(){return this._}}function ys(y){let e=3;return y.digits=function(a){if(!arguments.length)return e;if(a==null)e=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);e=l}return y},()=>new cs(e)}var us=Array.prototype.slice;function ks(y){return y[0]}function ms(y){return y[1]}class fs{constructor(e,a){this._context=e,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,a){switch(e=+e,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,a):this._context.moveTo(e,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,a,e,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,e,this._y0,e,a);break}}this._x0=e,this._y0=a}}function As(y){return new fs(y,!1)}function Ds(y){return y.source}function Bs(y){return y.target}function bs(y){let e=Ds,a=Bs,l=ks,n=ms,d=null,h=null,k=ys(m);function m(){let c;const p=us.call(arguments),u=e.apply(this,p),b=a.apply(this,p);if(d==null&&(h=y(c=k())),h.lineStart(),p[0]=u,h.point(+l.apply(this,p),+n.apply(this,p)),p[0]=b,h.point(+l.apply(this,p),+n.apply(this,p)),h.lineEnd(),c)return h=null,c+""||null}return m.source=function(c){return arguments.length?(e=c,m):e},m.target=function(c){return arguments.length?(a=c,m):a},m.x=function(c){return arguments.length?(l=typeof c=="function"?c:X(+c),m):l},m.y=function(c){return arguments.length?(n=typeof c=="function"?c:X(+c),m):n},m.context=function(c){return arguments.length?(c==null?d=h=null:h=y(d=c),m):d},m}function Y(){return bs(As)}const xs={flex:"~ justify-center"},ws=["viewBox"],vs=["id"],_s=["d"],Fs=["onPointerenter","onPointerleave","onPointermove","onPointerout"],Cs=["x","y","width"],Es=["x","y"],$s=["x1","y1","x2","y2","marker-end"],Z=30,N=15,z=10,O=q({__name:"QuansyncGraphCore",props:{nodes:{},arrows:{default:()=>[]},width:{},height:{},marginX:{default:20},marginY:{default:20},linkAnchor:{default:"left"}},setup(y){const e=y,a={red:"stroke-current text-rose:50",blue:"stroke-current text-blue:50",purple:"stroke-current text-purple:50",none:"stroke-current text-#ddd dark:text-#444"},l={red:"stroke-current text-rose",blue:"stroke-current text-blue",purple:"stroke-current text-purple",none:"stroke-current text-#ddd dark:text-#444"},n={red:"fill-#fae3e6 dark:fill-#472127",blue:"fill-#e0f2fe dark:fill-#192a59",purple:"fill-#f5f3ff dark:fill-#271347",none:"fill-#f8f8f8 dark:fill-#222"},d={red:"fill-rose",blue:"fill-blue",purple:"fill-purple",none:"fill-#222 dark:fill-#eee"},h=A(()=>[...e.nodes.map(o=>o.x),...e.arrows.flatMap(o=>[o.from.x,o.to.x])]),k=A(()=>[...e.nodes.map(o=>o.y),...e.arrows.flatMap(o=>[o.from.y,o.to.y])]),m=A(()=>e.marginX-Math.min(...h.value)),c=A(()=>e.marginY-Math.min(...k.value)),p=A(()=>Math.max(...h.value)+e.marginX*2),u=A(()=>Math.max(...k.value)+e.marginY*2),b=A(()=>e.nodes.map(o=>({...o,x:o.x+m.value,y:o.y+c.value}))),C=A(()=>e.arrows.map(o=>({...o,from:{x:o.from.x+m.value,y:o.from.y+c.value},to:{x:o.to.x+m.value,y:o.to.y+c.value}})));function _(o){return o.x+o.name.length*z/2+N}const $=A(()=>b.value.filter(o=>o.to).flatMap(o=>o.to?.map(D=>{const i=b.value.find(r=>r.id===D);let g=i.color||o.color||"none";return(i.color==="none"||o.color==="none")&&(g="none"),{id:`${o.id}-${i.id}`,source:o,target:i,color:g}})||[]));function E(o){return e.linkAnchor==="center"?Y().source(D=>[_(D.source),D.source.y]).target(D=>[_(D.target),D.target.y])(o):Y().source(D=>[D.source.x+3,D.source.y]).target(D=>[D.target.x+3,D.target.y])(o)}return(o,D)=>(x(),v("div",xs,[(x(),v("svg",{xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid meet",viewBox:`0 0 ${o.width??B(p)} ${o.height??B(u)}`,"select-none":"","w-full":""},[s("defs",null,[(x(!0),v(I,null,L(Object.entries(l),([i,g])=>(x(),v("marker",{id:`arrow-${i}`,key:i,viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",fill:"currentColor",class:F(g)},D[0]||(D[0]=[s("path",{d:"M 0 0 L 10 5 L 0 10 z"},null,-1)]),10,vs))),128))]),s("g",null,[(x(!0),v(I,null,L(B($),i=>(x(),v("path",{key:i.id,d:E(i),class:F(["transition-all duration-600",a[i.color||"none"]]),fill:"none"},null,10,_s))),128))]),s("g",null,[(x(!0),v(I,null,L(B(b),i=>(x(),v("g",{key:i.id,onPointerenter:i.hover,onPointerleave:i.blur,onPointermove:i.hover,onPointerout:i.blur},[s("rect",{x:i.x,y:i.y-Z/2,width:i.name.length*z+N*2,height:Z,class:F(["transition-all duration-600",[n[i.color||"none"],a[i.color||"none"]]]),rx:"8",ry:"8"},null,10,Cs),s("text",{x:i.x+i.name.length*z/2+N,y:i.y,"font-family":"monospace","text-anchor":"middle","font-size":"4",class:F(["transition-all duration-600",d[i.color||"none"]]),transform:"translate(0, 5)"},V(i.name),11,Es)],40,Fs))),128))]),s("g",null,[(x(!0),v(I,null,L(B(C),(i,g)=>(x(),v("g",{key:g},[s("line",{x1:i.from.x,y1:i.from.y,x2:i.to.x,y2:i.to.y,"stroke-width":"2",class:F(["transition-all duration-600",l[i.color||"none"]]),"marker-end":`url(#arrow-${i.color||"none"})`},null,10,$s)]))),128))]),is(o.$slots,"default")],8,ws))]))}}),Ss=q({__name:"QuansyncGraph4",setup(y){const e=K(null),a=A(()=>e.value==null?"purple":e.value==="sync"?"blue":"red"),l=A(()=>e.value==="sync"?"none":"red"),n=A(()=>e.value==="async"?"none":"blue"),d=A(()=>[{id:"a0",name:"[async consumers]",color:l.value,x:120,y:-60,to:["q1"],hover:()=>e.value="async",blur:()=>e.value=null},{id:"s0",name:"[sync consumers]",color:n.value,x:350,y:-60,to:["q1"],hover:()=>e.value="sync",blur:()=>e.value=null},{id:"q1",name:"*readNearestPkg()",color:a.value,x:230,y:40,to:["q2"]},{id:"q2",name:"*findUp()",color:a.value,x:270,y:100,to:["q3"]},{id:"q3",name:"*locatePath()",color:a.value,x:250,y:160,to:["q4"]},{id:"q4",name:"*stat()",color:a.value,x:280,y:220,to:["a5","s5"]},{id:"a5",name:"fs.stat()",color:l.value,x:360,y:320,hover:()=>e.value="async",blur:()=>e.value=null},{id:"s5",name:"fs.statSync()",color:n.value,x:160,y:320,hover:()=>e.value="sync",blur:()=>e.value=null}]),h=A(()=>[]);return(k,m)=>{const c=O;return x(),G(c,{nodes:B(d),arrows:B(h),width:600,height:450,"margin-x":80,"link-anchor":"center"},null,8,["nodes","arrows"])}}}),Ts={py10:"",flex:"~ items-center justify-center col md:row md:justify-between","text-center":""},qs={flex:"~","select-none":"","my--4":""},Ms=["width","height"],Ps={op75:""},Q=1,f=250,Is=q({__name:"AsyncSyncQuantum",setup(y){const e=rs("canvas"),a=f/2,l=f/2,n=f*.4,d=[],h=[],k=K(null);function m(){k.value||(k.value=Math.random()<.5?"red":"blue")}function c(){k.value=null}return os(()=>{const p=e.value.getContext("2d",{willReadFrequently:!0});p.scale(Q,Q),p.font="50px sans-serif",p.textAlign="center",p.textBaseline="middle",p.fillStyle="#f43f5e",p.clearRect(0,0,f,f),p.fillText("async",f/2,f/2);const u=p.getImageData(0,0,f,f,{colorSpace:"srgb"});p.clearRect(0,0,f,f),p.fillStyle="#0ea5e9",p.fillText("sync",f/2,f/2);const b=p.getImageData(0,0,f,f,{colorSpace:"srgb"});p.clearRect(0,0,f,f);function C(i){const g=[];for(let r=0;r<f;r++)for(let w=0;w<f;w++){const H=i.data[(r*f+w)*4+0],ns=i.data[(r*f+w)*4+1],es=i.data[(r*f+w)*4+2],R=i.data[(r*f+w)*4+3];if(R>0){const J=Math.random()*Math.PI*2,U=Math.random()*n;g.push({color:`rgb(${H}, ${ns}, ${es})`,alpha:R/255,original:{x:w,y:r,alpha:R/255},x:U*Math.cos(J)+a,y:U*Math.sin(J)+l,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,va:0})}}return g}d.push(...C(u)),h.push(...C(b));function _(i){for(const g of i)p.fillStyle=g.color,p.globalAlpha=g.alpha,p.fillRect(g.x,g.y,1,1);p.restore()}function $(i,g){for(const r of i)r.vx+=(Math.random()-.5)*.5,r.vy+=(Math.random()-.5)*.5,Math.sqrt((r.x-a)**2+(r.y-l)**2)>n&&(r.vx+=(a-r.x)*.02,r.vy+=(l-r.y)*.02),Math.abs(r.vx)>2&&(r.vx*=.9),Math.abs(r.vy)>2&&(r.vy*=.9),r.x+=r.vx*g,r.y+=r.vy*g}function E(i,g){for(const r of i){const w=r.original.x-r.x,H=r.original.y-r.y;r.vx=w*.1,r.vy=H*.1,r.x+=r.vx*g,r.y+=r.vy*g}}function o(i,g){for(const r of i){const w=r.original.alpha-r.alpha;r.va=Math.min(.02,w*.1),r.alpha+=r.va*g}}function D(i,g){for(const r of i){const w=0-r.alpha;r.va=w*.1,r.alpha+=r.va*g}}ps(({delta:i})=>{const g=i/30;p.clearRect(0,0,f,f),k.value==="red"?(E(d,g),E(h,g),o(d,g),D(h,g)):k.value==="blue"?(E(h,g),E(d,g),o(h,g),D(d,g)):($(d,g),$(h,g),o(d,g),o(h,g)),k.value==="red"?(_(h),_(d)):(_(d),_(h))})}),(p,u)=>(x(),v("div",Ts,[s("div",null,[u[1]||(u[1]=s("b",null,"Quan",-1)),u[2]||(u[2]=s("span",{op75:""},"tum",-1)),u[3]||(u[3]=t(" + ")),s("b",null,[s("span",{class:F(B(k)==="red"?"":"op0"),transition:"","duration-1000":""},"a",2),u[0]||(u[0]=t("Sync"))])]),s("div",qs,[s("canvas",{ref_key:"canvas",ref:e,ma:"","transition-all":"","duration-300":"",width:f*Q,height:f*Q,class:F(B(k)?"":"blur-1px"),onPointerenter:m,onPointerover:m,onPointerout:c,onPointerleave:c},null,42,Ms)]),s("div",Ps,[s("em",{"transition-all":"","duration-1000":"",class:F(B(k)==="red"?"text-rose!":B(k)?"text-sky!":"text-purple!")},'"Superposition"',2),u[4]||(u[4]=s("br",null,null,-1)),u[5]||(u[5]=t("between ")),s("code",{"important-text-sky":"","transition-all":"","duration-1000":"",class:F(B(k)==="red"?"saturate-0":"")},"sync",2),u[6]||(u[6]=t(" and ")),s("code",{"important-text-rose":"","transition-all":"","duration-1000":"",class:F(B(k)==="blue"?"saturate-0":"")},"async",2)])]))}}),Ls=["y"],Gs=["y"],Qs=q({__name:"QuansyncGraph3",setup(y){const e=A(()=>[{id:"a0",name:"[async consumers]",color:"red",x:120,y:-60,to:["a1"]},{id:"a1",name:"readNearestPkg()",color:"red",x:130,y:20,to:["a2"]},{id:"a2",name:"findUp()",color:"red",x:140,y:100,to:["a3"]},{id:"a3",name:"locatePath()",color:"red",x:150,y:180,to:["a4"]},{id:"a4",name:"fs.stat()",color:"red",x:160,y:260},{id:"s0",name:"[sync consumers]",color:"blue",x:350,y:-60,to:["s1"]},{id:"s1",name:"readNearestPkgSync()",color:"blue",x:360,y:20,to:["s2"]},{id:"s2",name:"findUpSync()",color:"blue",x:370,y:100,to:["s3"]},{id:"s3",name:"locatePathSync()",color:"blue",x:380,y:180,to:["s4"]},{id:"s4",name:"fs.statSync()",color:"blue",x:390,y:260}]),a=A(()=>[]),l=A(()=>[{name:"my-pkg",y:100},{name:"find-up",y:180},{name:"locate-path",y:260}]);return(n,d)=>{const h=O;return x(),G(h,{nodes:B(e),arrows:B(a),width:580,height:400,"margin-y":50,"margin-x":70},{default:ss(()=>[(x(!0),v(I,null,L(B(l),k=>(x(),v("g",{key:k.name},[s("text",{x:"10",y:k.y+5,"font-family":"monospace","font-size":"4",class:"fill-purple"},V(k.name),9,Ls),s("rect",{x:"0",y:k.y,width:"560",height:"60",rx:"10",ry:"10","stroke-dasharray":"4 2",class:"fill-none stroke-purple:50"},null,8,Gs)]))),128))]),_:1},8,["nodes","arrows"])}}}),M=300,Os=q({__name:"QuansyncGraph2",setup(y){const e=A(()=>[{id:"1",name:"await build()",color:"red",x:0,y:0,to:["2"]},{id:"2",name:"await transform()",color:"red",x:10,y:50,to:["3"]},{id:"3",name:"await parse()",color:"red",x:20,y:100,to:["4"]},{id:"4",name:"await loadFile()",color:"red",x:30,y:150,to:["5"]},{id:"5",name:"replace()",color:"none",x:40,y:200}]),a=A(()=>[{from:{x:250,y:80},to:{x:195,y:95},color:"blue"}]),l=A(()=>[{id:"a1",name:"await build()",color:"red",x:M+0,y:0,to:["a2"]},{id:"a2",name:"await transform()",color:"red",x:M+10,y:50,to:["a3"]},{id:"a3",name:"parseSync()",color:"blue",x:M+20,y:100,to:["a4"]},{id:"a4",name:"loadFileSync()",color:"blue",x:M+30,y:150,to:["a5"]},{id:"a5",name:"replace()",color:"blue",x:M+40,y:200}]);return(n,d)=>{const h=O;return x(),G(h,{nodes:[...B(e),...B(l)],arrows:B(a),width:600},null,8,["nodes","arrows"])}}}),P=300,Hs=q({__name:"QuansyncGraph1",setup(y){const e=A(()=>[{id:"1",name:"build()",color:"none",x:0,y:0,to:["2"]},{id:"2",name:"transform()",color:"none",x:10,y:50,to:["3"]},{id:"3",name:"parse()",color:"none",x:20,y:100,to:["4"]},{id:"4",name:"loadFile()",color:"none",x:30,y:150,to:["5"]},{id:"5",name:"replace()",color:"none",x:40,y:200}]),a=A(()=>[{from:{x:230,y:120},to:{x:180,y:140},color:"red"}]),l=A(()=>[{id:"b1",name:"await build()",color:"red",x:P+0,y:0,to:["b2"]},{id:"b2",name:"await transform()",color:"red",x:P+10,y:50,to:["b3"]},{id:"b3",name:"await parse()",color:"red",x:P+20,y:100,to:["b4"]},{id:"b4",name:"await loadFile()",color:"red",x:P+30,y:150,to:["b5"]},{id:"b5",name:"replace()",color:"none",x:P+40,y:200}]);return(n,d)=>{const h=O;return x(),G(h,{nodes:[...B(e),...B(l)],arrows:B(a),width:600},null,8,["nodes","arrows"])}}}),Rs={class:"prose m-auto slide-enter-content"},Js={__name:"async-sync-in-between",setup(y){const e={title:"Async, Sync, in Between",date:"2025-03-03T00:00:00.000Z",lang:"en",description:"The coloring problem in modern programming, and a proposal of a new approach",duration:"18min",image:"https://romanmerk.me/og/async-sync-in-between.png",meta:[{property:"og:title",content:"Async, Sync, in Between"},{name:"twitter:title",content:"Async, Sync, in Between"},{name:"description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{property:"og:description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{name:"twitter:description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{property:"og:image",content:"https://romanmerk.me/og/async-sync-in-between.png"},{name:"twitter:image",content:"https://romanmerk.me/og/async-sync-in-between.png"},{name:"twitter:card",content:"summary_large_image"}]};return ds({title:"Async, Sync, in Between",meta:[{property:"og:title",content:"Async, Sync, in Between"},{name:"twitter:title",content:"Async, Sync, in Between"},{name:"description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{property:"og:description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{name:"twitter:description",content:"The coloring problem in modern programming, and a proposal of a new approach"},{property:"og:image",content:"https://romanmerk.me/og/async-sync-in-between.png"},{name:"twitter:image",content:"https://romanmerk.me/og/async-sync-in-between.png"},{name:"twitter:card",content:"summary_large_image"}]}),(l,n)=>{const d=Hs,h=Os,k=Qs,m=Is,c=Ss,p=ls,u=as;return x(),G(u,{frontmatter:e},{default:ss(()=>[s("div",Rs,[n[4]||(n[4]=s("h2",{id:"the-coloring-problem",tabindex:"-1"},[t("The Coloring Problem "),s("a",{class:"header-anchor",href:"#the-coloring-problem","aria-hidden":"true"},"#")],-1)),n[5]||(n[5]=s("p",null,[t("In modern programming, the function coloring problem isn’t new. Based on how functions execute: "),s("code",{"important-text-blue":""},"synchronous"),t(" (blocking) and "),s("code",{"important-text-rose":""},"asynchronous"),t(' (non-blocking), we often classify them into two "colors" for better distinction. The problem arises because you generally cannot mix and match these colors freely.')],-1)),n[6]||(n[6]=s("p",null,"For instance, in JavaScript:",-1)),n[7]||(n[7]=s("ul",null,[s("li",null,[t("An "),s("span",{"text-rose":""},"async"),t(" function can call both "),s("span",{"text-blue":""},"sync"),t(" and other "),s("span",{"text-rose":""},"async"),t(" functions.")]),s("li",null,[t("A "),s("span",{"text-blue":""},"sync"),t(" function, however, cannot directly call an "),s("span",{"text-rose":""},"async"),t(" function without changing its own color to async.")])],-1)),n[8]||(n[8]=s("p",null,'This restriction forces developers to propagate the "color" throughout their codebase. If a function deep in your logic needs to become async, it forces every caller up the chain to also become async, leading to a cascading effect (or "async inflection"). This makes refactoring harder, increases complexity, and sometimes leads to awkward workarounds like blocking async calls with await inside sync contexts, or vice versa.',-1)),s("figure",null,[S(d),n[0]||(n[0]=s("figcaption",{"text-center":""}," If `loadFile()` needs to be async, then all its callers upstream need to change to async too. ",-1))]),n[9]||(n[9]=s("p",null,"We often discuss the async inflection problem, where a common solution is to make everything async since async functions can call both sync and async functions, while the reverse is not true. However, the coloring problem actually goes both ways, which seems to be less frequently discussed:",-1)),n[10]||(n[10]=s("p",null,[t("While an async function requires all the "),s("strong",null,"callers"),t(" to be async, a sync function also requires all the "),s("strong",null,"dependencies"),t(" to be sync.")],-1)),s("figure",null,[S(h),n[1]||(n[1]=s("figcaption",{"text-center":""}," If `parse()` needs to be sync, then all its dependencies down the road need to be sync too. ",-1))]),n[11]||(n[11]=s("p",null,[t('At its core, it’s the same problem with different perspectives. It depends on which part of the code you’re focusing on and how difficult it is to change its "color." If the function you’re working on '),s("strong",null,"must be async"),t(", the burden shifts to the callers. Conversely, if it "),s("strong",null,"must be sync"),t(", you’ll need all your dependencies to be sync or provide a synchronous entry point.")],-1)),n[12]||(n[12]=s("h3",{id:"libraries-in-practice",tabindex:"-1"},[t("Libraries in Practice "),s("a",{class:"header-anchor",href:"#libraries-in-practice","aria-hidden":"true"},"#")],-1)),n[13]||(n[13]=s("p",null,[t("For example, the widely used library "),s("a",{href:"https://github.com/sindresorhus/find-up",target:"_blank",rel:"noopener"},[s("code",null,"find-up")]),t(" provides two main APIs, "),s("code",{"important-text-rose":""},"findUp"),t(" and "),s("code",{"important-text-blue":""},"findUpSync"),t(", to avoid dependents being trapped by the coloring problem. If you look into the code, you’ll find that the package essentially "),s("a",{href:"https://github.com/sindresorhus/find-up/blob/b733bb70d3aa21b22fa011be8089110d467c317f/index.js#L51",target:"_blank",rel:"noopener"},"duplicates the logic twice"),t(" to provide the two APIs. Going down, you see its dependency "),s("a",{href:"https://github.com/sindresorhus/locate-path",target:"_blank",rel:"noopener"},[s("code",null,"locate-path")]),t(" also "),s("a",{href:"https://github.com/sindresorhus/locate-path/blob/355a681456d79a8506de11120d56b6e34a0389b5/index.js#L49",target:"_blank",rel:"noopener"},[t("duplicates the "),s("code",{"important-text-rose":""},"locatePath"),t(" and "),s("code",{"important-text-blue":""},"locatePathSync"),t(" logic")]),t(".")],-1)),n[14]||(n[14]=s("p",null,[t("Say you want to build another library that uses "),s("code",null,"findUp"),t(", like "),s("code",null,"readNearestPkg"),t(", you would also have to write the logic twice, using "),s("code",{"important-text-rose":""},"findUp"),t(" and "),s("code",{"important-text-blue":""},"findUpSync"),t(" separately, to support both async and sync usage.")],-1)),n[15]||(n[15]=s("p",null,[t('In these cases, even if our main logic does not come with its own "colors," the whole dependency pipeline is forced to branch into two colors due to an optional async operation down the road (e.g., '),s("code",{"important-text-rose":""},"fs.promises.stat"),t(" and "),s("code",{"important-text-blue":""},"fs.statSync"),t(").")],-1)),s("figure",null,[S(k),n[2]||(n[2]=s("figcaption",{"text-center":""}," Basically, we would maintain two branches of code to support both sync and async, with only a few sync utils that can be shared. ",-1))]),n[16]||(n[16]=s("h3",{id:"async-plugins",tabindex:"-1"},[t("Async Plugins "),s("a",{class:"header-anchor",href:"#async-plugins","aria-hidden":"true"},"#")],-1)),n[17]||(n[17]=s("p",null,"Another case demonstrating the coloring problem is a plugin system with async hooks. For example, imagine we are building a Markdown-to-HTML compiler with plugin support. Say the parser and compiler logic are synchronous; we could expose a sync API like:",-1)),n[18]||(n[18]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," markdownToHtml"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," parse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // ...")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," render"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),n[19]||(n[19]=s("p",null,"To make our library extensible, we might allow plugins to register hooks at multiple stages thoughout the process, for example:",-1)),n[20]||(n[20]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light has-highlighted",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," interface"),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}}," Plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  preprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  transform"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"AST"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"AST")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  postprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," markdownToHtml"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"preprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," parse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"transform"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," render"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"postprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," html")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),n[21]||(n[21]=s("p",null,[t("Great, now we have a plugin system. However, having "),s("code",null,"markdownToHtml"),t(" as a synchronous function essentially limits all plugin hooks to be synchronous as well. This limitation can be quite restrictive. For instance, consider a plugin for syntax highlighting. In many cases, the best results for syntax highlighting might require asynchronous operations, such as fetching additional resources or performing complex computations that are better suited for non-blocking execution.")],-1)),n[22]||(n[22]=s("p",null,[t("To accommodate such scenarios, we need to allow "),s("span",{"text-rose":""},"async hooks"),t(" in our plugin system. This means that our main function, "),s("code",null,"markdownToHtml"),t(", as the caller of the plugin hooks must also be async. We could implement it like this:")],-1)),n[23]||(n[23]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light has-highlighted",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," interface"),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}}," Plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  preprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," | "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"},class:"highlighted-word"},"Promise"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"<"),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},">")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  transform"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"AST"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"AST"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," | "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"},class:"highlighted-word"},"Promise"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"<"),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"AST"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},">")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  postprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},") => "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," | "),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"},class:"highlighted-word"},"Promise"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"<"),s("span",{style:{"--s-dark":"#5DA994","--s-light":"#2E8F82"}},"string"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},">")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," "),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"},class:"highlighted-word"},"async"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," function"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," markdownToHtml"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"},class:"highlighted-word"},"await"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"preprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," parse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"markdown"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"},class:"highlighted-word"},"await"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"transform"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  let "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," render"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"ast"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  for"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"plugin"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugins"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line highlighted"},[s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"},class:"highlighted-word"},"await"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," plugin"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"postprocess"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"html"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," html")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),n[24]||(n[24]=s("p",null,[t("While this maximized the flexibility of the plugin system, this approach also "),s("strong",null,"forces"),t(" all users to handle the process "),s("span",{"text-rose":""},"asynchronously"),t(', even in the cases where all plugins are synchronous. This is the cost of accommodating the possibility that some operations "'),s("b",{"important-text-purple":""},"might be asynchronous"),t('". To manage this, we often end up duplicating the logic to offer both sync and async APIs, and restrict async plugins to the async version only.')],-1)),n[25]||(n[25]=s("p",null,"Such duplications lead to increased maintenance efforts, potential inconsistencies, and larger bundle sizes, which are not ideal for maintainers or users.",-1)),n[26]||(n[26]=s("p",null,"Is there a better way to handle this?",-1)),n[27]||(n[27]=s("h2",{id:"introducing-quansync",tabindex:"-1"},[t("Introducing Quansync "),s("a",{class:"header-anchor",href:"#introducing-quansync","aria-hidden":"true"},"#")],-1)),n[28]||(n[28]=s("p",null,"What if we could make our logic decoupled from the coloring problem and let the caller decide the color?",-1)),n[29]||(n[29]=s("p",null,[t("Trying to make the situation a bit better, "),s("a",{href:"https://github.com/sxzz",class:"markdown-magic-link markdown-magic-link-github-at",target:"_blank",rel:"noopener"},[s("span",{class:"markdown-magic-link-image",style:{"background-image":"url('https://github.com/sxzz.png')"}}),t("SXZZ")]),t(" and I took inspiration from "),s("a",{href:"https://github.com/loganfsmyth/gensync",target:"_blank",rel:"noopener"},[s("code",null,"gensync")]),t(" by "),s("a",{href:"https://github.com/loganfsmyth",class:"markdown-magic-link markdown-magic-link-github-at",target:"_blank",rel:"noopener"},[s("span",{class:"markdown-magic-link-image",style:{"background-image":"url('https://github.com/loganfsmyth.png')"}}),t("LOGANFSMYTH")]),t(" and made a package called "),s("a",{href:"https://github.com/antfu-collective/quansync",target:"_blank",rel:"noopener"},[s("code",{"important-text-purple":""},"quansync")]),t(". Taking it even further, we are dreaming of leveraging this to create a paradigm shift in the way we write libraries in the JavaScript ecosystem.")],-1)),n[30]||(n[30]=s("p",null,[t("The name "),s("code",{"important-text-purple":""},"Quansync"),t(" is borrowed from "),s("a",{href:"https://en.wikipedia.org/wiki/Quantum_mechanics",target:"_blank",rel:"noopener"},"Quantum Mechanics"),t(", where particles can exist in multiple states simultaneously, known as "),s("em",null,"superposition"),t(", and only settle into a single state when observed "),s("span",{op50:""},"(try hovering over the atom below)"),t(".")],-1)),S(m),n[31]||(n[31]=s("p",null,[t("You can think of "),s("code",{"important-text-purple":""},"quansync"),t(" as a new type of function that can be used as both "),s("code",{"important-text-blue":""},"sync"),t(" and "),s("code",{"important-text-rose":""},"async"),t(" depending on the context. In many cases, our logic can escape the async inflection problem, especially when designing shared logic with optional async hooks.")],-1)),s("figure",null,[S(c),n[3]||(n[3]=s("figcaption",{"text-center":""},[t(" Try hovering over either the async or sync side."),s("br"),t(" Quansync functions are in purple, which can adapt to either sync or async. ")],-1))]),n[32]||(n[32]=s("h3",{id:"usage-examples",tabindex:"-1"},[t("Usage Examples "),s("a",{class:"header-anchor",href:"#usage-examples","aria-hidden":"true"},"#")],-1)),n[33]||(n[33]=s("p",null,"Quansync provides a single API with two overloads.",-1)),n[34]||(n[34]=s("h4",{id:"wrapper-api",tabindex:"-1"},[t("Wrapper API "),s("a",{class:"header-anchor",href:"#wrapper-api","aria-hidden":"true"},"#")],-1)),n[35]||(n[35]=s("p",null,"Wrapper allows you to create a quansync function by providing a sync and an async implementation. For example:",-1)),n[36]||(n[36]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"import"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," fs"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," from"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"find-up"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"import"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," }"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," from"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"quansync"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"({")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  sync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," => "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fs"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"readFileSync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  async"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," => "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fs"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"promises"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")])])],-1)),n[37]||(n[37]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content1"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"sync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"package.json"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content2"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," await"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"async"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"package.json"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// The quansync function itself can behave like a normal async function")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content3"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," await"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"package.json"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")])])],-1)),n[38]||(n[38]=s("h4",{id:"generator-api",tabindex:"-1"},[t("Generator API "),s("a",{class:"header-anchor",href:"#generator-api","aria-hidden":"true"},"#")],-1)),n[39]||(n[39]=s("p",null,[t("Generator is where the magic happens. It allows you to create a "),s("code",null,"quansync"),t(" function by using other "),s("code",null,"quansync"),t(" functions. For example:")],-1)),n[40]||(n[40]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"import"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," }"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," from"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"quansync"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"({")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  sync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," => "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fs"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"readFileSync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"  async"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},": "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," => "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"fs"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"promises"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Create a quansync with `function*` and `yield*`")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"readJSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"},class:"highlighted-word"},"function"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"},class:"highlighted-word"},"*"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Call the quansync function directly")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // and use `yield*` to get the result.")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Upon usage, it will auto select the implementation")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," "),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"},class:"highlighted-word"},"yield*"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," JSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"parse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")])])],-1)),n[41]||(n[41]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// fs.readFileSync will be used under the hood")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"pkg1"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," readJSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"sync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"package.json"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// fs.promises.readFile will be used under the hood")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"pkg2"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," await"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," readJSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"async"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"package.json"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")])])],-1)),n[42]||(n[42]=s("h3",{id:"build-time-macros",tabindex:"-1"},[t("Build-time Macros "),s("a",{class:"header-anchor",href:"#build-time-macros","aria-hidden":"true"},"#")],-1)),n[43]||(n[43]=s("p",null,[t("If the "),s("code",null,"function*"),t(" and "),s("code",null,"yield*"),t(" syntax scares you a bit, "),s("a",{href:"https://github.com/sxzz",class:"markdown-magic-link markdown-magic-link-github-at",target:"_blank",rel:"noopener"},[s("span",{class:"markdown-magic-link-image",style:{"background-image":"url('https://github.com/sxzz.png')"}}),t("SXZZ")]),t(" also made a build-time macro "),s("a",{href:"https://github.com/quansync-dev/unplugin-quansync",target:"_blank",rel:"noopener"},[s("code",null,"unplugin-quansync")]),t(" allowing you to write normal "),s("code",null,"async"),t("/"),s("code",null,"await"),t(" syntax, and it will be transformed to the corresponding "),s("code",null,"yield*"),t(" syntax at build time.")],-1)),n[44]||(n[44]=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[s("code",{class:"language-ts"},[s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"import"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," }"),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," from"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),s("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"},class:"highlighted-word"},"quansync/macro"),s("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Use async/await syntax")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// They will be transformed to `function*` and `yield*` at build time")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"readJSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," quansync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"async "),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}}," await"),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}}," readFile"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"filepath"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"  return"),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," JSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"parse"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"content"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"})")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Expose the classical sync API")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"export"),s("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," const "),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"readJSONSync"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," readJSON"),s("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),s("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"sync")])])],-1)),n[45]||(n[45]=s("p",null,[t("Thanks to "),s("a",{href:"https://github.com/unjs/unplugin",target:"_blank",rel:"noopener"},[s("code",null,"unplugin")]),t(", it can work in almost any build tool, like compiling with "),s("code",null,"unbuild"),t(" or testing with "),s("code",null,"vitest"),t(". Please refer to "),s("a",{href:"https://github.com/quansync-dev/unplugin-quansync",target:"_blank",rel:"noopener"},"the docs"),t(" for more detailed setup.")],-1)),n[46]||(n[46]=s("h2",{id:"how-does-it-work",tabindex:"-1"},[t("How does it Work? "),s("a",{class:"header-anchor",href:"#how-does-it-work","aria-hidden":"true"},"#")],-1)),n[47]||(n[47]=s("p",null,[s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator",target:"_blank",rel:"noopener"},"Generators"),t(" in JavaScript are a powerful yet often underutilized feature. To define a generator function, you use the "),s("code",null,"function*"),t(" syntax (note that arrow functions do not support generators). Inside a generator function, you can use the "),s("code",null,"yield"),t(' keyword to pause execution and return a value. This effectively splits your logic into multiple "chunks," allowing the caller to control when to execute the next chunk.')],-1)),n[48]||(n[48]=s("p",null,[t("By leveraging this behavior, we can pause execution at each "),s("code",null,"yield"),t(" point. In an asynchronous context, we can wait for the async operation to complete before resuming execution. In a synchronous context, the next chunk runs immediately. This approach offloads the coloring problem to the caller, allowing them to decide whether the function should run synchronously or asynchronously.")],-1)),n[49]||(n[49]=s("p",null,[t("In fact, during the early days of JavaScript, before the "),s("code",null,"async"),t(" and "),s("code",null,"await"),t(" keywords were widely adopted, Babel used generators and "),s("code",null,"yield"),t(" to polyfill async behavior. While this technique isn’t new, we believe it has significant potential to improve how we handle the coloring problem, especially in library design.")],-1)),n[50]||(n[50]=s("h2",{id:"when-not-to-use",tabindex:"-1"},[t("When not to Use? "),s("a",{class:"header-anchor",href:"#when-not-to-use","aria-hidden":"true"},"#")],-1)),n[51]||(n[51]=s("p",null,[t("Frankly, I wish most of time you don’t even need to think about it. High-level tools should support async entry points for most cases, where choice "),s("code",null,"sync"),t(" and "),s("code",null,"async"),t(" is not a problem. However, there are still many cases where in the context, it’s required to be colored. In such cases, "),s("code",null,"quansync"),t(" could be a good fit for progressive and gradual adoption.")],-1)),n[52]||(n[52]=s("p",null,[t("Promise in JavaScript naturally a "),s("a",{href:"https://javascript.info/event-loop",target:"_blank",rel:"noopener"},"microtask"),t(" that delays a tick. "),s("code",null,"yield"),t(" also introduce certain overhead ("),s("a",{href:"https://github.com/quansync-dev/quansync#benchmark",target:"_blank",rel:"noopener"},[t("around "),s("code",null,"~120ns"),t(" on M1 Max")]),t("). In performance-sensitive scenarios, you might also want to avoid using either "),s("code",null,"async"),t("or "),s("code",null,"quansync"),t(".")],-1)),n[53]||(n[53]=s("h2",{id:"coloring-problem-revisited",tabindex:"-1"},[t("Coloring Problem Revisited "),s("a",{class:"header-anchor",href:"#coloring-problem-revisited","aria-hidden":"true"},"#")],-1)),n[54]||(n[54]=s("p",null,[t("While "),s("code",null,"quansync"),t(" doesn’t completely solve the coloring problem, it provides a new perspective that simplifies managing synchronous and asynchronous code. Quansync introduces a new "),s("span",{"text-purple":""},'"purple"'),t(" color, blending the red and blue. Quansync functions still face the coloring problem, as wrapping a function to support both sync and async requires it to be a quansync function (or generator). However, the key advantage is that a quansync function can be "),s("a",{href:"https://en.wikipedia.org/wiki/Wave_function_collapse",target:"_blank",rel:"noopener"},'"collapsed"'),t(' to either sync or async as needed. This allows your "colorless" logic to avoid the red and blue color inflection caused by some operations that might have a color.')],-1)),n[55]||(n[55]=s("h2",{id:"conclusion",tabindex:"-1"},[t("Conclusion "),s("a",{class:"header-anchor",href:"#conclusion","aria-hidden":"true"},"#")],-1)),n[56]||(n[56]=s("p",null,[t("This is a new approach to tackling the coloring problem we are still exploring. We will slowly roll out "),s("code",null,"quansync"),t(" in our libraries and see how it improves our experience and the ecosystem. We are also looking for feedback and contributions, so feel free to join us in the "),s("a",{href:"https://chat.antfu.me",target:"_blank",rel:"noopener"},"Discord"),t(" or "),s("a",{href:"https://github.com/quansync-dev/quansync/discussions",target:"_blank",rel:"noopener"},"GitHub Discussions"),t(" to share your thoughts.")],-1)),s("ul",null,[s("li",null,[S(p,{repo:"quansync-dev/quansync"})]),s("li",null,[S(p,{repo:"quansync-dev/unplugin-quansync"})])])])]),_:1})}}};export{Js as default};
