import{_ as l}from"./WrapperPost.vue_vue_type_script_setup_true_lang-Ba_onm78.js";import{u as r,c as i,o as s,w as u,a as e,b as t}from"./app-BwRQIUL8.js";const m={__name:"nuxt-cpuprofile",setup(p){const o={title:"CPU Profiling Nuxt",date:"2024-12-31T16:00:00.000Z",lang:"en",duration:"2min",type:"note",image:"https://antfu.me/og/nuxt-cpuprofile.png",meta:[{property:"og:title",content:"CPU Profiling Nuxt"},{name:"twitter:title",content:"CPU Profiling Nuxt"},{property:"og:image",content:"https://antfu.me/og/nuxt-cpuprofile.png"},{name:"twitter:image",content:"https://antfu.me/og/nuxt-cpuprofile.png"},{name:"twitter:card",content:"summary_large_image"}]};return r({title:"CPU Profiling Nuxt",meta:[{property:"og:title",content:"CPU Profiling Nuxt"},{name:"twitter:title",content:"CPU Profiling Nuxt"},{property:"og:image",content:"https://antfu.me/og/nuxt-cpuprofile.png"},{name:"twitter:image",content:"https://antfu.me/og/nuxt-cpuprofile.png"},{name:"twitter:card",content:"summary_large_image"}]}),(d,n)=>{const a=l;return s(),i(a,{frontmatter:o},{default:u(()=>n[0]||(n[0]=[e("div",{class:"prose m-auto slide-enter-content"},[e("p",null,"If you want to debug the bundling performance of your Nuxt app to generate CPU profiles."),e("p",null,[t("Node.js provides a built-in "),e("a",{href:"https://nodejs.org/api/cli.html#--cpu-prof",target:"_blank",rel:"noopener"},[e("code",null,"--cpu-prof")]),t(" flag that allows you to generate CPU profiles. However you canâ€™t directly pass it in your "),e("code",null,"nuxi"),t(" command, you have to use it with "),e("code",null,"node"),t(" directly.")]),e("p",null,[t("Instead of running "),e("code",null,"nuxi dev"),t(", you can run "),e("code",null,"node"),t(" with the direct path to the CLI in "),e("code",null,"node_modules"),t(":")]),e("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[e("code",{class:"language-bash"},[e("span",{class:"line"},[e("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"# nuxi dev")]),t(`
`),e("span",{class:"line"},[e("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"node"),e("span",{style:{"--s-dark":"#C99076","--s-light":"#A65E2B"}}," --cpu-prof"),e("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}}," ./node_modules/nuxi/bin/nuxi.mjs"),e("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}}," dev"),e("span",{style:{"--s-dark":"#C99076","--s-light":"#A65E2B"}}," --fork=false")])])]),e("p",null,[t("Note that "),e("code",null,"--fork=false"),t(" is important as by "),e("a",{href:"https://github.com/nuxt/cli/blob/a433fbcebda8cb87d7c0c8199137877b669e1c31/src/commands/dev.ts#L69-L75",target:"_blank",rel:"noopener"},[t("default "),e("code",null,"nuxi"),t(" will start the Nuxt process in a forked process")]),t(" which will make the CPU profile not working.")]),e("blockquote",null,[e("p",null,[t("The simliar technique can be applied to other CLI tools that are not directly using "),e("code",null,"node"),t(" to start the process.")])]),e("p",null,[t("After killing your Nuxt process, you will find two "),e("code",null,"CPU.***.cpuprofile"),t(" files generated in your working directory. I recommend using "),e("a",{href:"https://discoveryjs.github.io/cpupro/",target:"_blank",rel:"noopener"},"CPUpro"),t(" to visualize the profile. If you are using VS Code, I also created "),e("a",{href:"https://marketplace.visualstudio.com/items?itemName=antfu.cpupro",target:"_blank",rel:"noopener"},"an extension"),t(" for you to directly open the "),e("code",null,".cpuprofile"),t(" file in VS Code easily.")])],-1)])),_:1,__:[0]})}}};export{m as default};
