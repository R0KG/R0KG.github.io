import{_ as Vr}from"./WrapperPost.vue_vue_type_script_setup_true_lang-h66aYrYB.js";import{Z as Kr,$ as qt,j as kt,i as Xr,_ as xt,e as Fe,r as at,a0 as Is,g as Pe,o as ye,a as o,x as Dn,n as H,k as x,b as m,d as le,t as Bn,F as Qr,a1 as ce,D as Rs,f as $s,a2 as In,c as Ls,u as Zr,w as Dt}from"./app-BJ_3SEP9.js";import{_ as Jr}from"./GitHubLink.vue_vue_type_script_setup_true_lang-BHBYo4gN.js";import{_ as Yr}from"./Tweet.vue_vue_type_script_setup_true_lang-BuJW88MG.js";import"./logo-github-CITidJVY.js";const ea=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});function ta(t){if(t?.__resolved)return t;const e={...ea,...t};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}const J=-1,V=1,T=0;function $(t,e){return[t,e]}function ke(t,e,n,s=!0,r){const a=ta(n);typeof r>"u"&&(a.diffTimeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+a.diffTimeout*1e3);const i=r;if(t==null||e==null)throw new Error("Null input. (diff_main)");if(t===e)return t?[$(T,t)]:[];const c=s;let l=hn(t,e);const u=t.substring(0,l);t=t.substring(l),e=e.substring(l),l=bt(t,e);const h=t.substring(t.length-l);t=t.substring(0,t.length-l),e=e.substring(0,e.length-l);const p=na(t,e,a,c,i);return u&&p.unshift($(T,u)),h&&p.push($(T,h)),pn(p),p}function na(t,e,n,s,r){let a;if(!t)return[$(V,e)];if(!e)return[$(J,t)];const i=t.length>e.length?t:e,c=t.length>e.length?e:t,l=i.indexOf(c);if(l!==-1)return a=[$(V,i.substring(0,l)),$(T,c),$(V,i.substring(l+c.length))],t.length>e.length&&(a[0][0]=a[2][0]=J),a;if(c.length===1)return[$(J,t),$(V,e)];const u=oa(t,e,n);if(u){const h=u[0],p=u[1],g=u[2],f=u[3],d=u[4],k=ke(h,g,n,s,r),w=ke(p,f,n,s,r);return k.concat([$(T,d)],w)}return s&&t.length>100&&e.length>100?sa(t,e,n,r):ra(t,e,n,r)}function sa(t,e,n,s){const r=aa(t,e);t=r.chars1,e=r.chars2;const a=r.lineArray,i=ke(t,e,n,!1,s);ia(i,a),la(i),i.push($(T,""));let c=0,l=0,u=0,h="",p="";for(;c<i.length;){switch(i[c][0]){case V:u++,p+=i[c][1];break;case J:l++,h+=i[c][1];break;case T:if(l>=1&&u>=1){i.splice(c-l-u,l+u),c=c-l-u;const g=ke(h,p,n,!1,s);for(let f=g.length-1;f>=0;f--)i.splice(c,0,g[f]);c=c+g.length}u=0,l=0,h="",p="";break}c++}return i.pop(),i}function ra(t,e,n,s){const r=t.length,a=e.length,i=Math.ceil((r+a)/2),c=i,l=2*i,u=new Array(l),h=new Array(l);for(let b=0;b<l;b++)u[b]=-1,h[b]=-1;u[c+1]=0,h[c+1]=0;const p=r-a,g=p%2!==0;let f=0,d=0,k=0,w=0;for(let b=0;b<i&&!(new Date().getTime()>s);b++){for(let y=-b+f;y<=b-d;y+=2){const _=c+y;let A;y===-b||y!==b&&u[_-1]<u[_+1]?A=u[_+1]:A=u[_-1]+1;let v=A-y;for(;A<r&&v<a&&t.charAt(A)===e.charAt(v);)A++,v++;if(u[_]=A,A>r)d+=2;else if(v>a)f+=2;else if(g){const D=c+p-y;if(D>=0&&D<l&&h[D]!==-1){const I=r-h[D];if(A>=I)return Rn(t,e,n,A,v,s)}}}for(let y=-b+k;y<=b-w;y+=2){const _=c+y;let A;y===-b||y!==b&&h[_-1]<h[_+1]?A=h[_+1]:A=h[_-1]+1;let v=A-y;for(;A<r&&v<a&&t.charAt(r-A-1)===e.charAt(a-v-1);)A++,v++;if(h[_]=A,A>r)w+=2;else if(v>a)k+=2;else if(!g){const D=c+p-y;if(D>=0&&D<l&&u[D]!==-1){const I=u[D],G=c+I-D;if(A=r-A,I>=A)return Rn(t,e,n,I,G,s)}}}}return[$(J,t),$(V,e)]}function Rn(t,e,n,s,r,a){const i=t.substring(0,s),c=e.substring(0,r),l=t.substring(s),u=e.substring(r),h=ke(i,c,n,!1,a),p=ke(l,u,n,!1,a);return h.concat(p)}function aa(t,e){const n=[],s={};let r=4e4;n[0]="";function a(l){let u="",h=0,p=-1,g=n.length;for(;p<l.length-1;){p=l.indexOf(`
`,h),p===-1&&(p=l.length-1);let f=l.substring(h,p+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,f):s[f]!==void 0)?u+=String.fromCharCode(s[f]):(g===r&&(f=l.substring(h),p=l.length),u+=String.fromCharCode(g),s[f]=g,n[g++]=f),h=p+1}return u}const i=a(t);r=65535;const c=a(e);return{chars1:i,chars2:c,lineArray:n}}function ia(t,e){for(let n=0;n<t.length;n++){const s=t[n][1],r=[];for(let a=0;a<s.length;a++)r[a]=e[s.charCodeAt(a)];t[n][1]=r.join("")}}function hn(t,e){if(!t||!e||t.charAt(0)!==e.charAt(0))return 0;let n=0,s=Math.min(t.length,e.length),r=s,a=0;for(;n<r;)t.substring(a,r)===e.substring(a,r)?(n=r,a=n):s=r,r=Math.floor((s-n)/2+n);return r}function bt(t,e){if(!t||!e||t.charAt(t.length-1)!==e.charAt(e.length-1))return 0;let n=0,s=Math.min(t.length,e.length),r=s,a=0;for(;n<r;)t.substring(t.length-r,t.length-a)===e.substring(e.length-r,e.length-a)?(n=r,a=n):s=r,r=Math.floor((s-n)/2+n);return r}function $n(t,e){const n=t.length,s=e.length;if(n===0||s===0)return 0;n>s?t=t.substring(n-s):n<s&&(e=e.substring(0,n));const r=Math.min(n,s);if(t===e)return r;let a=0,i=1;for(;;){const c=t.substring(r-i),l=e.indexOf(c);if(l===-1)return a;i+=l,(l===0||t.substring(r-i)===e.substring(0,i))&&(a=i,i++)}}function oa(t,e,n){if(n.diffTimeout<=0)return null;const s=t.length>e.length?t:e,r=t.length>e.length?e:t;if(s.length<4||r.length*2<s.length)return null;function a(d,k,w){const b=d.substring(w,w+Math.floor(d.length/4));let y=-1,_="",A,v,D,I;for(;(y=k.indexOf(b,y+1))!==-1;){const G=hn(d.substring(w),k.substring(y)),Y=bt(d.substring(0,w),k.substring(0,y));_.length<Y+G&&(_=k.substring(y-Y,y)+k.substring(y,y+G),A=d.substring(0,w-Y),v=d.substring(w+G),D=k.substring(0,y-Y),I=k.substring(y+G))}return _.length*2>=d.length?[A,v,D,I,_]:null}const i=a(s,r,Math.ceil(s.length/4)),c=a(s,r,Math.ceil(s.length/2));let l;if(!i&&!c)return null;c?i?l=i[4].length>c[4].length?i:c:l=c:l=i;let u,h,p,g;t.length>e.length?(u=l[0],h=l[1],p=l[2],g=l[3]):(p=l[0],g=l[1],u=l[2],h=l[3]);const f=l[4];return[u,h,p,g,f]}function la(t){let e=!1;const n=[];let s=0,r=null,a=0,i=0,c=0,l=0,u=0;for(;a<t.length;)t[a][0]===T?(n[s++]=a,i=l,c=u,l=0,u=0,r=t[a][1]):(t[a][0]===V?l+=t[a][1].length:u+=t[a][1].length,r&&r.length<=Math.max(i,c)&&r.length<=Math.max(l,u)&&(t.splice(n[s-1],0,$(J,r)),t[n[s-1]+1][0]=V,s--,s--,a=s>0?n[s-1]:-1,i=0,c=0,l=0,u=0,r=null,e=!0)),a++;for(e&&pn(t),ha(t),a=1;a<t.length;){if(t[a-1][0]===J&&t[a][0]===V){const h=t[a-1][1],p=t[a][1],g=$n(h,p),f=$n(p,h);g>=f?(g>=h.length/2||g>=p.length/2)&&(t.splice(a,0,$(T,p.substring(0,g))),t[a-1][1]=h.substring(0,h.length-g),t[a+1][1]=p.substring(g),a++):(f>=h.length/2||f>=p.length/2)&&(t.splice(a,0,$(T,h.substring(0,f))),t[a-1][0]=V,t[a-1][1]=p.substring(0,p.length-f),t[a+1][0]=J,t[a+1][1]=h.substring(f),a++),a++}a++}}const Ln=/[^a-z0-9]/i,Mn=/\s/,Tn=/[\r\n]/,ca=/\n\r?\n$/,ua=/^\r?\n\r?\n/;function ha(t){function e(s,r){if(!s||!r)return 6;const a=s.charAt(s.length-1),i=r.charAt(0),c=a.match(Ln),l=i.match(Ln),u=c&&a.match(Mn),h=l&&i.match(Mn),p=u&&a.match(Tn),g=h&&i.match(Tn),f=p&&s.match(ca),d=g&&r.match(ua);return f||d?5:p||g?4:c&&!u&&h?3:u||h?2:c||l?1:0}let n=1;for(;n<t.length-1;){if(t[n-1][0]===T&&t[n+1][0]===T){let s=t[n-1][1],r=t[n][1],a=t[n+1][1];const i=bt(s,r);if(i){const p=r.substring(r.length-i);s=s.substring(0,s.length-i),r=p+r.substring(0,r.length-i),a=p+a}let c=s,l=r,u=a,h=e(s,r)+e(r,a);for(;r.charAt(0)===a.charAt(0);){s+=r.charAt(0),r=r.substring(1)+a.charAt(0),a=a.substring(1);const p=e(s,r)+e(r,a);p>=h&&(h=p,c=s,l=r,u=a)}t[n-1][1]!==c&&(c?t[n-1][1]=c:(t.splice(n-1,1),n--),t[n][1]=l,u?t[n+1][1]=u:(t.splice(n+1,1),n--))}n++}}function pn(t){t.push($(T,""));let e=0,n=0,s=0,r="",a="",i;for(;e<t.length;)switch(t[e][0]){case V:s++,a+=t[e][1],e++;break;case J:n++,r+=t[e][1],e++;break;case T:n+s>1?(n!==0&&s!==0&&(i=hn(a,r),i!==0&&(e-n-s>0&&t[e-n-s-1][0]===T?t[e-n-s-1][1]+=a.substring(0,i):(t.splice(0,0,$(T,a.substring(0,i))),e++),a=a.substring(i),r=r.substring(i)),i=bt(a,r),i!==0&&(t[e][1]=a.substring(a.length-i)+t[e][1],a=a.substring(0,a.length-i),r=r.substring(0,r.length-i))),e-=n+s,t.splice(e,n+s),r.length&&(t.splice(e,0,$(J,r)),e++),a.length&&(t.splice(e,0,$(V,a)),e++),e++):e!==0&&t[e-1][0]===T?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,s=0,n=0,r="",a="";break}t[t.length-1][1]===""&&t.pop();let c=!1;for(e=1;e<t.length-1;)t[e-1][0]===T&&t[e+1][0]===T&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),c=!0):t[e][1].substring(0,t[e+1][1].length)===t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),c=!0)),e++;c&&pn(t)}function pa(t){return typeof t=="string"?`'${t}'`:new da().serialize(t)}const da=function(){class t{#e=new Map;compare(n,s){const r=typeof n,a=typeof s;return r==="string"&&a==="string"?n.localeCompare(s):r==="number"&&a==="number"?n-s:String.prototype.localeCompare.call(this.serialize(n,!0),this.serialize(s,!0))}serialize(n,s){if(n===null)return"null";switch(typeof n){case"string":return s?n:`'${n}'`;case"bigint":return`${n}n`;case"object":return this.$object(n);case"function":return this.$function(n)}return String(n)}serializeObject(n){const s=Object.prototype.toString.call(n);if(s!=="[object Object]")return this.serializeBuiltInType(s.length<10?`unknown:${s}`:s.slice(8,-1),n);const r=n.constructor,a=r===Object||r===void 0?"":r.name;if(a!==""&&globalThis[a]===r)return this.serializeBuiltInType(a,n);if(typeof n.toJSON=="function"){const i=n.toJSON();return a+(i!==null&&typeof i=="object"?this.$object(i):`(${this.serialize(i)})`)}return this.serializeObjectEntries(a,Object.entries(n))}serializeBuiltInType(n,s){const r=this["$"+n];if(r)return r.call(this,s);if(typeof s?.entries=="function")return this.serializeObjectEntries(n,s.entries());throw new Error(`Cannot serialize ${n}`)}serializeObjectEntries(n,s){const r=Array.from(s).sort((i,c)=>this.compare(i[0],c[0]));let a=`${n}{`;for(let i=0;i<r.length;i++){const[c,l]=r[i];a+=`${this.serialize(c,!0)}:${this.serialize(l)}`,i<r.length-1&&(a+=",")}return a+"}"}$object(n){let s=this.#e.get(n);return s===void 0&&(this.#e.set(n,`#${this.#e.size}`),s=this.serializeObject(n),this.#e.set(n,s)),s}$function(n){const s=Function.prototype.toString.call(n);return s.slice(-15)==="[native code] }"?`${n.name||""}()[native]`:`${n.name}(${n.length})${s.replace(/\s*\n\s*/g,"")}`}$Array(n){let s="[";for(let r=0;r<n.length;r++)s+=this.serialize(n[r]),r<n.length-1&&(s+=",");return s+"]"}$Date(n){try{return`Date(${n.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(n){return`ArrayBuffer[${new Uint8Array(n).join(",")}]`}$Set(n){return`Set${this.$Array(Array.from(n).sort((s,r)=>this.compare(s,r)))}`}$Map(n){return this.serializeObjectEntries("Map",n.entries())}}for(const e of["Error","RegExp","URL"])t.prototype["$"+e]=function(n){return`${e}(${n})`};for(const e of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+e]=function(n){return`${e}[${n.join(",")}]`};for(const e of["BigInt64Array","BigUint64Array"])t.prototype["$"+e]=function(n){return`${e}[${n.join("n,")}${n.length>0?"n":""}]`};return t}(),ga=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],fa=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",he=[];let ya=class{_data=new Xe;_hash=new Xe([...ga]);_nDataBytes=0;_minBufferSize=0;finalize(e){e&&this._append(e);const n=this._nDataBytes*8,s=this._data.sigBytes*8;return this._data.words[s>>>5]|=128<<24-s%32,this._data.words[(s+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(s+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(e,n){const s=this._hash.words;let r=s[0],a=s[1],i=s[2],c=s[3],l=s[4],u=s[5],h=s[6],p=s[7];for(let g=0;g<64;g++){if(g<16)he[g]=e[n+g]|0;else{const _=he[g-15],A=(_<<25|_>>>7)^(_<<14|_>>>18)^_>>>3,v=he[g-2],D=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;he[g]=A+he[g-7]+D+he[g-16]}const f=l&u^~l&h,d=r&a^r&i^a&i,k=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),b=p+w+f+fa[g]+he[g],y=k+d;p=h,h=u,u=l,l=c+b|0,c=i,i=a,a=r,r=b+y|0}s[0]=s[0]+r|0,s[1]=s[1]+a|0,s[2]=s[2]+i|0,s[3]=s[3]+c|0,s[4]=s[4]+l|0,s[5]=s[5]+u|0,s[6]=s[6]+h|0,s[7]=s[7]+p|0}_append(e){typeof e=="string"&&(e=Xe.fromUtf8(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_process(e){let n,s=this._data.sigBytes/64;e?s=Math.ceil(s):s=Math.max((s|0)-this._minBufferSize,0);const r=s*16,a=Math.min(r*4,this._data.sigBytes);if(r){for(let i=0;i<r;i+=16)this._doProcessBlock(this._data.words,i);n=this._data.words.splice(0,r),this._data.sigBytes-=a}return new Xe(n,a)}},Xe=class Ms{words;sigBytes;constructor(e,n){e=this.words=e||[],this.sigBytes=n===void 0?e.length*4:n}static fromUtf8(e){const n=unescape(encodeURIComponent(e)),s=n.length,r=[];for(let a=0;a<s;a++)r[a>>>2]|=(n.charCodeAt(a)&255)<<24-a%4*8;return new Ms(r,s)}toBase64(){const e=[];for(let n=0;n<this.sigBytes;n+=3){const s=this.words[n>>>2]>>>24-n%4*8&255,r=this.words[n+1>>>2]>>>24-(n+1)%4*8&255,a=this.words[n+2>>>2]>>>24-(n+2)%4*8&255,i=s<<16|r<<8|a;for(let c=0;c<4&&n*8+c*6<this.sigBytes*8;c++)e.push(ma.charAt(i>>>6*(3-c)&63))}return e.join("")}concat(e){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let n=0;n<e.sigBytes;n++){const s=e.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=s<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<e.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=e.words[n>>>2];this.sigBytes+=e.sigBytes}};function ka(t){return new ya().finalize(t).toBase64()}function ba(t){return ka(pa(t))}function Ts(t,e={}){const n=Ps("",[]);let s=n,r=n;function a(i,c){s=r;const l=c?{...e,...c}:e,u=t(i,l.lineNumbers);return{from:s,to:r}=_a(s,u,l),{current:r,previous:s}}return{get current(){return r},get previous(){return s},commit:a,reset(){s=n,r=n}}}function Ns(t,e,n,s=!1){const r=t.codeToTokens(e,n);return{...Ps(e,r.tokens,JSON.stringify([n.lang,"themes"in n?n.themes:n.theme]),s),bg:r.bg,fg:r.fg,rootStyle:r.rootStyle,themeName:r.themeName,lang:n.lang}}function Ps(t,e,n="",s=!1){const r=ba(t+n);let a=0,i=0;const c=Math.ceil(Math.log10(e.length)),l=wa(e).flatMap((u,h)=>{i=u[0]?.offset||a;const p=u[u.length-1];p?a=p.offset+p.content.length:a+=1;const g=[...u,{content:`
`,offset:a}];return s&&g.unshift({key:`${r}-ln-${h+1}`,content:`${String(h+1).padStart(c," ")}  `,offset:i,htmlClass:"shiki-magic-move-line-number"}),g}).map((u,h)=>{const p=u;return p.key||=`${r}-${h}`,p});return{code:t,hash:r,tokens:l,lineNumbers:s}}function wa(t){return t.map(e=>e.flatMap(n=>{if(n.content.match(/^\s+$/))return n;const s=n.content.match(/^(\s*)(.*?)(\s*)$/);if(!s)return n;const[,r,a,i]=s;if(!r&&!i)return n;const c=[{...n,offset:n.offset+r.length,content:a}];return r&&c.unshift({content:r,offset:n.offset}),i&&c.push({content:i,offset:n.offset+r.length+a.length}),c}))}function Ca(t,e){let n=0;const s=t.key;let r=0;const a=[];function i(){return r===0?(r++,s):`${s}-${r++}`}for(const c of e)c>n&&a.push({...t,content:t.content.slice(n,c),offset:t.offset+n,key:i()}),n=c;return n<t.content.length&&a.push({...t,content:t.content.slice(n),offset:t.offset+n,key:i()}),a}function Nn(t,e){const n=Array.from(e instanceof Set?e:new Set(e)).sort((s,r)=>s-r);return n.length?t.flatMap(s=>{const r=n.filter(a=>s.offset<a&&a<s.offset+s.content.length).map(a=>a-s.offset).sort((a,i)=>a-i);return r.length?Ca(s,r):s}):t}function _a(t,e,n={}){const{splitTokens:s=!1,enhanceMatching:r=!0}=n,a=Aa(t.code,e.code,n),i=s?Nn(t.tokens,a.flatMap(u=>u.from)):t.tokens,c=s?Nn(e.tokens,a.flatMap(u=>u.to)):e.tokens,l=new Set;if(a.forEach(u=>{const h=i.filter(d=>d.offset>=u.from[0]&&d.offset+d.content.length<=u.from[1]),p=c.filter(d=>d.offset>=u.to[0]&&d.offset+d.content.length<=u.to[1]);let g=0,f=0;for(;g<h.length&&f<p.length&&!(!h[g]||!p[f]);)h[g].content===p[f].content?(p[f].key=h[g].key,l.add(h[g].key),g++,f++):h[g+1]?.content===p[f].content?g++:(h[g].content===p[f+1]?.content||g++,f++)}),r)for(const u of i){if(l.has(u.key)||u.content.length<3||!u.content.match(/^[\w-]+$/))continue;const h=c.find(p=>p.content===u.content&&!l.has(p.key));h&&(h.key=u.key,l.add(u.key))}return{from:i.length===t.tokens.length?t:{...t,tokens:i},to:c.length===e.tokens.length?e:{...e,tokens:c}}}function Aa(t,e,n={}){let s=ke(t,e);s=n.diffCleanup?.(s)||s;let r="",a="";const i=[];for(const[c,l]of s)c===0?(i.push({from:[r.length,r.length+l.length],to:[a.length,a.length+l.length],content:l}),r+=l,a+=l):c===-1?r+=l:c===1&&(a+=l);if(r!==t||a!==e)throw new Error("Content mismatch");return i}let P=class extends Error{constructor(e){super(e),this.name="ShikiError"}};function va(t){return dn(t)}function dn(t){return Array.isArray(t)?Sa(t):t instanceof RegExp?t:typeof t=="object"?Ea(t):t}function Sa(t){let e=[];for(let n=0,s=t.length;n<s;n++)e[n]=dn(t[n]);return e}function Ea(t){let e={};for(let n in t)e[n]=dn(t[n]);return e}function Os(t,...e){return e.forEach(n=>{for(let s in n)t[s]=n[s]}),t}function Gs(t){const e=~t.lastIndexOf("/")||~t.lastIndexOf("\\");return e===0?t:~e===t.length-1?Gs(t.substring(0,t.length-1)):t.substr(~e+1)}var Bt=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g,Qe=class{static hasCaptures(t){return t===null?!1:(Bt.lastIndex=0,Bt.test(t))}static replaceCaptures(t,e,n){return t.replace(Bt,(s,r,a,i)=>{let c=n[parseInt(r||a,10)];if(c){let l=e.substring(c.start,c.end);for(;l[0]===".";)l=l.substring(1);switch(i){case"downcase":return l.toLowerCase();case"upcase":return l.toUpperCase();default:return l}}else return s})}};function Fs(t,e){return t<e?-1:t>e?1:0}function js(t,e){if(t===null&&e===null)return 0;if(!t)return-1;if(!e)return 1;let n=t.length,s=e.length;if(n===s){for(let r=0;r<n;r++){let a=Fs(t[r],e[r]);if(a!==0)return a}return 0}return n-s}function Pn(t){return!!(/^#[0-9a-f]{6}$/i.test(t)||/^#[0-9a-f]{8}$/i.test(t)||/^#[0-9a-f]{3}$/i.test(t)||/^#[0-9a-f]{4}$/i.test(t))}function Us(t){return t.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")}var zs=class{constructor(t){this.fn=t}cache=new Map;get(t){if(this.cache.has(t))return this.cache.get(t);const e=this.fn(t);return this.cache.set(t,e),e}},it=class{constructor(t,e,n){this._colorMap=t,this._defaults=e,this._root=n}static createFromRawTheme(t,e){return this.createFromParsedTheme(Ba(t),e)}static createFromParsedTheme(t,e){return Ra(t,e)}_cachedMatchRoot=new zs(t=>this._root.match(t));getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(t){if(t===null)return this._defaults;const e=t.scopeName,s=this._cachedMatchRoot.get(e).find(r=>xa(t.parent,r.parentScopes));return s?new Ws(s.fontStyle,s.foreground,s.background):null}},It=class nt{constructor(e,n){this.parent=e,this.scopeName=n}static push(e,n){for(const s of n)e=new nt(e,s);return e}static from(...e){let n=null;for(let s=0;s<e.length;s++)n=new nt(n,e[s]);return n}push(e){return new nt(this,e)}getSegments(){let e=this;const n=[];for(;e;)n.push(e.scopeName),e=e.parent;return n.reverse(),n}toString(){return this.getSegments().join(" ")}extends(e){return this===e?!0:this.parent===null?!1:this.parent.extends(e)}getExtensionIfDefined(e){const n=[];let s=this;for(;s&&s!==e;)n.push(s.scopeName),s=s.parent;return s===e?n.reverse():void 0}};function xa(t,e){if(e.length===0)return!0;for(let n=0;n<e.length;n++){let s=e[n],r=!1;if(s===">"){if(n===e.length-1)return!1;s=e[++n],r=!0}for(;t&&!Da(t.scopeName,s);){if(r)return!1;t=t.parent}if(!t)return!1;t=t.parent}return!0}function Da(t,e){return e===t||t.startsWith(e)&&t[e.length]==="."}var Ws=class{constructor(t,e,n){this.fontStyle=t,this.foregroundId=e,this.backgroundId=n}};function Ba(t){if(!t)return[];if(!t.settings||!Array.isArray(t.settings))return[];let e=t.settings,n=[],s=0;for(let r=0,a=e.length;r<a;r++){let i=e[r];if(!i.settings)continue;let c;if(typeof i.scope=="string"){let p=i.scope;p=p.replace(/^[,]+/,""),p=p.replace(/[,]+$/,""),c=p.split(",")}else Array.isArray(i.scope)?c=i.scope:c=[""];let l=-1;if(typeof i.settings.fontStyle=="string"){l=0;let p=i.settings.fontStyle.split(" ");for(let g=0,f=p.length;g<f;g++)switch(p[g]){case"italic":l=l|1;break;case"bold":l=l|2;break;case"underline":l=l|4;break;case"strikethrough":l=l|8;break}}let u=null;typeof i.settings.foreground=="string"&&Pn(i.settings.foreground)&&(u=i.settings.foreground);let h=null;typeof i.settings.background=="string"&&Pn(i.settings.background)&&(h=i.settings.background);for(let p=0,g=c.length;p<g;p++){let d=c[p].trim().split(" "),k=d[d.length-1],w=null;d.length>1&&(w=d.slice(0,d.length-1),w.reverse()),n[s++]=new Ia(k,w,r,l,u,h)}}return n}var Ia=class{constructor(t,e,n,s,r,a){this.scope=t,this.parentScopes=e,this.index=n,this.fontStyle=s,this.foreground=r,this.background=a}},j=(t=>(t[t.NotSet=-1]="NotSet",t[t.None=0]="None",t[t.Italic=1]="Italic",t[t.Bold=2]="Bold",t[t.Underline=4]="Underline",t[t.Strikethrough=8]="Strikethrough",t))(j||{});function Ra(t,e){t.sort((l,u)=>{let h=Fs(l.scope,u.scope);return h!==0||(h=js(l.parentScopes,u.parentScopes),h!==0)?h:l.index-u.index});let n=0,s="#000000",r="#ffffff";for(;t.length>=1&&t[0].scope==="";){let l=t.shift();l.fontStyle!==-1&&(n=l.fontStyle),l.foreground!==null&&(s=l.foreground),l.background!==null&&(r=l.background)}let a=new $a(e),i=new Ws(n,a.getId(s),a.getId(r)),c=new Ma(new Vt(0,null,-1,0,0),[]);for(let l=0,u=t.length;l<u;l++){let h=t[l];c.insert(0,h.scope,h.parentScopes,h.fontStyle,a.getId(h.foreground),a.getId(h.background))}return new it(a,i,c)}var $a=class{_isFrozen;_lastColorId;_id2color;_color2id;constructor(t){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(t)){this._isFrozen=!0;for(let e=0,n=t.length;e<n;e++)this._color2id[t[e]]=e,this._id2color[e]=t[e]}else this._isFrozen=!1}getId(t){if(t===null)return 0;t=t.toUpperCase();let e=this._color2id[t];if(e)return e;if(this._isFrozen)throw new Error(`Missing color in color map - ${t}`);return e=++this._lastColorId,this._color2id[t]=e,this._id2color[e]=t,e}getColorMap(){return this._id2color.slice(0)}},La=Object.freeze([]),Vt=class Hs{scopeDepth;parentScopes;fontStyle;foreground;background;constructor(e,n,s,r,a){this.scopeDepth=e,this.parentScopes=n||La,this.fontStyle=s,this.foreground=r,this.background=a}clone(){return new Hs(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(e){let n=[];for(let s=0,r=e.length;s<r;s++)n[s]=e[s].clone();return n}acceptOverwrite(e,n,s,r){this.scopeDepth>e?console.log("how did this happen?"):this.scopeDepth=e,n!==-1&&(this.fontStyle=n),s!==0&&(this.foreground=s),r!==0&&(this.background=r)}},Ma=class Kt{constructor(e,n=[],s={}){this._mainRule=e,this._children=s,this._rulesWithParentScopes=n}_rulesWithParentScopes;static _cmpBySpecificity(e,n){if(e.scopeDepth!==n.scopeDepth)return n.scopeDepth-e.scopeDepth;let s=0,r=0;for(;e.parentScopes[s]===">"&&s++,n.parentScopes[r]===">"&&r++,!(s>=e.parentScopes.length||r>=n.parentScopes.length);){const a=n.parentScopes[r].length-e.parentScopes[s].length;if(a!==0)return a;s++,r++}return n.parentScopes.length-e.parentScopes.length}match(e){if(e!==""){let s=e.indexOf("."),r,a;if(s===-1?(r=e,a=""):(r=e.substring(0,s),a=e.substring(s+1)),this._children.hasOwnProperty(r))return this._children[r].match(a)}const n=this._rulesWithParentScopes.concat(this._mainRule);return n.sort(Kt._cmpBySpecificity),n}insert(e,n,s,r,a,i){if(n===""){this._doInsertHere(e,s,r,a,i);return}let c=n.indexOf("."),l,u;c===-1?(l=n,u=""):(l=n.substring(0,c),u=n.substring(c+1));let h;this._children.hasOwnProperty(l)?h=this._children[l]:(h=new Kt(this._mainRule.clone(),Vt.cloneArr(this._rulesWithParentScopes)),this._children[l]=h),h.insert(e+1,u,s,r,a,i)}_doInsertHere(e,n,s,r,a){if(n===null){this._mainRule.acceptOverwrite(e,s,r,a);return}for(let i=0,c=this._rulesWithParentScopes.length;i<c;i++){let l=this._rulesWithParentScopes[i];if(js(l.parentScopes,n)===0){l.acceptOverwrite(e,s,r,a);return}}s===-1&&(s=this._mainRule.fontStyle),r===0&&(r=this._mainRule.foreground),a===0&&(a=this._mainRule.background),this._rulesWithParentScopes.push(new Vt(e,n,s,r,a))}},Be=class W{static toBinaryStr(e){return e.toString(2).padStart(32,"0")}static print(e){const n=W.getLanguageId(e),s=W.getTokenType(e),r=W.getFontStyle(e),a=W.getForeground(e),i=W.getBackground(e);console.log({languageId:n,tokenType:s,fontStyle:r,foreground:a,background:i})}static getLanguageId(e){return(e&255)>>>0}static getTokenType(e){return(e&768)>>>8}static containsBalancedBrackets(e){return(e&1024)!==0}static getFontStyle(e){return(e&30720)>>>11}static getForeground(e){return(e&16744448)>>>15}static getBackground(e){return(e&4278190080)>>>24}static set(e,n,s,r,a,i,c){let l=W.getLanguageId(e),u=W.getTokenType(e),h=W.containsBalancedBrackets(e)?1:0,p=W.getFontStyle(e),g=W.getForeground(e),f=W.getBackground(e);return n!==0&&(l=n),s!==8&&(u=s),r!==null&&(h=r?1:0),a!==-1&&(p=a),i!==0&&(g=i),c!==0&&(f=c),(l<<0|u<<8|h<<10|p<<11|g<<15|f<<24)>>>0}};function ot(t,e){const n=[],s=Ta(t);let r=s.next();for(;r!==null;){let l=0;if(r.length===2&&r.charAt(1)===":"){switch(r.charAt(0)){case"R":l=1;break;case"L":l=-1;break;default:console.log(`Unknown priority ${r} in scope selector`)}r=s.next()}let u=i();if(n.push({matcher:u,priority:l}),r!==",")break;r=s.next()}return n;function a(){if(r==="-"){r=s.next();const l=a();return u=>!!l&&!l(u)}if(r==="("){r=s.next();const l=c();return r===")"&&(r=s.next()),l}if(On(r)){const l=[];do l.push(r),r=s.next();while(On(r));return u=>e(l,u)}return null}function i(){const l=[];let u=a();for(;u;)l.push(u),u=a();return h=>l.every(p=>p(h))}function c(){const l=[];let u=i();for(;u&&(l.push(u),r==="|"||r===",");){do r=s.next();while(r==="|"||r===",");u=i()}return h=>l.some(p=>p(h))}}function On(t){return!!t&&!!t.match(/[\w\.:]+/)}function Ta(t){let e=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g,n=e.exec(t);return{next:()=>{if(!n)return null;const s=n[0];return n=e.exec(t),s}}}function qs(t){typeof t.dispose=="function"&&t.dispose()}var je=class{constructor(t){this.scopeName=t}toKey(){return this.scopeName}},Na=class{constructor(t,e){this.scopeName=t,this.ruleName=e}toKey(){return`${this.scopeName}#${this.ruleName}`}},Pa=class{_references=[];_seenReferenceKeys=new Set;get references(){return this._references}visitedRule=new Set;add(t){const e=t.toKey();this._seenReferenceKeys.has(e)||(this._seenReferenceKeys.add(e),this._references.push(t))}},Oa=class{constructor(t,e){this.repo=t,this.initialScopeName=e,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new je(this.initialScopeName)]}seenFullScopeRequests=new Set;seenPartialScopeRequests=new Set;Q;processQueue(){const t=this.Q;this.Q=[];const e=new Pa;for(const n of t)Ga(n,this.initialScopeName,this.repo,e);for(const n of e.references)if(n instanceof je){if(this.seenFullScopeRequests.has(n.scopeName))continue;this.seenFullScopeRequests.add(n.scopeName),this.Q.push(n)}else{if(this.seenFullScopeRequests.has(n.scopeName)||this.seenPartialScopeRequests.has(n.toKey()))continue;this.seenPartialScopeRequests.add(n.toKey()),this.Q.push(n)}}};function Ga(t,e,n,s){const r=n.lookup(t.scopeName);if(!r){if(t.scopeName===e)throw new Error(`No grammar provided for <${e}>`);return}const a=n.lookup(e);t instanceof je?st({baseGrammar:a,selfGrammar:r},s):Xt(t.ruleName,{baseGrammar:a,selfGrammar:r,repository:r.repository},s);const i=n.injections(t.scopeName);if(i)for(const c of i)s.add(new je(c))}function Xt(t,e,n){if(e.repository&&e.repository[t]){const s=e.repository[t];lt([s],e,n)}}function st(t,e){t.selfGrammar.patterns&&Array.isArray(t.selfGrammar.patterns)&&lt(t.selfGrammar.patterns,{...t,repository:t.selfGrammar.repository},e),t.selfGrammar.injections&&lt(Object.values(t.selfGrammar.injections),{...t,repository:t.selfGrammar.repository},e)}function lt(t,e,n){for(const s of t){if(n.visitedRule.has(s))continue;n.visitedRule.add(s);const r=s.repository?Os({},e.repository,s.repository):e.repository;Array.isArray(s.patterns)&&lt(s.patterns,{...e,repository:r},n);const a=s.include;if(!a)continue;const i=Vs(a);switch(i.kind){case 0:st({...e,selfGrammar:e.baseGrammar},n);break;case 1:st(e,n);break;case 2:Xt(i.ruleName,{...e,repository:r},n);break;case 3:case 4:const c=i.scopeName===e.selfGrammar.scopeName?e.selfGrammar:i.scopeName===e.baseGrammar.scopeName?e.baseGrammar:void 0;if(c){const l={baseGrammar:e.baseGrammar,selfGrammar:c,repository:r};i.kind===4?Xt(i.ruleName,l,n):st(l,n)}else i.kind===4?n.add(new Na(i.scopeName,i.ruleName)):n.add(new je(i.scopeName));break}}}var Fa=class{kind=0},ja=class{kind=1},Ua=class{constructor(t){this.ruleName=t}kind=2},za=class{constructor(t){this.scopeName=t}kind=3},Wa=class{constructor(t,e){this.scopeName=t,this.ruleName=e}kind=4};function Vs(t){if(t==="$base")return new Fa;if(t==="$self")return new ja;const e=t.indexOf("#");if(e===-1)return new za(t);if(e===0)return new Ua(t.substring(1));{const n=t.substring(0,e),s=t.substring(e+1);return new Wa(n,s)}}var Ha=/\\(\d+)/,Gn=/\\(\d+)/g,qa=-1,Ks=-2;var qe=class{$location;id;_nameIsCapturing;_name;_contentNameIsCapturing;_contentName;constructor(t,e,n,s){this.$location=t,this.id=e,this._name=n||null,this._nameIsCapturing=Qe.hasCaptures(this._name),this._contentName=s||null,this._contentNameIsCapturing=Qe.hasCaptures(this._contentName)}get debugName(){const t=this.$location?`${Gs(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${t}`}getName(t,e){return!this._nameIsCapturing||this._name===null||t===null||e===null?this._name:Qe.replaceCaptures(this._name,t,e)}getContentName(t,e){return!this._contentNameIsCapturing||this._contentName===null?this._contentName:Qe.replaceCaptures(this._contentName,t,e)}},Va=class extends qe{retokenizeCapturedWithRuleId;constructor(t,e,n,s,r){super(t,e,n,s),this.retokenizeCapturedWithRuleId=r}dispose(){}collectPatterns(t,e){throw new Error("Not supported!")}compile(t,e){throw new Error("Not supported!")}compileAG(t,e,n,s){throw new Error("Not supported!")}},Ka=class extends qe{_match;captures;_cachedCompiledPatterns;constructor(t,e,n,s,r){super(t,e,n,null),this._match=new Ue(s,this.id),this.captures=r,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(t,e){e.push(this._match)}compile(t,e){return this._getCachedCompiledPatterns(t).compile(t)}compileAG(t,e,n,s){return this._getCachedCompiledPatterns(t).compileAG(t,n,s)}_getCachedCompiledPatterns(t){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new ze,this.collectPatterns(t,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},Fn=class extends qe{hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(t,e,n,s,r){super(t,e,n,s),this.patterns=r.patterns,this.hasMissingPatterns=r.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(t,e){for(const n of this.patterns)t.getRule(n).collectPatterns(t,e)}compile(t,e){return this._getCachedCompiledPatterns(t).compile(t)}compileAG(t,e,n,s){return this._getCachedCompiledPatterns(t).compileAG(t,n,s)}_getCachedCompiledPatterns(t){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new ze,this.collectPatterns(t,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},Qt=class extends qe{_begin;beginCaptures;_end;endHasBackReferences;endCaptures;applyEndPatternLast;hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(t,e,n,s,r,a,i,c,l,u){super(t,e,n,s),this._begin=new Ue(r,this.id),this.beginCaptures=a,this._end=new Ue(i||"￿",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=c,this.applyEndPatternLast=l||!1,this.patterns=u.patterns,this.hasMissingPatterns=u.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(t,e){return this._end.resolveBackReferences(t,e)}collectPatterns(t,e){e.push(this._begin)}compile(t,e){return this._getCachedCompiledPatterns(t,e).compile(t)}compileAG(t,e,n,s){return this._getCachedCompiledPatterns(t,e).compileAG(t,n,s)}_getCachedCompiledPatterns(t,e){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new ze;for(const n of this.patterns)t.getRule(n).collectPatterns(t,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,e):this._cachedCompiledPatterns.setSource(0,e)),this._cachedCompiledPatterns}},ct=class extends qe{_begin;beginCaptures;whileCaptures;_while;whileHasBackReferences;hasMissingPatterns;patterns;_cachedCompiledPatterns;_cachedCompiledWhilePatterns;constructor(t,e,n,s,r,a,i,c,l){super(t,e,n,s),this._begin=new Ue(r,this.id),this.beginCaptures=a,this.whileCaptures=c,this._while=new Ue(i,Ks),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=l.patterns,this.hasMissingPatterns=l.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(t,e){return this._while.resolveBackReferences(t,e)}collectPatterns(t,e){e.push(this._begin)}compile(t,e){return this._getCachedCompiledPatterns(t).compile(t)}compileAG(t,e,n,s){return this._getCachedCompiledPatterns(t).compileAG(t,n,s)}_getCachedCompiledPatterns(t){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new ze;for(const e of this.patterns)t.getRule(e).collectPatterns(t,this._cachedCompiledPatterns)}return this._cachedCompiledPatterns}compileWhile(t,e){return this._getCachedCompiledWhilePatterns(t,e).compile(t)}compileWhileAG(t,e,n,s){return this._getCachedCompiledWhilePatterns(t,e).compileAG(t,n,s)}_getCachedCompiledWhilePatterns(t,e){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new ze,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,e||"￿"),this._cachedCompiledWhilePatterns}},Xs=class F{static createCaptureRule(e,n,s,r,a){return e.registerRule(i=>new Va(n,i,s,r,a))}static getCompiledRuleId(e,n,s){return e.id||n.registerRule(r=>{if(e.id=r,e.match)return new Ka(e.$vscodeTextmateLocation,e.id,e.name,e.match,F._compileCaptures(e.captures,n,s));if(typeof e.begin>"u"){e.repository&&(s=Os({},s,e.repository));let a=e.patterns;return typeof a>"u"&&e.include&&(a=[{include:e.include}]),new Fn(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,F._compilePatterns(a,n,s))}return e.while?new ct(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,e.begin,F._compileCaptures(e.beginCaptures||e.captures,n,s),e.while,F._compileCaptures(e.whileCaptures||e.captures,n,s),F._compilePatterns(e.patterns,n,s)):new Qt(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,e.begin,F._compileCaptures(e.beginCaptures||e.captures,n,s),e.end,F._compileCaptures(e.endCaptures||e.captures,n,s),e.applyEndPatternLast,F._compilePatterns(e.patterns,n,s))}),e.id}static _compileCaptures(e,n,s){let r=[];if(e){let a=0;for(const i in e){if(i==="$vscodeTextmateLocation")continue;const c=parseInt(i,10);c>a&&(a=c)}for(let i=0;i<=a;i++)r[i]=null;for(const i in e){if(i==="$vscodeTextmateLocation")continue;const c=parseInt(i,10);let l=0;e[i].patterns&&(l=F.getCompiledRuleId(e[i],n,s)),r[c]=F.createCaptureRule(n,e[i].$vscodeTextmateLocation,e[i].name,e[i].contentName,l)}}return r}static _compilePatterns(e,n,s){let r=[];if(e)for(let a=0,i=e.length;a<i;a++){const c=e[a];let l=-1;if(c.include){const u=Vs(c.include);switch(u.kind){case 0:case 1:l=F.getCompiledRuleId(s[c.include],n,s);break;case 2:let h=s[u.ruleName];h&&(l=F.getCompiledRuleId(h,n,s));break;case 3:case 4:const p=u.scopeName,g=u.kind===4?u.ruleName:null,f=n.getExternalGrammar(p,s);if(f)if(g){let d=f.repository[g];d&&(l=F.getCompiledRuleId(d,n,f.repository))}else l=F.getCompiledRuleId(f.repository.$self,n,f.repository);break}}else l=F.getCompiledRuleId(c,n,s);if(l!==-1){const u=n.getRule(l);let h=!1;if((u instanceof Fn||u instanceof Qt||u instanceof ct)&&u.hasMissingPatterns&&u.patterns.length===0&&(h=!0),h)continue;r.push(l)}}return{patterns:r,hasMissingPatterns:(e?e.length:0)!==r.length}}},Ue=class Qs{source;ruleId;hasAnchor;hasBackReferences;_anchorCache;constructor(e,n){if(e&&typeof e=="string"){const s=e.length;let r=0,a=[],i=!1;for(let c=0;c<s;c++)if(e.charAt(c)==="\\"&&c+1<s){const u=e.charAt(c+1);u==="z"?(a.push(e.substring(r,c)),a.push("$(?!\\n)(?<!\\n)"),r=c+2):(u==="A"||u==="G")&&(i=!0),c++}this.hasAnchor=i,r===0?this.source=e:(a.push(e.substring(r,s)),this.source=a.join(""))}else this.hasAnchor=!1,this.source=e;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=n,typeof this.source=="string"?this.hasBackReferences=Ha.test(this.source):this.hasBackReferences=!1}clone(){return new Qs(this.source,this.ruleId)}setSource(e){this.source!==e&&(this.source=e,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(e,n){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let s=n.map(r=>e.substring(r.start,r.end));return Gn.lastIndex=0,this.source.replace(Gn,(r,a)=>Us(s[parseInt(a,10)]||""))}_buildAnchorCache(){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let e=[],n=[],s=[],r=[],a,i,c,l;for(a=0,i=this.source.length;a<i;a++)c=this.source.charAt(a),e[a]=c,n[a]=c,s[a]=c,r[a]=c,c==="\\"&&a+1<i&&(l=this.source.charAt(a+1),l==="A"?(e[a+1]="￿",n[a+1]="￿",s[a+1]="A",r[a+1]="A"):l==="G"?(e[a+1]="￿",n[a+1]="G",s[a+1]="￿",r[a+1]="G"):(e[a+1]=l,n[a+1]=l,s[a+1]=l,r[a+1]=l),a++);return{A0_G0:e.join(""),A0_G1:n.join(""),A1_G0:s.join(""),A1_G1:r.join("")}}resolveAnchors(e,n){return!this.hasAnchor||!this._anchorCache||typeof this.source!="string"?this.source:e?n?this._anchorCache.A1_G1:this._anchorCache.A1_G0:n?this._anchorCache.A0_G1:this._anchorCache.A0_G0}},ze=class{_items;_hasAnchors;_cached;_anchorCache;constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(t){this._items.push(t),this._hasAnchors=this._hasAnchors||t.hasAnchor}unshift(t){this._items.unshift(t),this._hasAnchors=this._hasAnchors||t.hasAnchor}length(){return this._items.length}setSource(t,e){this._items[t].source!==e&&(this._disposeCaches(),this._items[t].setSource(e))}compile(t){if(!this._cached){let e=this._items.map(n=>n.source);this._cached=new jn(t,e,this._items.map(n=>n.ruleId))}return this._cached}compileAG(t,e,n){return this._hasAnchors?e?n?(this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(t,e,n)),this._anchorCache.A1_G1):(this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(t,e,n)),this._anchorCache.A1_G0):n?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(t,e,n)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(t,e,n)),this._anchorCache.A0_G0):this.compile(t)}_resolveAnchors(t,e,n){let s=this._items.map(r=>r.resolveAnchors(e,n));return new jn(t,s,this._items.map(r=>r.ruleId))}},jn=class{constructor(t,e,n){this.regExps=e,this.rules=n,this.scanner=t.createOnigScanner(e)}scanner;dispose(){typeof this.scanner.dispose=="function"&&this.scanner.dispose()}toString(){const t=[];for(let e=0,n=this.rules.length;e<n;e++)t.push("   - "+this.rules[e]+": "+this.regExps[e]);return t.join(`
`)}findNextMatchSync(t,e,n){const s=this.scanner.findNextMatchSync(t,e,n);return s?{ruleId:this.rules[s.index],captureIndices:s.captureIndices}:null}},Rt=class{constructor(t,e){this.languageId=t,this.tokenType=e}},Xa=class Zt{_defaultAttributes;_embeddedLanguagesMatcher;constructor(e,n){this._defaultAttributes=new Rt(e,8),this._embeddedLanguagesMatcher=new Qa(Object.entries(n||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(e){return e===null?Zt._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(e)}static _NULL_SCOPE_METADATA=new Rt(0,0);_getBasicScopeAttributes=new zs(e=>{const n=this._scopeToLanguage(e),s=this._toStandardTokenType(e);return new Rt(n,s)});_scopeToLanguage(e){return this._embeddedLanguagesMatcher.match(e)||0}_toStandardTokenType(e){const n=e.match(Zt.STANDARD_TOKEN_TYPE_REGEXP);if(!n)return 8;switch(n[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw new Error("Unexpected match for standard token type!")}static STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/},Qa=class{values;scopesRegExp;constructor(t){if(t.length===0)this.values=null,this.scopesRegExp=null;else{this.values=new Map(t);const e=t.map(([n,s])=>Us(n));e.sort(),e.reverse(),this.scopesRegExp=new RegExp(`^((${e.join(")|(")}))($|\\.)`,"")}}match(t){if(!this.scopesRegExp)return;const e=t.match(this.scopesRegExp);if(e)return this.values.get(e[1])}},Un=class{constructor(t,e){this.stack=t,this.stoppedEarly=e}};function Zs(t,e,n,s,r,a,i,c){const l=e.content.length;let u=!1,h=-1;if(i){const f=Za(t,e,n,s,r,a);r=f.stack,s=f.linePos,n=f.isFirstLine,h=f.anchorPosition}const p=Date.now();for(;!u;){if(c!==0&&Date.now()-p>c)return new Un(r,!0);g()}return new Un(r,!1);function g(){const f=Ja(t,e,n,s,r,h);if(!f){a.produce(r,l),u=!0;return}const d=f.captureIndices,k=f.matchedRuleId,w=d&&d.length>0?d[0].end>s:!1;if(k===qa){const b=r.getRule(t);a.produce(r,d[0].start),r=r.withContentNameScopesList(r.nameScopesList),Ne(t,e,n,r,a,b.endCaptures,d),a.produce(r,d[0].end);const y=r;if(r=r.parent,h=y.getAnchorPos(),!w&&y.getEnterPos()===s){r=y,a.produce(r,l),u=!0;return}}else{const b=t.getRule(k);a.produce(r,d[0].start);const y=r,_=b.getName(e.content,d),A=r.contentNameScopesList.pushAttributed(_,t);if(r=r.push(k,s,h,d[0].end===l,null,A,A),b instanceof Qt){const v=b;Ne(t,e,n,r,a,v.beginCaptures,d),a.produce(r,d[0].end),h=d[0].end;const D=v.getContentName(e.content,d),I=A.pushAttributed(D,t);if(r=r.withContentNameScopesList(I),v.endHasBackReferences&&(r=r.withEndRule(v.getEndWithResolvedBackReferences(e.content,d))),!w&&y.hasSameRuleAs(r)){r=r.pop(),a.produce(r,l),u=!0;return}}else if(b instanceof ct){const v=b;Ne(t,e,n,r,a,v.beginCaptures,d),a.produce(r,d[0].end),h=d[0].end;const D=v.getContentName(e.content,d),I=A.pushAttributed(D,t);if(r=r.withContentNameScopesList(I),v.whileHasBackReferences&&(r=r.withEndRule(v.getWhileWithResolvedBackReferences(e.content,d))),!w&&y.hasSameRuleAs(r)){r=r.pop(),a.produce(r,l),u=!0;return}}else if(Ne(t,e,n,r,a,b.captures,d),a.produce(r,d[0].end),r=r.pop(),!w){r=r.safePop(),a.produce(r,l),u=!0;return}}d[0].end>s&&(s=d[0].end,n=!1)}}function Za(t,e,n,s,r,a){let i=r.beginRuleCapturedEOL?0:-1;const c=[];for(let l=r;l;l=l.pop()){const u=l.getRule(t);u instanceof ct&&c.push({rule:u,stack:l})}for(let l=c.pop();l;l=c.pop()){const{ruleScanner:u,findOptions:h}=ti(l.rule,t,l.stack.endRule,n,s===i),p=u.findNextMatchSync(e,s,h);if(p){if(p.ruleId!==Ks){r=l.stack.pop();break}p.captureIndices&&p.captureIndices.length&&(a.produce(l.stack,p.captureIndices[0].start),Ne(t,e,n,l.stack,a,l.rule.whileCaptures,p.captureIndices),a.produce(l.stack,p.captureIndices[0].end),i=p.captureIndices[0].end,p.captureIndices[0].end>s&&(s=p.captureIndices[0].end,n=!1))}else{r=l.stack.pop();break}}return{stack:r,linePos:s,anchorPosition:i,isFirstLine:n}}function Ja(t,e,n,s,r,a){const i=Ya(t,e,n,s,r,a),c=t.getInjections();if(c.length===0)return i;const l=ei(c,t,e,n,s,r,a);if(!l)return i;if(!i)return l;const u=i.captureIndices[0].start,h=l.captureIndices[0].start;return h<u||l.priorityMatch&&h===u?l:i}function Ya(t,e,n,s,r,a){const i=r.getRule(t),{ruleScanner:c,findOptions:l}=Js(i,t,r.endRule,n,s===a),u=c.findNextMatchSync(e,s,l);return u?{captureIndices:u.captureIndices,matchedRuleId:u.ruleId}:null}function ei(t,e,n,s,r,a,i){let c=Number.MAX_VALUE,l=null,u,h=0;const p=a.contentNameScopesList.getScopeNames();for(let g=0,f=t.length;g<f;g++){const d=t[g];if(!d.matcher(p))continue;const k=e.getRule(d.ruleId),{ruleScanner:w,findOptions:b}=Js(k,e,null,s,r===i),y=w.findNextMatchSync(n,r,b);if(!y)continue;const _=y.captureIndices[0].start;if(!(_>=c)&&(c=_,l=y.captureIndices,u=y.ruleId,h=d.priority,c===r))break}return l?{priorityMatch:h===-1,captureIndices:l,matchedRuleId:u}:null}function Js(t,e,n,s,r){return{ruleScanner:t.compileAG(e,n,s,r),findOptions:0}}function ti(t,e,n,s,r){return{ruleScanner:t.compileWhileAG(e,n,s,r),findOptions:0}}function Ne(t,e,n,s,r,a,i){if(a.length===0)return;const c=e.content,l=Math.min(a.length,i.length),u=[],h=i[0].end;for(let p=0;p<l;p++){const g=a[p];if(g===null)continue;const f=i[p];if(f.length===0)continue;if(f.start>h)break;for(;u.length>0&&u[u.length-1].endPos<=f.start;)r.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop();if(u.length>0?r.produceFromScopes(u[u.length-1].scopes,f.start):r.produce(s,f.start),g.retokenizeCapturedWithRuleId){const k=g.getName(c,i),w=s.contentNameScopesList.pushAttributed(k,t),b=g.getContentName(c,i),y=w.pushAttributed(b,t),_=s.push(g.retokenizeCapturedWithRuleId,f.start,-1,!1,null,w,y),A=t.createOnigString(c.substring(0,f.end));Zs(t,A,n&&f.start===0,f.start,_,r,!1,0),qs(A);continue}const d=g.getName(c,i);if(d!==null){const w=(u.length>0?u[u.length-1].scopes:s.contentNameScopesList).pushAttributed(d,t);u.push(new ni(w,f.end))}}for(;u.length>0;)r.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop()}var ni=class{scopes;endPos;constructor(t,e){this.scopes=t,this.endPos=e}};function si(t,e,n,s,r,a,i,c){return new ai(t,e,n,s,r,a,i,c)}function zn(t,e,n,s,r){const a=ot(e,ut),i=Xs.getCompiledRuleId(n,s,r.repository);for(const c of a)t.push({debugSelector:e,matcher:c.matcher,ruleId:i,grammar:r,priority:c.priority})}function ut(t,e){if(e.length<t.length)return!1;let n=0;return t.every(s=>{for(let r=n;r<e.length;r++)if(ri(e[r],s))return n=r+1,!0;return!1})}function ri(t,e){if(!t)return!1;if(t===e)return!0;const n=e.length;return t.length>n&&t.substr(0,n)===e&&t[n]==="."}var ai=class{constructor(t,e,n,s,r,a,i,c){if(this._rootScopeName=t,this.balancedBracketSelectors=a,this._onigLib=c,this._basicScopeAttributesProvider=new Xa(n,s),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=i,this._grammar=Wn(e,null),this._injections=null,this._tokenTypeMatchers=[],r)for(const l of Object.keys(r)){const u=ot(l,ut);for(const h of u)this._tokenTypeMatchers.push({matcher:h.matcher,type:r[l]})}}_rootId;_lastRuleId;_ruleId2desc;_includedGrammars;_grammarRepository;_grammar;_injections;_basicScopeAttributesProvider;_tokenTypeMatchers;get themeProvider(){return this._grammarRepository}dispose(){for(const t of this._ruleId2desc)t&&t.dispose()}createOnigScanner(t){return this._onigLib.createOnigScanner(t)}createOnigString(t){return this._onigLib.createOnigString(t)}getMetadataForScope(t){return this._basicScopeAttributesProvider.getBasicScopeAttributes(t)}_collectInjections(){const t={lookup:r=>r===this._rootScopeName?this._grammar:this.getExternalGrammar(r),injections:r=>this._grammarRepository.injections(r)},e=[],n=this._rootScopeName,s=t.lookup(n);if(s){const r=s.injections;if(r)for(let i in r)zn(e,i,r[i],this,s);const a=this._grammarRepository.injections(n);a&&a.forEach(i=>{const c=this.getExternalGrammar(i);if(c){const l=c.injectionSelector;l&&zn(e,l,c,this,c)}})}return e.sort((r,a)=>r.priority-a.priority),e}getInjections(){return this._injections===null&&(this._injections=this._collectInjections()),this._injections}registerRule(t){const e=++this._lastRuleId,n=t(e);return this._ruleId2desc[e]=n,n}getRule(t){return this._ruleId2desc[t]}getExternalGrammar(t,e){if(this._includedGrammars[t])return this._includedGrammars[t];if(this._grammarRepository){const n=this._grammarRepository.lookup(t);if(n)return this._includedGrammars[t]=Wn(n,e&&e.$base),this._includedGrammars[t]}}tokenizeLine(t,e,n=0){const s=this._tokenize(t,e,!1,n);return{tokens:s.lineTokens.getResult(s.ruleStack,s.lineLength),ruleStack:s.ruleStack,stoppedEarly:s.stoppedEarly}}tokenizeLine2(t,e,n=0){const s=this._tokenize(t,e,!0,n);return{tokens:s.lineTokens.getBinaryResult(s.ruleStack,s.lineLength),ruleStack:s.ruleStack,stoppedEarly:s.stoppedEarly}}_tokenize(t,e,n,s){this._rootId===-1&&(this._rootId=Xs.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository),this.getInjections());let r;if(!e||e===Jt.NULL){r=!0;const u=this._basicScopeAttributesProvider.getDefaultAttributes(),h=this.themeProvider.getDefaults(),p=Be.set(0,u.languageId,u.tokenType,null,h.fontStyle,h.foregroundId,h.backgroundId),g=this.getRule(this._rootId).getName(null,null);let f;g?f=Oe.createRootAndLookUpScopeName(g,p,this):f=Oe.createRoot("unknown",p),e=new Jt(null,this._rootId,-1,-1,!1,null,f,f)}else r=!1,e.reset();t=t+`
`;const a=this.createOnigString(t),i=a.content.length,c=new oi(n,t,this._tokenTypeMatchers,this.balancedBracketSelectors),l=Zs(this,a,r,0,e,c,!0,s);return qs(a),{lineLength:i,lineTokens:c,ruleStack:l.stack,stoppedEarly:l.stoppedEarly}}};function Wn(t,e){return t=va(t),t.repository=t.repository||{},t.repository.$self={$vscodeTextmateLocation:t.$vscodeTextmateLocation,patterns:t.patterns,name:t.scopeName},t.repository.$base=e||t.repository.$self,t}var Oe=class Z{constructor(e,n,s){this.parent=e,this.scopePath=n,this.tokenAttributes=s}static fromExtension(e,n){let s=e,r=e?.scopePath??null;for(const a of n)r=It.push(r,a.scopeNames),s=new Z(s,r,a.encodedTokenAttributes);return s}static createRoot(e,n){return new Z(null,new It(null,e),n)}static createRootAndLookUpScopeName(e,n,s){const r=s.getMetadataForScope(e),a=new It(null,e),i=s.themeProvider.themeMatch(a),c=Z.mergeAttributes(n,r,i);return new Z(null,a,c)}get scopeName(){return this.scopePath.scopeName}toString(){return this.getScopeNames().join(" ")}equals(e){return Z.equals(this,e)}static equals(e,n){do{if(e===n||!e&&!n)return!0;if(!e||!n||e.scopeName!==n.scopeName||e.tokenAttributes!==n.tokenAttributes)return!1;e=e.parent,n=n.parent}while(!0)}static mergeAttributes(e,n,s){let r=-1,a=0,i=0;return s!==null&&(r=s.fontStyle,a=s.foregroundId,i=s.backgroundId),Be.set(e,n.languageId,n.tokenType,null,r,a,i)}pushAttributed(e,n){if(e===null)return this;if(e.indexOf(" ")===-1)return Z._pushAttributed(this,e,n);const s=e.split(/ /g);let r=this;for(const a of s)r=Z._pushAttributed(r,a,n);return r}static _pushAttributed(e,n,s){const r=s.getMetadataForScope(n),a=e.scopePath.push(n),i=s.themeProvider.themeMatch(a),c=Z.mergeAttributes(e.tokenAttributes,r,i);return new Z(e,a,c)}getScopeNames(){return this.scopePath.getSegments()}getExtensionIfDefined(e){const n=[];let s=this;for(;s&&s!==e;)n.push({encodedTokenAttributes:s.tokenAttributes,scopeNames:s.scopePath.getExtensionIfDefined(s.parent?.scopePath??null)}),s=s.parent;return s===e?n.reverse():void 0}},Jt=class de{constructor(e,n,s,r,a,i,c,l){this.parent=e,this.ruleId=n,this.beginRuleCapturedEOL=a,this.endRule=i,this.nameScopesList=c,this.contentNameScopesList=l,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=s,this._anchorPos=r}_stackElementBrand=void 0;static NULL=new de(null,0,0,0,!1,null,null,null);_enterPos;_anchorPos;depth;equals(e){return e===null?!1:de._equals(this,e)}static _equals(e,n){return e===n?!0:this._structuralEquals(e,n)?Oe.equals(e.contentNameScopesList,n.contentNameScopesList):!1}static _structuralEquals(e,n){do{if(e===n||!e&&!n)return!0;if(!e||!n||e.depth!==n.depth||e.ruleId!==n.ruleId||e.endRule!==n.endRule)return!1;e=e.parent,n=n.parent}while(!0)}clone(){return this}static _reset(e){for(;e;)e._enterPos=-1,e._anchorPos=-1,e=e.parent}reset(){de._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(e,n,s,r,a,i,c){return new de(this,e,n,s,r,a,i,c)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(e){return e.getRule(this.ruleId)}toString(){const e=[];return this._writeString(e,0),"["+e.join(",")+"]"}_writeString(e,n){return this.parent&&(n=this.parent._writeString(e,n)),e[n++]=`(${this.ruleId}, ${this.nameScopesList?.toString()}, ${this.contentNameScopesList?.toString()})`,n}withContentNameScopesList(e){return this.contentNameScopesList===e?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,e)}withEndRule(e){return this.endRule===e?this:new de(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,e,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(e){let n=this;for(;n&&n._enterPos===e._enterPos;){if(n.ruleId===e.ruleId)return!0;n=n.parent}return!1}toStateStackFrame(){return{ruleId:this.ruleId,beginRuleCapturedEOL:this.beginRuleCapturedEOL,endRule:this.endRule,nameScopesList:this.nameScopesList?.getExtensionIfDefined(this.parent?.nameScopesList??null)??[],contentNameScopesList:this.contentNameScopesList?.getExtensionIfDefined(this.nameScopesList)??[]}}static pushFrame(e,n){const s=Oe.fromExtension(e?.nameScopesList??null,n.nameScopesList);return new de(e,n.ruleId,n.enterPos??-1,n.anchorPos??-1,n.beginRuleCapturedEOL,n.endRule,s,Oe.fromExtension(s,n.contentNameScopesList))}},ii=class{balancedBracketScopes;unbalancedBracketScopes;allowAny=!1;constructor(t,e){this.balancedBracketScopes=t.flatMap(n=>n==="*"?(this.allowAny=!0,[]):ot(n,ut).map(s=>s.matcher)),this.unbalancedBracketScopes=e.flatMap(n=>ot(n,ut).map(s=>s.matcher))}get matchesAlways(){return this.allowAny&&this.unbalancedBracketScopes.length===0}get matchesNever(){return this.balancedBracketScopes.length===0&&!this.allowAny}match(t){for(const e of this.unbalancedBracketScopes)if(e(t))return!1;for(const e of this.balancedBracketScopes)if(e(t))return!0;return this.allowAny}},oi=class{constructor(t,e,n,s){this.balancedBracketSelectors=s,this._emitBinaryTokens=t,this._tokenTypeOverrides=n,this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}_emitBinaryTokens;_lineText;_tokens;_binaryTokens;_lastTokenEndIndex;_tokenTypeOverrides;produce(t,e){this.produceFromScopes(t.contentNameScopesList,e)}produceFromScopes(t,e){if(this._lastTokenEndIndex>=e)return;if(this._emitBinaryTokens){let s=t?.tokenAttributes??0,r=!1;if(this.balancedBracketSelectors?.matchesAlways&&(r=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){const a=t?.getScopeNames()??[];for(const i of this._tokenTypeOverrides)i.matcher(a)&&(s=Be.set(s,0,i.type,null,-1,0,0));this.balancedBracketSelectors&&(r=this.balancedBracketSelectors.match(a))}if(r&&(s=Be.set(s,0,8,r,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===s){this._lastTokenEndIndex=e;return}this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(s),this._lastTokenEndIndex=e;return}const n=t?.getScopeNames()??[];this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:e,scopes:n}),this._lastTokenEndIndex=e}getResult(t,e){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===e-1&&this._tokens.pop(),this._tokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(t,e),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(t,e){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===e-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),this._binaryTokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(t,e),this._binaryTokens[this._binaryTokens.length-2]=0);const n=new Uint32Array(this._binaryTokens.length);for(let s=0,r=this._binaryTokens.length;s<r;s++)n[s]=this._binaryTokens[s];return n}},li=class{constructor(t,e){this._onigLib=e,this._theme=t}_grammars=new Map;_rawGrammars=new Map;_injectionGrammars=new Map;_theme;dispose(){for(const t of this._grammars.values())t.dispose()}setTheme(t){this._theme=t}getColorMap(){return this._theme.getColorMap()}addGrammar(t,e){this._rawGrammars.set(t.scopeName,t),e&&this._injectionGrammars.set(t.scopeName,e)}lookup(t){return this._rawGrammars.get(t)}injections(t){return this._injectionGrammars.get(t)}getDefaults(){return this._theme.getDefaults()}themeMatch(t){return this._theme.match(t)}grammarForScopeName(t,e,n,s,r){if(!this._grammars.has(t)){let a=this._rawGrammars.get(t);if(!a)return null;this._grammars.set(t,si(t,a,e,n,s,r,this,this._onigLib))}return this._grammars.get(t)}},ci=class{_options;_syncRegistry;_ensureGrammarCache;constructor(e){this._options=e,this._syncRegistry=new li(it.createFromRawTheme(e.theme,e.colorMap),e.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(e,n){this._syncRegistry.setTheme(it.createFromRawTheme(e,n))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(e,n,s){return this.loadGrammarWithConfiguration(e,n,{embeddedLanguages:s})}loadGrammarWithConfiguration(e,n,s){return this._loadGrammar(e,n,s.embeddedLanguages,s.tokenTypes,new ii(s.balancedBracketSelectors||[],s.unbalancedBracketSelectors||[]))}loadGrammar(e){return this._loadGrammar(e,0,null,null,null)}_loadGrammar(e,n,s,r,a){const i=new Oa(this._syncRegistry,e);for(;i.Q.length>0;)i.Q.map(c=>this._loadSingleGrammar(c.scopeName)),i.processQueue();return this._grammarForScopeName(e,n,s,r,a)}_loadSingleGrammar(e){this._ensureGrammarCache.has(e)||(this._doLoadSingleGrammar(e),this._ensureGrammarCache.set(e,!0))}_doLoadSingleGrammar(e){const n=this._options.loadGrammar(e);if(n){const s=typeof this._options.getInjections=="function"?this._options.getInjections(e):void 0;this._syncRegistry.addGrammar(n,s)}}addGrammar(e,n=[],s=0,r=null){return this._syncRegistry.addGrammar(e,n),this._grammarForScopeName(e.scopeName,s,r)}_grammarForScopeName(e,n=0,s=null,r=null,a=null){return this._syncRegistry.grammarForScopeName(e,n,s,r,a)}},Yt=Jt.NULL;const ui=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"];class Ve{constructor(e,n,s){this.normal=n,this.property=e,s&&(this.space=s)}}Ve.prototype.normal={};Ve.prototype.property={};Ve.prototype.space=void 0;function Ys(t,e){const n={},s={};for(const r of t)Object.assign(n,r.property),Object.assign(s,r.normal);return new Ve(n,s,e)}function en(t){return t.toLowerCase()}class U{constructor(e,n){this.attribute=n,this.property=e}}U.prototype.attribute="";U.prototype.booleanish=!1;U.prototype.boolean=!1;U.prototype.commaOrSpaceSeparated=!1;U.prototype.commaSeparated=!1;U.prototype.defined=!1;U.prototype.mustUseProperty=!1;U.prototype.number=!1;U.prototype.overloadedBoolean=!1;U.prototype.property="";U.prototype.spaceSeparated=!1;U.prototype.space=void 0;let hi=0;const E=we(),L=we(),er=we(),C=we(),B=we(),xe=we(),z=we();function we(){return 2**++hi}const tn=Object.freeze(Object.defineProperty({__proto__:null,boolean:E,booleanish:L,commaOrSpaceSeparated:z,commaSeparated:xe,number:C,overloadedBoolean:er,spaceSeparated:B},Symbol.toStringTag,{value:"Module"})),$t=Object.keys(tn);class gn extends U{constructor(e,n,s,r){let a=-1;if(super(e,n),Hn(this,"space",r),typeof s=="number")for(;++a<$t.length;){const i=$t[a];Hn(this,$t[a],(s&tn[i])===tn[i])}}}gn.prototype.defined=!0;function Hn(t,e,n){n&&(t[e]=n)}function Ie(t){const e={},n={};for(const[s,r]of Object.entries(t.properties)){const a=new gn(s,t.transform(t.attributes||{},s),r,t.space);t.mustUseProperty&&t.mustUseProperty.includes(s)&&(a.mustUseProperty=!0),e[s]=a,n[en(s)]=s,n[en(a.attribute)]=s}return new Ve(e,n,t.space)}const tr=Ie({properties:{ariaActiveDescendant:null,ariaAtomic:L,ariaAutoComplete:null,ariaBusy:L,ariaChecked:L,ariaColCount:C,ariaColIndex:C,ariaColSpan:C,ariaControls:B,ariaCurrent:null,ariaDescribedBy:B,ariaDetails:null,ariaDisabled:L,ariaDropEffect:B,ariaErrorMessage:null,ariaExpanded:L,ariaFlowTo:B,ariaGrabbed:L,ariaHasPopup:null,ariaHidden:L,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:B,ariaLevel:C,ariaLive:null,ariaModal:L,ariaMultiLine:L,ariaMultiSelectable:L,ariaOrientation:null,ariaOwns:B,ariaPlaceholder:null,ariaPosInSet:C,ariaPressed:L,ariaReadOnly:L,ariaRelevant:null,ariaRequired:L,ariaRoleDescription:B,ariaRowCount:C,ariaRowIndex:C,ariaRowSpan:C,ariaSelected:L,ariaSetSize:C,ariaSort:null,ariaValueMax:C,ariaValueMin:C,ariaValueNow:C,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function nr(t,e){return e in t?t[e]:e}function sr(t,e){return nr(t,e.toLowerCase())}const pi=Ie({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:xe,acceptCharset:B,accessKey:B,action:null,allow:null,allowFullScreen:E,allowPaymentRequest:E,allowUserMedia:E,alt:null,as:null,async:E,autoCapitalize:null,autoComplete:B,autoFocus:E,autoPlay:E,blocking:B,capture:null,charSet:null,checked:E,cite:null,className:B,cols:C,colSpan:null,content:null,contentEditable:L,controls:E,controlsList:B,coords:C|xe,crossOrigin:null,data:null,dateTime:null,decoding:null,default:E,defer:E,dir:null,dirName:null,disabled:E,download:er,draggable:L,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:E,formTarget:null,headers:B,height:C,hidden:E,high:C,href:null,hrefLang:null,htmlFor:B,httpEquiv:B,id:null,imageSizes:null,imageSrcSet:null,inert:E,inputMode:null,integrity:null,is:null,isMap:E,itemId:null,itemProp:B,itemRef:B,itemScope:E,itemType:B,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:E,low:C,manifest:null,max:null,maxLength:C,media:null,method:null,min:null,minLength:C,multiple:E,muted:E,name:null,nonce:null,noModule:E,noValidate:E,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:E,optimum:C,pattern:null,ping:B,placeholder:null,playsInline:E,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:E,referrerPolicy:null,rel:B,required:E,reversed:E,rows:C,rowSpan:C,sandbox:B,scope:null,scoped:E,seamless:E,selected:E,shadowRootClonable:E,shadowRootDelegatesFocus:E,shadowRootMode:null,shape:null,size:C,sizes:null,slot:null,span:C,spellCheck:L,src:null,srcDoc:null,srcLang:null,srcSet:null,start:C,step:null,style:null,tabIndex:C,target:null,title:null,translate:null,type:null,typeMustMatch:E,useMap:null,value:L,width:C,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:B,axis:null,background:null,bgColor:null,border:C,borderColor:null,bottomMargin:C,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:E,declare:E,event:null,face:null,frame:null,frameBorder:null,hSpace:C,leftMargin:C,link:null,longDesc:null,lowSrc:null,marginHeight:C,marginWidth:C,noResize:E,noHref:E,noShade:E,noWrap:E,object:null,profile:null,prompt:null,rev:null,rightMargin:C,rules:null,scheme:null,scrolling:L,standby:null,summary:null,text:null,topMargin:C,valueType:null,version:null,vAlign:null,vLink:null,vSpace:C,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:E,disableRemotePlayback:E,prefix:null,property:null,results:C,security:null,unselectable:null},space:"html",transform:sr}),di=Ie({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:z,accentHeight:C,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:C,amplitude:C,arabicForm:null,ascent:C,attributeName:null,attributeType:null,azimuth:C,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:C,by:null,calcMode:null,capHeight:C,className:B,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:C,diffuseConstant:C,direction:null,display:null,dur:null,divisor:C,dominantBaseline:null,download:E,dx:null,dy:null,edgeMode:null,editable:null,elevation:C,enableBackground:null,end:null,event:null,exponent:C,externalResourcesRequired:null,fill:null,fillOpacity:C,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:xe,g2:xe,glyphName:xe,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:C,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:C,horizOriginX:C,horizOriginY:C,id:null,ideographic:C,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:C,k:C,k1:C,k2:C,k3:C,k4:C,kernelMatrix:z,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:C,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:C,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:C,overlineThickness:C,paintOrder:null,panose1:null,path:null,pathLength:C,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:B,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:C,pointsAtY:C,pointsAtZ:C,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:z,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:z,rev:z,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:z,requiredFeatures:z,requiredFonts:z,requiredFormats:z,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:C,specularExponent:C,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:C,strikethroughThickness:C,string:null,stroke:null,strokeDashArray:z,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:C,strokeOpacity:C,strokeWidth:null,style:null,surfaceScale:C,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:z,tabIndex:C,tableValues:null,target:null,targetX:C,targetY:C,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:z,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:C,underlineThickness:C,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:C,values:null,vAlphabetic:C,vMathematical:C,vectorEffect:null,vHanging:C,vIdeographic:C,version:null,vertAdvY:C,vertOriginX:C,vertOriginY:C,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:C,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:nr}),rr=Ie({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),ar=Ie({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:sr}),ir=Ie({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),gi=/[A-Z]/g,qn=/-[a-z]/g,fi=/^data[-\w.:]+$/i;function mi(t,e){const n=en(e);let s=e,r=U;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&fi.test(e)){if(e.charAt(4)==="-"){const a=e.slice(5).replace(qn,ki);s="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=e.slice(4);if(!qn.test(a)){let i=a.replace(gi,yi);i.charAt(0)!=="-"&&(i="-"+i),e="data"+i}}r=gn}return new r(s,e)}function yi(t){return"-"+t.toLowerCase()}function ki(t){return t.charAt(1).toUpperCase()}const bi=Ys([tr,pi,rr,ar,ir],"html"),or=Ys([tr,di,rr,ar,ir],"svg"),Vn={}.hasOwnProperty;function wi(t,e){const n=e||{};function s(r,...a){let i=s.invalid;const c=s.handlers;if(r&&Vn.call(r,t)){const l=String(r[t]);i=Vn.call(c,l)?c[l]:s.unknown}if(i)return i.call(this,r,...a)}return s.handlers=n.handlers||{},s.invalid=n.invalid,s.unknown=n.unknown,s}const Ci=/["&'<>`]/g,_i=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ai=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,vi=/[|\\{}()[\]^$+*?.]/g,Kn=new WeakMap;function Si(t,e){if(t=t.replace(e.subset?Ei(e.subset):Ci,s),e.subset||e.escapeOnly)return t;return t.replace(_i,n).replace(Ai,s);function n(r,a,i){return e.format((r.charCodeAt(0)-55296)*1024+r.charCodeAt(1)-56320+65536,i.charCodeAt(a+2),e)}function s(r,a,i){return e.format(r.charCodeAt(0),i.charCodeAt(a+1),e)}}function Ei(t){let e=Kn.get(t);return e||(e=xi(t),Kn.set(t,e)),e}function xi(t){const e=[];let n=-1;for(;++n<t.length;)e.push(t[n].replace(vi,"\\$&"));return new RegExp("(?:"+e.join("|")+")","g")}const Di=/[\dA-Fa-f]/;function Bi(t,e,n){const s="&#x"+t.toString(16).toUpperCase();return n&&e&&!Di.test(String.fromCharCode(e))?s:s+";"}const Ii=/\d/;function Ri(t,e,n){const s="&#"+String(t);return n&&e&&!Ii.test(String.fromCharCode(e))?s:s+";"}const $i=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],Lt={nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",fnof:"ƒ",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",bull:"•",hellip:"…",prime:"′",Prime:"″",oline:"‾",frasl:"⁄",weierp:"℘",image:"ℑ",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",lang:"〈",rang:"〉",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",quot:'"',amp:"&",lt:"<",gt:">",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",permil:"‰",lsaquo:"‹",rsaquo:"›",euro:"€"},Li=["cent","copy","divide","gt","lt","not","para","times"],lr={}.hasOwnProperty,nn={};let Ze;for(Ze in Lt)lr.call(Lt,Ze)&&(nn[Lt[Ze]]=Ze);const Mi=/[^\dA-Za-z]/;function Ti(t,e,n,s){const r=String.fromCharCode(t);if(lr.call(nn,r)){const a=nn[r],i="&"+a;return n&&$i.includes(a)&&!Li.includes(a)&&(!s||e&&e!==61&&Mi.test(String.fromCharCode(e)))?i:i+";"}return""}function Ni(t,e,n){let s=Bi(t,e,n.omitOptionalSemicolons),r;if((n.useNamedReferences||n.useShortestReferences)&&(r=Ti(t,e,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!r)&&n.useShortestReferences){const a=Ri(t,e,n.omitOptionalSemicolons);a.length<s.length&&(s=a)}return r&&(!n.useShortestReferences||r.length<s.length)?r:s}function De(t,e){return Si(t,Object.assign({format:Ni},e))}const Pi=/^>|^->|<!--|-->|--!>|<!-$/g,Oi=[">"],Gi=["<",">"];function Fi(t,e,n,s){return s.settings.bogusComments?"<?"+De(t.value,Object.assign({},s.settings.characterReferences,{subset:Oi}))+">":"<!--"+t.value.replace(Pi,r)+"-->";function r(a){return De(a,Object.assign({},s.settings.characterReferences,{subset:Gi}))}}function ji(t,e,n,s){return"<!"+(s.settings.upperDoctype?"DOCTYPE":"doctype")+(s.settings.tightDoctype?"":" ")+"html>"}function Xn(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let s=0,r=n.indexOf(e);for(;r!==-1;)s++,r=n.indexOf(e,r+e.length);return s}function Ui(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}function zi(t){return t.join(" ").trim()}const Wi=/[ \t\n\f\r]/g;function fn(t){return typeof t=="object"?t.type==="text"?Qn(t.value):!1:Qn(t)}function Qn(t){return t.replace(Wi,"")===""}const N=ur(1),cr=ur(-1),Hi=[];function ur(t){return e;function e(n,s,r){const a=n?n.children:Hi;let i=(s||0)+t,c=a[i];if(!r)for(;c&&fn(c);)i+=t,c=a[i];return c}}const qi={}.hasOwnProperty;function hr(t){return e;function e(n,s,r){return qi.call(t,n.tagName)&&t[n.tagName](n,s,r)}}const mn=hr({body:Ki,caption:Mt,colgroup:Mt,dd:Ji,dt:Zi,head:Mt,html:Vi,li:Qi,optgroup:Yi,option:eo,p:Xi,rp:Zn,rt:Zn,tbody:no,td:Jn,tfoot:so,th:Jn,thead:to,tr:ro});function Mt(t,e,n){const s=N(n,e,!0);return!s||s.type!=="comment"&&!(s.type==="text"&&fn(s.value.charAt(0)))}function Vi(t,e,n){const s=N(n,e);return!s||s.type!=="comment"}function Ki(t,e,n){const s=N(n,e);return!s||s.type!=="comment"}function Xi(t,e,n){const s=N(n,e);return s?s.type==="element"&&(s.tagName==="address"||s.tagName==="article"||s.tagName==="aside"||s.tagName==="blockquote"||s.tagName==="details"||s.tagName==="div"||s.tagName==="dl"||s.tagName==="fieldset"||s.tagName==="figcaption"||s.tagName==="figure"||s.tagName==="footer"||s.tagName==="form"||s.tagName==="h1"||s.tagName==="h2"||s.tagName==="h3"||s.tagName==="h4"||s.tagName==="h5"||s.tagName==="h6"||s.tagName==="header"||s.tagName==="hgroup"||s.tagName==="hr"||s.tagName==="main"||s.tagName==="menu"||s.tagName==="nav"||s.tagName==="ol"||s.tagName==="p"||s.tagName==="pre"||s.tagName==="section"||s.tagName==="table"||s.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function Qi(t,e,n){const s=N(n,e);return!s||s.type==="element"&&s.tagName==="li"}function Zi(t,e,n){const s=N(n,e);return!!(s&&s.type==="element"&&(s.tagName==="dt"||s.tagName==="dd"))}function Ji(t,e,n){const s=N(n,e);return!s||s.type==="element"&&(s.tagName==="dt"||s.tagName==="dd")}function Zn(t,e,n){const s=N(n,e);return!s||s.type==="element"&&(s.tagName==="rp"||s.tagName==="rt")}function Yi(t,e,n){const s=N(n,e);return!s||s.type==="element"&&s.tagName==="optgroup"}function eo(t,e,n){const s=N(n,e);return!s||s.type==="element"&&(s.tagName==="option"||s.tagName==="optgroup")}function to(t,e,n){const s=N(n,e);return!!(s&&s.type==="element"&&(s.tagName==="tbody"||s.tagName==="tfoot"))}function no(t,e,n){const s=N(n,e);return!s||s.type==="element"&&(s.tagName==="tbody"||s.tagName==="tfoot")}function so(t,e,n){return!N(n,e)}function ro(t,e,n){const s=N(n,e);return!s||s.type==="element"&&s.tagName==="tr"}function Jn(t,e,n){const s=N(n,e);return!s||s.type==="element"&&(s.tagName==="td"||s.tagName==="th")}const ao=hr({body:lo,colgroup:co,head:oo,html:io,tbody:uo});function io(t){const e=N(t,-1);return!e||e.type!=="comment"}function oo(t){const e=new Set;for(const s of t.children)if(s.type==="element"&&(s.tagName==="base"||s.tagName==="title")){if(e.has(s.tagName))return!1;e.add(s.tagName)}const n=t.children[0];return!n||n.type==="element"}function lo(t){const e=N(t,-1,!0);return!e||e.type!=="comment"&&!(e.type==="text"&&fn(e.value.charAt(0)))&&!(e.type==="element"&&(e.tagName==="meta"||e.tagName==="link"||e.tagName==="script"||e.tagName==="style"||e.tagName==="template"))}function co(t,e,n){const s=cr(n,e),r=N(t,-1,!0);return n&&s&&s.type==="element"&&s.tagName==="colgroup"&&mn(s,n.children.indexOf(s),n)?!1:!!(r&&r.type==="element"&&r.tagName==="col")}function uo(t,e,n){const s=cr(n,e),r=N(t,-1);return n&&s&&s.type==="element"&&(s.tagName==="thead"||s.tagName==="tbody")&&mn(s,n.children.indexOf(s),n)?!1:!!(r&&r.type==="element"&&r.tagName==="tr")}const Je={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function ho(t,e,n,s){const r=s.schema,a=r.space==="svg"?!1:s.settings.omitOptionalTags;let i=r.space==="svg"?s.settings.closeEmptyElements:s.settings.voids.includes(t.tagName.toLowerCase());const c=[];let l;r.space==="html"&&t.tagName==="svg"&&(s.schema=or);const u=po(s,t.properties),h=s.all(r.space==="html"&&t.tagName==="template"?t.content:t);return s.schema=r,h&&(i=!1),(u||!a||!ao(t,e,n))&&(c.push("<",t.tagName,u?" "+u:""),i&&(r.space==="svg"||s.settings.closeSelfClosing)&&(l=u.charAt(u.length-1),(!s.settings.tightSelfClosing||l==="/"||l&&l!=='"'&&l!=="'")&&c.push(" "),c.push("/")),c.push(">")),c.push(h),!i&&(!a||!mn(t,e,n))&&c.push("</"+t.tagName+">"),c.join("")}function po(t,e){const n=[];let s=-1,r;if(e){for(r in e)if(e[r]!==null&&e[r]!==void 0){const a=go(t,r,e[r]);a&&n.push(a)}}for(;++s<n.length;){const a=t.settings.tightAttributes?n[s].charAt(n[s].length-1):void 0;s!==n.length-1&&a!=='"'&&a!=="'"&&(n[s]+=" ")}return n.join("")}function go(t,e,n){const s=mi(t.schema,e),r=t.settings.allowParseErrors&&t.schema.space==="html"?0:1,a=t.settings.allowDangerousCharacters?0:1;let i=t.quote,c;if(s.overloadedBoolean&&(n===s.attribute||n==="")?n=!0:(s.boolean||s.overloadedBoolean)&&(typeof n!="string"||n===s.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const l=De(s.attribute,Object.assign({},t.settings.characterReferences,{subset:Je.name[r][a]}));return n===!0||(n=Array.isArray(n)?(s.commaSeparated?Ui:zi)(n,{padLeft:!t.settings.tightCommaSeparatedLists}):String(n),t.settings.collapseEmptyAttributes&&!n)?l:(t.settings.preferUnquoted&&(c=De(n,Object.assign({},t.settings.characterReferences,{attribute:!0,subset:Je.unquoted[r][a]}))),c!==n&&(t.settings.quoteSmart&&Xn(n,i)>Xn(n,t.alternative)&&(i=t.alternative),c=i+De(n,Object.assign({},t.settings.characterReferences,{subset:(i==="'"?Je.single:Je.double)[r][a],attribute:!0}))+i),l+(c&&"="+c))}const fo=["<","&"];function pr(t,e,n,s){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?t.value:De(t.value,Object.assign({},s.settings.characterReferences,{subset:fo}))}function mo(t,e,n,s){return s.settings.allowDangerousHtml?t.value:pr(t,e,n,s)}function yo(t,e,n,s){return s.all(t)}const ko=wi("type",{invalid:bo,unknown:wo,handlers:{comment:Fi,doctype:ji,element:ho,raw:mo,root:yo,text:pr}});function bo(t){throw new Error("Expected node, not `"+t+"`")}function wo(t){const e=t;throw new Error("Cannot compile unknown node `"+e.type+"`")}const Co={},_o={},Ao=[];function vo(t,e){const n=e||Co,s=n.quote||'"',r=s==='"'?"'":'"';if(s!=='"'&&s!=="'")throw new Error("Invalid quote `"+s+"`, expected `'` or `\"`");return{one:So,all:Eo,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||ui,characterReferences:n.characterReferences||_o,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?or:bi,quote:s,alternative:r}.one(Array.isArray(t)?{type:"root",children:t}:t,void 0,void 0)}function So(t,e,n){return ko(t,e,n,this)}function Eo(t){const e=[],n=t&&t.children||Ao;let s=-1;for(;++s<n.length;)e[s]=this.one(n[s],s,t);return e.join("")}function ht(t,e){const n=typeof t=="string"?{}:{...t.colorReplacements},s=typeof t=="string"?t:t.name;for(const[r,a]of Object.entries(e?.colorReplacements||{}))typeof a=="string"?n[r]=a:r===s&&Object.assign(n,a);return n}function ue(t,e){return t&&(e?.[t?.toLowerCase()]||t)}function xo(t){return Array.isArray(t)?t:[t]}async function dr(t){return Promise.resolve(typeof t=="function"?t():t).then(e=>e.default||e)}function yn(t){return!t||["plaintext","txt","text","plain"].includes(t)}function Do(t){return t==="ansi"||yn(t)}function kn(t){return t==="none"}function Bo(t){return kn(t)}function gr(t,e){if(!e)return t;t.properties||={},t.properties.class||=[],typeof t.properties.class=="string"&&(t.properties.class=t.properties.class.split(/\s+/g)),Array.isArray(t.properties.class)||(t.properties.class=[]);const n=Array.isArray(e)?e:e.split(/\s+/g);for(const s of n)s&&!t.properties.class.includes(s)&&t.properties.class.push(s);return t}function wt(t,e=!1){const n=t.split(/(\r?\n)/g);let s=0;const r=[];for(let a=0;a<n.length;a+=2){const i=e?n[a]+(n[a+1]||""):n[a];r.push([i,s]),s+=n[a].length,s+=n[a+1]?.length||0}return r}function Io(t){const e=wt(t,!0).map(([r])=>r);function n(r){if(r===t.length)return{line:e.length-1,character:e[e.length-1].length};let a=r,i=0;for(const c of e){if(a<c.length)break;a-=c.length,i++}return{line:i,character:a}}function s(r,a){let i=0;for(let c=0;c<r;c++)i+=e[c].length;return i+=a,i}return{lines:e,indexToPos:n,posToIndex:s}}const bn="light-dark()",Ro=["color","background-color"];function $o(t,e){let n=0;const s=[];for(const r of e)r>n&&s.push({...t,content:t.content.slice(n,r),offset:t.offset+n}),n=r;return n<t.content.length&&s.push({...t,content:t.content.slice(n),offset:t.offset+n}),s}function Lo(t,e){const n=Array.from(e instanceof Set?e:new Set(e)).sort((s,r)=>s-r);return n.length?t.map(s=>s.flatMap(r=>{const a=n.filter(i=>r.offset<i&&i<r.offset+r.content.length).map(i=>i-r.offset).sort((i,c)=>i-c);return a.length?$o(r,a):r})):t}function Mo(t,e,n,s,r="css-vars"){const a={content:t.content,explanation:t.explanation,offset:t.offset},i=e.map(h=>pt(t.variants[h])),c=new Set(i.flatMap(h=>Object.keys(h))),l={},u=(h,p)=>{const g=p==="color"?"":p==="background-color"?"-bg":`-${p}`;return n+e[h]+(p==="color"?"":g)};return i.forEach((h,p)=>{for(const g of c){const f=h[g]||"inherit";if(p===0&&s&&Ro.includes(g))if(s===bn&&i.length>1){const d=e.findIndex(y=>y==="light"),k=e.findIndex(y=>y==="dark");if(d===-1||k===-1)throw new P('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const w=i[d][g]||"inherit",b=i[k][g]||"inherit";l[g]=`light-dark(${w}, ${b})`,r==="css-vars"&&(l[u(p,g)]=f)}else l[g]=f;else r==="css-vars"&&(l[u(p,g)]=f)}}),a.htmlStyle=l,a}function pt(t){const e={};if(t.color&&(e.color=t.color),t.bgColor&&(e["background-color"]=t.bgColor),t.fontStyle){t.fontStyle&j.Italic&&(e["font-style"]="italic"),t.fontStyle&j.Bold&&(e["font-weight"]="bold");const n=[];t.fontStyle&j.Underline&&n.push("underline"),t.fontStyle&j.Strikethrough&&n.push("line-through"),n.length&&(e["text-decoration"]=n.join(" "))}return e}function sn(t){return typeof t=="string"?t:Object.entries(t).map(([e,n])=>`${e}:${n}`).join(";")}const fr=new WeakMap;function Ct(t,e){fr.set(t,e)}function We(t){return fr.get(t)}class Re{_stacks={};lang;get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(e,n){return new Re(Object.fromEntries(xo(n).map(s=>[s,Yt])),e)}constructor(...e){if(e.length===2){const[n,s]=e;this.lang=s,this._stacks=n}else{const[n,s,r]=e;this.lang=s,this._stacks={[r]:n}}}getInternalStack(e=this.theme){return this._stacks[e]}getScopes(e=this.theme){return To(this._stacks[e])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.getScopes()}}}function To(t){const e=[],n=new Set;function s(r){if(n.has(r))return;n.add(r);const a=r?.nameScopesList?.scopeName;a&&e.push(a),r.parent&&s(r.parent)}return s(t),e}function No(t,e){if(!(t instanceof Re))throw new P("Invalid grammar state");return t.getInternalStack(e)}function Po(){const t=new WeakMap;function e(n){if(!t.has(n.meta)){let s=function(i){if(typeof i=="number"){if(i<0||i>n.source.length)throw new P(`Invalid decoration offset: ${i}. Code length: ${n.source.length}`);return{...r.indexToPos(i),offset:i}}else{const c=r.lines[i.line];if(c===void 0)throw new P(`Invalid decoration position ${JSON.stringify(i)}. Lines length: ${r.lines.length}`);if(i.character<0||i.character>c.length)throw new P(`Invalid decoration position ${JSON.stringify(i)}. Line ${i.line} length: ${c.length}`);return{...i,offset:r.posToIndex(i.line,i.character)}}};const r=Io(n.source),a=(n.options.decorations||[]).map(i=>({...i,start:s(i.start),end:s(i.end)}));Oo(a),t.set(n.meta,{decorations:a,converter:r,source:n.source})}return t.get(n.meta)}return{name:"shiki:decorations",tokens(n){if(!this.options.decorations?.length)return;const r=e(this).decorations.flatMap(i=>[i.start.offset,i.end.offset]);return Lo(n,r)},code(n){if(!this.options.decorations?.length)return;const s=e(this),r=Array.from(n.children).filter(h=>h.type==="element"&&h.tagName==="span");if(r.length!==s.converter.lines.length)throw new P(`Number of lines in code element (${r.length}) does not match the number of lines in the source (${s.converter.lines.length}). Failed to apply decorations.`);function a(h,p,g,f){const d=r[h];let k="",w=-1,b=-1;if(p===0&&(w=0),g===0&&(b=0),g===Number.POSITIVE_INFINITY&&(b=d.children.length),w===-1||b===-1)for(let _=0;_<d.children.length;_++)k+=mr(d.children[_]),w===-1&&k.length===p&&(w=_+1),b===-1&&k.length===g&&(b=_+1);if(w===-1)throw new P(`Failed to find start index for decoration ${JSON.stringify(f.start)}`);if(b===-1)throw new P(`Failed to find end index for decoration ${JSON.stringify(f.end)}`);const y=d.children.slice(w,b);if(!f.alwaysWrap&&y.length===d.children.length)c(d,f,"line");else if(!f.alwaysWrap&&y.length===1&&y[0].type==="element")c(y[0],f,"token");else{const _={type:"element",tagName:"span",properties:{},children:y};c(_,f,"wrapper"),d.children.splice(w,y.length,_)}}function i(h,p){r[h]=c(r[h],p,"line")}function c(h,p,g){const f=p.properties||{},d=p.transform||(k=>k);return h.tagName=p.tagName||"span",h.properties={...h.properties,...f,class:h.properties.class},p.properties?.class&&gr(h,p.properties.class),h=d(h,g)||h,h}const l=[],u=s.decorations.sort((h,p)=>p.start.offset-h.start.offset||h.end.offset-p.end.offset);for(const h of u){const{start:p,end:g}=h;if(p.line===g.line)a(p.line,p.character,g.character,h);else if(p.line<g.line){a(p.line,p.character,Number.POSITIVE_INFINITY,h);for(let f=p.line+1;f<g.line;f++)l.unshift(()=>i(f,h));a(g.line,0,g.character,h)}}l.forEach(h=>h())}}}function Oo(t){for(let e=0;e<t.length;e++){const n=t[e];if(n.start.offset>n.end.offset)throw new P(`Invalid decoration range: ${JSON.stringify(n.start)} - ${JSON.stringify(n.end)}`);for(let s=e+1;s<t.length;s++){const r=t[s],a=n.start.offset<=r.start.offset&&r.start.offset<n.end.offset,i=n.start.offset<r.end.offset&&r.end.offset<=n.end.offset,c=r.start.offset<=n.start.offset&&n.start.offset<r.end.offset,l=r.start.offset<n.end.offset&&n.end.offset<=r.end.offset;if(a||i||c||l){if(a&&i||c&&l)continue;throw new P(`Decorations ${JSON.stringify(n.start)} and ${JSON.stringify(r.start)} intersect.`)}}}}function mr(t){return t.type==="text"?t.value:t.type==="element"?t.children.map(mr).join(""):""}const Go=[Po()];function dt(t){return[...t.transformers||[],...Go]}var fe=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],Tt={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",8:"hidden",9:"strikethrough"};function Fo(t,e){const n=t.indexOf("\x1B",e);if(n!==-1&&t[n+1]==="["){const s=t.indexOf("m",n);if(s!==-1)return{sequence:t.substring(n+2,s).split(";"),startPosition:n,position:s+1}}return{position:t.length}}function Yn(t){const e=t.shift();if(e==="2"){const n=t.splice(0,3).map(s=>Number.parseInt(s));return n.length!==3||n.some(s=>Number.isNaN(s))?void 0:{type:"rgb",rgb:n}}else if(e==="5"){const n=t.shift();if(n)return{type:"table",index:Number(n)}}}function jo(t){const e=[];for(;t.length>0;){const n=t.shift();if(!n)continue;const s=Number.parseInt(n);if(!Number.isNaN(s))if(s===0)e.push({type:"resetAll"});else if(s<=9)Tt[s]&&e.push({type:"setDecoration",value:Tt[s]});else if(s<=29){const r=Tt[s-20];r&&(e.push({type:"resetDecoration",value:r}),r==="dim"&&e.push({type:"resetDecoration",value:"bold"}))}else if(s<=37)e.push({type:"setForegroundColor",value:{type:"named",name:fe[s-30]}});else if(s===38){const r=Yn(t);r&&e.push({type:"setForegroundColor",value:r})}else if(s===39)e.push({type:"resetForegroundColor"});else if(s<=47)e.push({type:"setBackgroundColor",value:{type:"named",name:fe[s-40]}});else if(s===48){const r=Yn(t);r&&e.push({type:"setBackgroundColor",value:r})}else s===49?e.push({type:"resetBackgroundColor"}):s===53?e.push({type:"setDecoration",value:"overline"}):s===55?e.push({type:"resetDecoration",value:"overline"}):s>=90&&s<=97?e.push({type:"setForegroundColor",value:{type:"named",name:fe[s-90+8]}}):s>=100&&s<=107&&e.push({type:"setBackgroundColor",value:{type:"named",name:fe[s-100+8]}})}return e}function Uo(){let t=null,e=null,n=new Set;return{parse(s){const r=[];let a=0;do{const i=Fo(s,a),c=i.sequence?s.substring(a,i.startPosition):s.substring(a);if(c.length>0&&r.push({value:c,foreground:t,background:e,decorations:new Set(n)}),i.sequence){const l=jo(i.sequence);for(const u of l)u.type==="resetAll"?(t=null,e=null,n.clear()):u.type==="resetForegroundColor"?t=null:u.type==="resetBackgroundColor"?e=null:u.type==="resetDecoration"&&n.delete(u.value);for(const u of l)u.type==="setForegroundColor"?t=u.value:u.type==="setBackgroundColor"?e=u.value:u.type==="setDecoration"&&n.add(u.value)}a=i.position}while(a<s.length);return r}}}var zo={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function Wo(t=zo){function e(c){return t[c]}function n(c){return`#${c.map(l=>Math.max(0,Math.min(l,255)).toString(16).padStart(2,"0")).join("")}`}let s;function r(){if(s)return s;s=[];for(let u=0;u<fe.length;u++)s.push(e(fe[u]));let c=[0,95,135,175,215,255];for(let u=0;u<6;u++)for(let h=0;h<6;h++)for(let p=0;p<6;p++)s.push(n([c[u],c[h],c[p]]));let l=8;for(let u=0;u<24;u++,l+=10)s.push(n([l,l,l]));return s}function a(c){return r()[c]}function i(c){switch(c.type){case"named":return e(c.name);case"rgb":return n(c.rgb);case"table":return a(c.index)}}return{value:i}}function Ho(t,e,n){const s=ht(t,n),r=wt(e),a=Wo(Object.fromEntries(fe.map(c=>[c,t.colors?.[`terminal.ansi${c[0].toUpperCase()}${c.substring(1)}`]]))),i=Uo();return r.map(c=>i.parse(c[0]).map(l=>{let u,h;l.decorations.has("reverse")?(u=l.background?a.value(l.background):t.bg,h=l.foreground?a.value(l.foreground):t.fg):(u=l.foreground?a.value(l.foreground):t.fg,h=l.background?a.value(l.background):void 0),u=ue(u,s),h=ue(h,s),l.decorations.has("dim")&&(u=qo(u));let p=j.None;return l.decorations.has("bold")&&(p|=j.Bold),l.decorations.has("italic")&&(p|=j.Italic),l.decorations.has("underline")&&(p|=j.Underline),l.decorations.has("strikethrough")&&(p|=j.Strikethrough),{content:l.value,offset:c[1],color:u,bgColor:h,fontStyle:p}}))}function qo(t){const e=t.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);if(e)if(e[3]){const s=Math.round(Number.parseInt(e[3],16)/2).toString(16).padStart(2,"0");return`#${e[1]}${e[2]}${s}`}else return e[2]?`#${e[1]}${e[2]}80`:`#${Array.from(e[1]).map(s=>`${s}${s}`).join("")}80`;const n=t.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return n?`var(${n[1]}-dim)`:t}function wn(t,e,n={}){const{lang:s="text",theme:r=t.getLoadedThemes()[0]}=n;if(yn(s)||kn(r))return wt(e).map(l=>[{content:l[0],offset:l[1]}]);const{theme:a,colorMap:i}=t.setTheme(r);if(s==="ansi")return Ho(a,e,n);const c=t.getLanguage(s);if(n.grammarState){if(n.grammarState.lang!==c.name)throw new P(`Grammar state language "${n.grammarState.lang}" does not match highlight language "${c.name}"`);if(!n.grammarState.themes.includes(a.name))throw new P(`Grammar state themes "${n.grammarState.themes}" do not contain highlight theme "${a.name}"`)}return Ko(e,c,a,i,n)}function Vo(...t){if(t.length===2)return We(t[1]);const[e,n,s={}]=t,{lang:r="text",theme:a=e.getLoadedThemes()[0]}=s;if(yn(r)||kn(a))throw new P("Plain language does not have grammar state");if(r==="ansi")throw new P("ANSI language does not have grammar state");const{theme:i,colorMap:c}=e.setTheme(a),l=e.getLanguage(r);return new Re(gt(n,l,i,c,s).stateStack,l.name,i.name)}function Ko(t,e,n,s,r){const a=gt(t,e,n,s,r),i=new Re(gt(t,e,n,s,r).stateStack,e.name,n.name);return Ct(a.tokens,i),a.tokens}function gt(t,e,n,s,r){const a=ht(n,r),{tokenizeMaxLineLength:i=0,tokenizeTimeLimit:c=500}=r,l=wt(t);let u=r.grammarState?No(r.grammarState,n.name)??Yt:r.grammarContextCode!=null?gt(r.grammarContextCode,e,n,s,{...r,grammarState:void 0,grammarContextCode:void 0}).stateStack:Yt,h=[];const p=[];for(let g=0,f=l.length;g<f;g++){const[d,k]=l[g];if(d===""){h=[],p.push([]);continue}if(i>0&&d.length>=i){h=[],p.push([{content:d,offset:k,color:"",fontStyle:0}]);continue}let w,b,y;r.includeExplanation&&(w=e.tokenizeLine(d,u,c),b=w.tokens,y=0);const _=e.tokenizeLine2(d,u,c),A=_.tokens.length/2;for(let v=0;v<A;v++){const D=_.tokens[2*v],I=v+1<A?_.tokens[2*v+2]:d.length;if(D===I)continue;const G=_.tokens[2*v+1],Y=ue(s[Be.getForeground(G)],a),St=Be.getFontStyle(G),Me={content:d.substring(D,I),offset:k+D,color:Y,fontStyle:St};if(r.includeExplanation){const ae=[];if(r.includeExplanation!=="scopeName")for(const ee of n.settings){let Ce;switch(typeof ee.scope){case"string":Ce=ee.scope.split(/,/).map(Et=>Et.trim());break;case"object":Ce=ee.scope;break;default:continue}ae.push({settings:ee,selectors:Ce.map(Et=>Et.split(/ /))})}Me.explanation=[];let xn=0;for(;D+xn<I;){const ee=b[y],Ce=d.substring(ee.startIndex,ee.endIndex);xn+=Ce.length,Me.explanation.push({content:Ce,scopes:r.includeExplanation==="scopeName"?Xo(ee.scopes):Qo(ae,ee.scopes)}),y+=1}}h.push(Me)}p.push(h),h=[],u=_.ruleStack}return{tokens:p,stateStack:u}}function Xo(t){return t.map(e=>({scopeName:e}))}function Qo(t,e){const n=[];for(let s=0,r=e.length;s<r;s++){const a=e[s];n[s]={scopeName:a,themeMatches:Jo(t,a,e.slice(0,s))}}return n}function es(t,e){return t===e||e.substring(0,t.length)===t&&e[t.length]==="."}function Zo(t,e,n){if(!es(t[t.length-1],e))return!1;let s=t.length-2,r=n.length-1;for(;s>=0&&r>=0;)es(t[s],n[r])&&(s-=1),r-=1;return s===-1}function Jo(t,e,n){const s=[];for(const{selectors:r,settings:a}of t)for(const i of r)if(Zo(i,e,n)){s.push(a);break}return s}function yr(t,e,n){const s=Object.entries(n.themes).filter(l=>l[1]).map(l=>({color:l[0],theme:l[1]})),r=s.map(l=>{const u=wn(t,e,{...n,theme:l.theme}),h=We(u),p=typeof l.theme=="string"?l.theme:l.theme.name;return{tokens:u,state:h,theme:p}}),a=Yo(...r.map(l=>l.tokens)),i=a[0].map((l,u)=>l.map((h,p)=>{const g={content:h.content,variants:{},offset:h.offset};return"includeExplanation"in n&&n.includeExplanation&&(g.explanation=h.explanation),a.forEach((f,d)=>{const{content:k,explanation:w,offset:b,...y}=f[u][p];g.variants[s[d].color]=y}),g})),c=r[0].state?new Re(Object.fromEntries(r.map(l=>[l.theme,l.state?.getInternalStack(l.theme)])),r[0].state.lang):void 0;return c&&Ct(i,c),i}function Yo(...t){const e=t.map(()=>[]),n=t.length;for(let s=0;s<t[0].length;s++){const r=t.map(l=>l[s]),a=e.map(()=>[]);e.forEach((l,u)=>l.push(a[u]));const i=r.map(()=>0),c=r.map(l=>l[0]);for(;c.every(l=>l);){const l=Math.min(...c.map(u=>u.content.length));for(let u=0;u<n;u++){const h=c[u];h.content.length===l?(a[u].push(h),i[u]+=1,c[u]=r[u][i[u]]):(a[u].push({...h,content:h.content.slice(0,l)}),c[u]={...h,content:h.content.slice(l),offset:h.offset+l})}}}return e}function ft(t,e,n){let s,r,a,i,c,l;if("themes"in n){const{defaultColor:u="light",cssVariablePrefix:h="--shiki-",colorsRendering:p="css-vars"}=n,g=Object.entries(n.themes).filter(b=>b[1]).map(b=>({color:b[0],theme:b[1]})).sort((b,y)=>b.color===u?-1:y.color===u?1:0);if(g.length===0)throw new P("`themes` option must not be empty");const f=yr(t,e,n);if(l=We(f),u&&bn!==u&&!g.find(b=>b.color===u))throw new P(`\`themes\` option must contain the defaultColor key \`${u}\``);const d=g.map(b=>t.getTheme(b.theme)),k=g.map(b=>b.color);a=f.map(b=>b.map(y=>Mo(y,k,h,u,p))),l&&Ct(a,l);const w=g.map(b=>ht(b.theme,n));r=ts(g,d,w,h,u,"fg",p),s=ts(g,d,w,h,u,"bg",p),i=`shiki-themes ${d.map(b=>b.name).join(" ")}`,c=u?void 0:[r,s].join(";")}else if("theme"in n){const u=ht(n.theme,n);a=wn(t,e,n);const h=t.getTheme(n.theme);s=ue(h.bg,u),r=ue(h.fg,u),i=h.name,l=We(a)}else throw new P("Invalid options, either `theme` or `themes` must be provided");return{tokens:a,fg:r,bg:s,themeName:i,rootStyle:c,grammarState:l}}function ts(t,e,n,s,r,a,i){return t.map((c,l)=>{const u=ue(e[l][a],n[l])||"inherit",h=`${s+c.color}${a==="bg"?"-bg":""}:${u}`;if(l===0&&r){if(r===bn&&t.length>1){const p=t.findIndex(k=>k.color==="light"),g=t.findIndex(k=>k.color==="dark");if(p===-1||g===-1)throw new P('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const f=ue(e[p][a],n[p])||"inherit",d=ue(e[g][a],n[g])||"inherit";return`light-dark(${f}, ${d});${h}`}return u}return i==="css-vars"?h:null}).filter(c=>!!c).join(";")}function mt(t,e,n,s={meta:{},options:n,codeToHast:(r,a)=>mt(t,r,a),codeToTokens:(r,a)=>ft(t,r,a)}){let r=e;for(const d of dt(n))r=d.preprocess?.call(s,r,n)||r;let{tokens:a,fg:i,bg:c,themeName:l,rootStyle:u,grammarState:h}=ft(t,r,n);const{mergeWhitespaces:p=!0,mergeSameStyleTokens:g=!1}=n;p===!0?a=tl(a):p==="never"&&(a=nl(a)),g&&(a=sl(a));const f={...s,get source(){return r}};for(const d of dt(n))a=d.tokens?.call(f,a)||a;return el(a,{...n,fg:i,bg:c,themeName:l,rootStyle:u},f,h)}function el(t,e,n,s=We(t)){const r=dt(e),a=[],i={type:"root",children:[]},{structure:c="classic",tabindex:l="0"}=e;let u={type:"element",tagName:"pre",properties:{class:`shiki ${e.themeName||""}`,style:e.rootStyle||`background-color:${e.bg};color:${e.fg}`,...l!==!1&&l!=null?{tabindex:l.toString()}:{},...Object.fromEntries(Array.from(Object.entries(e.meta||{})).filter(([d])=>!d.startsWith("_")))},children:[]},h={type:"element",tagName:"code",properties:{},children:a};const p=[],g={...n,structure:c,addClassToHast:gr,get source(){return n.source},get tokens(){return t},get options(){return e},get root(){return i},get pre(){return u},get code(){return h},get lines(){return p}};if(t.forEach((d,k)=>{k&&(c==="inline"?i.children.push({type:"element",tagName:"br",properties:{},children:[]}):c==="classic"&&a.push({type:"text",value:`
`}));let w={type:"element",tagName:"span",properties:{class:"line"},children:[]},b=0;for(const y of d){let _={type:"element",tagName:"span",properties:{...y.htmlAttrs},children:[{type:"text",value:y.content}]};const A=sn(y.htmlStyle||pt(y));A&&(_.properties.style=A);for(const v of r)_=v?.span?.call(g,_,k+1,b,w,y)||_;c==="inline"?i.children.push(_):c==="classic"&&w.children.push(_),b+=y.content.length}if(c==="classic"){for(const y of r)w=y?.line?.call(g,w,k+1)||w;p.push(w),a.push(w)}}),c==="classic"){for(const d of r)h=d?.code?.call(g,h)||h;u.children.push(h);for(const d of r)u=d?.pre?.call(g,u)||u;i.children.push(u)}let f=i;for(const d of r)f=d?.root?.call(g,f)||f;return s&&Ct(f,s),f}function tl(t){return t.map(e=>{const n=[];let s="",r=0;return e.forEach((a,i)=>{const l=!(a.fontStyle&&(a.fontStyle&j.Underline||a.fontStyle&j.Strikethrough));l&&a.content.match(/^\s+$/)&&e[i+1]?(r||(r=a.offset),s+=a.content):s?(l?n.push({...a,offset:r,content:s+a.content}):n.push({content:s,offset:r},a),r=0,s=""):n.push(a)}),n})}function nl(t){return t.map(e=>e.flatMap(n=>{if(n.content.match(/^\s+$/))return n;const s=n.content.match(/^(\s*)(.*?)(\s*)$/);if(!s)return n;const[,r,a,i]=s;if(!r&&!i)return n;const c=[{...n,offset:n.offset+r.length,content:a}];return r&&c.unshift({content:r,offset:n.offset}),i&&c.push({content:i,offset:n.offset+r.length+a.length}),c}))}function sl(t){return t.map(e=>{const n=[];for(const s of e){if(n.length===0){n.push({...s});continue}const r=n[n.length-1],a=sn(r.htmlStyle||pt(r)),i=sn(s.htmlStyle||pt(s)),c=r.fontStyle&&(r.fontStyle&j.Underline||r.fontStyle&j.Strikethrough),l=s.fontStyle&&(s.fontStyle&j.Underline||s.fontStyle&j.Strikethrough);!c&&!l&&a===i?r.content+=s.content:n.push({...s})}return n})}const rl=vo;function al(t,e,n){const s={meta:{},options:n,codeToHast:(a,i)=>mt(t,a,i),codeToTokens:(a,i)=>ft(t,a,i)};let r=rl(mt(t,e,n,s));for(const a of dt(n))r=a.postprocess?.call(s,r,n)||r;return r}const ns={light:"#333333",dark:"#bbbbbb"},ss={light:"#fffffe",dark:"#1e1e1e"},rs="__shiki_resolved";function Cn(t){if(t?.[rs])return t;const e={...t};e.tokenColors&&!e.settings&&(e.settings=e.tokenColors,delete e.tokenColors),e.type||="dark",e.colorReplacements={...e.colorReplacements},e.settings||=[];let{bg:n,fg:s}=e;if(!n||!s){const c=e.settings?e.settings.find(l=>!l.name&&!l.scope):void 0;c?.settings?.foreground&&(s=c.settings.foreground),c?.settings?.background&&(n=c.settings.background),!s&&e?.colors?.["editor.foreground"]&&(s=e.colors["editor.foreground"]),!n&&e?.colors?.["editor.background"]&&(n=e.colors["editor.background"]),s||(s=e.type==="light"?ns.light:ns.dark),n||(n=e.type==="light"?ss.light:ss.dark),e.fg=s,e.bg=n}e.settings[0]&&e.settings[0].settings&&!e.settings[0].scope||e.settings.unshift({settings:{foreground:e.fg,background:e.bg}});let r=0;const a=new Map;function i(c){if(a.has(c))return a.get(c);r+=1;const l=`#${r.toString(16).padStart(8,"0").toLowerCase()}`;return e.colorReplacements?.[`#${l}`]?i(c):(a.set(c,l),l)}e.settings=e.settings.map(c=>{const l=c.settings?.foreground&&!c.settings.foreground.startsWith("#"),u=c.settings?.background&&!c.settings.background.startsWith("#");if(!l&&!u)return c;const h={...c,settings:{...c.settings}};if(l){const p=i(c.settings.foreground);e.colorReplacements[p]=c.settings.foreground,h.settings.foreground=p}if(u){const p=i(c.settings.background);e.colorReplacements[p]=c.settings.background,h.settings.background=p}return h});for(const c of Object.keys(e.colors||{}))if((c==="editor.foreground"||c==="editor.background"||c.startsWith("terminal.ansi"))&&!e.colors[c]?.startsWith("#")){const l=i(e.colors[c]);e.colorReplacements[l]=e.colors[c],e.colors[c]=l}return Object.defineProperty(e,rs,{enumerable:!1,writable:!1,value:!0}),e}async function kr(t){return Array.from(new Set((await Promise.all(t.filter(e=>!Do(e)).map(async e=>await dr(e).then(n=>Array.isArray(n)?n:[n])))).flat()))}async function br(t){return(await Promise.all(t.map(async n=>Bo(n)?null:Cn(await dr(n))))).filter(n=>!!n)}let il=3;function ol(t,e=3){e>il||console.trace(`[SHIKI DEPRECATE]: ${t}`)}class Ee extends Error{constructor(e){super(e),this.name="ShikiError"}}class ll extends ci{constructor(e,n,s,r={}){super(e),this._resolver=e,this._themes=n,this._langs=s,this._alias=r,this._themes.map(a=>this.loadTheme(a)),this.loadLanguages(this._langs)}_resolvedThemes=new Map;_resolvedGrammars=new Map;_langMap=new Map;_langGraph=new Map;_textmateThemeCache=new WeakMap;_loadedThemesCache=null;_loadedLanguagesCache=null;getTheme(e){return typeof e=="string"?this._resolvedThemes.get(e):this.loadTheme(e)}loadTheme(e){const n=Cn(e);return n.name&&(this._resolvedThemes.set(n.name,n),this._loadedThemesCache=null),n}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(e){let n=this._textmateThemeCache.get(e);n||(n=it.createFromRawTheme(e),this._textmateThemeCache.set(e,n)),this._syncRegistry.setTheme(n)}getGrammar(e){if(this._alias[e]){const n=new Set([e]);for(;this._alias[e];){if(e=this._alias[e],n.has(e))throw new Ee(`Circular alias \`${Array.from(n).join(" -> ")} -> ${e}\``);n.add(e)}}return this._resolvedGrammars.get(e)}loadLanguage(e){if(this.getGrammar(e.name))return;const n=new Set([...this._langMap.values()].filter(a=>a.embeddedLangsLazy?.includes(e.name)));this._resolver.addLanguage(e);const s={balancedBracketSelectors:e.balancedBracketSelectors||["*"],unbalancedBracketSelectors:e.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(e.scopeName,e);const r=this.loadGrammarWithConfiguration(e.scopeName,1,s);if(r.name=e.name,this._resolvedGrammars.set(e.name,r),e.aliases&&e.aliases.forEach(a=>{this._alias[a]=e.name}),this._loadedLanguagesCache=null,n.size)for(const a of n)this._resolvedGrammars.delete(a.name),this._loadedLanguagesCache=null,this._syncRegistry?._injectionGrammars?.delete(a.scopeName),this._syncRegistry?._grammars?.delete(a.scopeName),this.loadLanguage(this._langMap.get(a.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(e){for(const r of e)this.resolveEmbeddedLanguages(r);const n=Array.from(this._langGraph.entries()),s=n.filter(([r,a])=>!a);if(s.length){const r=n.filter(([a,i])=>i&&i.embeddedLangs?.some(c=>s.map(([l])=>l).includes(c))).filter(a=>!s.includes(a));throw new Ee(`Missing languages ${s.map(([a])=>`\`${a}\``).join(", ")}, required by ${r.map(([a])=>`\`${a}\``).join(", ")}`)}for(const[r,a]of n)this._resolver.addLanguage(a);for(const[r,a]of n)this.loadLanguage(a)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(e){if(this._langMap.set(e.name,e),this._langGraph.set(e.name,e),e.embeddedLangs)for(const n of e.embeddedLangs)this._langGraph.set(n,this._langMap.get(n))}}class cl{_langs=new Map;_scopeToLang=new Map;_injections=new Map;_onigLib;constructor(e,n){this._onigLib={createOnigScanner:s=>e.createScanner(s),createOnigString:s=>e.createString(s)},n.forEach(s=>this.addLanguage(s))}get onigLib(){return this._onigLib}getLangRegistration(e){return this._langs.get(e)}loadGrammar(e){return this._scopeToLang.get(e)}addLanguage(e){this._langs.set(e.name,e),e.aliases&&e.aliases.forEach(n=>{this._langs.set(n,e)}),this._scopeToLang.set(e.scopeName,e),e.injectTo&&e.injectTo.forEach(n=>{this._injections.get(n)||this._injections.set(n,[]),this._injections.get(n).push(e.scopeName)})}getInjections(e){const n=e.split(".");let s=[];for(let r=1;r<=n.length;r++){const a=n.slice(0,r).join(".");s=[...s,...this._injections.get(a)||[]]}return s}}let Te=0;function ul(t){Te+=1,t.warnings!==!1&&Te>=10&&Te%10===0&&console.warn(`[Shiki] ${Te} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let e=!1;if(!t.engine)throw new Ee("`engine` option is required for synchronous mode");const n=(t.langs||[]).flat(1),s=(t.themes||[]).flat(1).map(Cn),r=new cl(t.engine,n),a=new ll(r,s,n,t.langAlias);let i;function c(y){w();const _=a.getGrammar(typeof y=="string"?y:y.name);if(!_)throw new Ee(`Language \`${y}\` not found, you may need to load it first`);return _}function l(y){if(y==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};w();const _=a.getTheme(y);if(!_)throw new Ee(`Theme \`${y}\` not found, you may need to load it first`);return _}function u(y){w();const _=l(y);i!==y&&(a.setTheme(_),i=y);const A=a.getColorMap();return{theme:_,colorMap:A}}function h(){return w(),a.getLoadedThemes()}function p(){return w(),a.getLoadedLanguages()}function g(...y){w(),a.loadLanguages(y.flat(1))}async function f(...y){return g(await kr(y))}function d(...y){w();for(const _ of y.flat(1))a.loadTheme(_)}async function k(...y){return w(),d(await br(y))}function w(){if(e)throw new Ee("Shiki instance has been disposed")}function b(){e||(e=!0,a.dispose(),Te-=1)}return{setTheme:u,getTheme:l,getLanguage:c,getLoadedThemes:h,getLoadedLanguages:p,loadLanguage:f,loadLanguageSync:g,loadTheme:k,loadThemeSync:d,dispose:b,[Symbol.dispose]:b}}async function hl(t){t.engine||ol("`engine` option is required. Use `createOnigurumaEngine` or `createJavaScriptRegexEngine` to create an engine.");const[e,n,s]=await Promise.all([br(t.themes||[]),kr(t.langs||[]),t.engine]);return ul({...t,themes:e,langs:n,engine:s})}async function pl(t){const e=await hl(t);return{getLastGrammarState:(...n)=>Vo(e,...n),codeToTokensBase:(n,s)=>wn(e,n,s),codeToTokensWithThemes:(n,s)=>yr(e,n,s),codeToTokens:(n,s)=>ft(e,n,s),codeToHast:(n,s)=>mt(e,n,s),codeToHtml:(n,s)=>al(e,n,s),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...e,getInternalContext:()=>e}}function $e(t){if([...t].length!==1)throw new Error(`Expected "${t}" to be a single code point`);return t.codePointAt(0)}function dl(t,e,n){return t.has(e)||t.set(e,n),t.get(e)}const _n=new Set(["alnum","alpha","ascii","blank","cntrl","digit","graph","lower","print","punct","space","upper","word","xdigit"]),O=String.raw;function Le(t,e){if(t==null)throw new Error(e??"Value expected");return t}const wr=O`\[\^?`,Cr=`c.? | C(?:-.?)?|${O`[pP]\{(?:\^?[-\x20_]*[A-Za-z][-\x20\w]*\})?`}|${O`x[89A-Fa-f]\p{AHex}(?:\\x[89A-Fa-f]\p{AHex})*`}|${O`u(?:\p{AHex}{4})? | x\{[^\}]*\}? | x\p{AHex}{0,2}`}|${O`o\{[^\}]*\}?`}|${O`\d{1,3}`}`,An=/[?*+][?+]?|\{(?:\d+(?:,\d*)?|,\d+)\}\??/,Ye=new RegExp(O`
  \\ (?:
    ${Cr}
    | [gk]<[^>]*>?
    | [gk]'[^']*'?
    | .
  )
  | \( (?:
    \? (?:
      [:=!>({]
      | <[=!]
      | <[^>]*>
      | '[^']*'
      | ~\|?
      | #(?:[^)\\]|\\.?)*
      | [^:)]*[:)]
    )?
    | \*[^\)]*\)?
  )?
  | (?:${An.source})+
  | ${wr}
  | .
`.replace(/\s+/g,""),"gsu"),Nt=new RegExp(O`
  \\ (?:
    ${Cr}
    | .
  )
  | \[:(?:\^?\p{Alpha}+|\^):\]
  | ${wr}
  | &&
  | .
`.replace(/\s+/g,""),"gsu");function gl(t,e={}){const n={flags:"",...e,rules:{captureGroup:!1,singleline:!1,...e.rules}};if(typeof t!="string")throw new Error("String expected as pattern");const s=Ll(n.flags),r=[s.extended],a={captureGroup:n.rules.captureGroup,getCurrentModX(){return r.at(-1)},numOpenGroups:0,popModX(){r.pop()},pushModX(p){r.push(p)},replaceCurrentModX(p){r[r.length-1]=p},singleline:n.rules.singleline};let i=[],c;for(Ye.lastIndex=0;c=Ye.exec(t);){const p=fl(a,t,c[0],Ye.lastIndex);p.tokens?i.push(...p.tokens):p.token&&i.push(p.token),p.lastIndex!==void 0&&(Ye.lastIndex=p.lastIndex)}const l=[];let u=0;i.filter(p=>p.type==="GroupOpen").forEach(p=>{p.kind==="capturing"?p.number=++u:p.raw==="("&&l.push(p)}),u||l.forEach((p,g)=>{p.kind="capturing",p.number=g+1});const h=u||l.length;return{tokens:i.map(p=>p.type==="EscapedNumber"?Tl(p,h):p).flat(),flags:s}}function fl(t,e,n,s){const[r,a]=n;if(n==="["||n==="[^"){const i=ml(e,n,s);return{tokens:i.tokens,lastIndex:i.lastIndex}}if(r==="\\"){if("AbBGyYzZ".includes(a))return{token:as(n,n)};if(/^\\g[<']/.test(n)){if(!/^\\g(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:El(n)}}if(/^\\k[<']/.test(n)){if(!/^\\k(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:Ar(n)}}if(a==="K")return{token:vr("keep",n)};if(a==="N"||a==="R")return{token:me("newline",n,{negate:a==="N"})};if(a==="O")return{token:me("any",n)};if(a==="X")return{token:me("text_segment",n)};const i=_r(n,{inCharClass:!1});return Array.isArray(i)?{tokens:i}:{token:i}}if(r==="("){if(a==="*")return{token:Il(n)};if(n==="(?{")throw new Error(`Unsupported callout "${n}"`);if(n.startsWith("(?#")){if(e[s]!==")")throw new Error('Unclosed comment group "(?#"');return{lastIndex:s+1}}if(/^\(\?[-imx]+[:)]$/.test(n))return{token:Bl(n,t)};if(t.pushModX(t.getCurrentModX()),t.numOpenGroups++,n==="("&&!t.captureGroup||n==="(?:")return{token:ve("group",n)};if(n==="(?>")return{token:ve("atomic",n)};if(n==="(?="||n==="(?!"||n==="(?<="||n==="(?<!")return{token:ve(n[2]==="<"?"lookbehind":"lookahead",n,{negate:n.endsWith("!")})};if(n==="("&&t.captureGroup||n.startsWith("(?<")&&n.endsWith(">")||n.startsWith("(?'")&&n.endsWith("'"))return{token:ve("capturing",n,{...n!=="("&&{name:n.slice(3,-1)}})};if(n.startsWith("(?~")){if(n==="(?~|")throw new Error(`Unsupported absence function kind "${n}"`);return{token:ve("absence_repeater",n)}}throw n==="(?("?new Error(`Unsupported conditional "${n}"`):new Error(`Invalid or unsupported group option "${n}"`)}if(n===")"){if(t.popModX(),t.numOpenGroups--,t.numOpenGroups<0)throw new Error('Unmatched ")"');return{token:Al(n)}}if(t.getCurrentModX()){if(n==="#"){const i=e.indexOf(`
`,s);return{lastIndex:i===-1?e.length:i}}if(/^\s$/.test(n)){const i=/\s+/y;return i.lastIndex=s,{lastIndex:i.exec(e)?i.lastIndex:s}}}if(n===".")return{token:me("dot",n)};if(n==="^"||n==="$"){const i=t.singleline?{"^":O`\A`,$:O`\Z`}[n]:n;return{token:as(i,n)}}return n==="|"?{token:kl(n)}:An.test(n)?{tokens:Nl(n)}:{token:se($e(n),n)}}function ml(t,e,n){const s=[is(e[1]==="^",e)];let r=1,a;for(Nt.lastIndex=n;a=Nt.exec(t);){const i=a[0];if(i[0]==="["&&i[1]!==":")r++,s.push(is(i[1]==="^",i));else if(i==="]"){if(s.at(-1).type==="CharacterClassOpen")s.push(se(93,i));else if(r--,s.push(bl(i)),!r)break}else{const c=yl(i);Array.isArray(c)?s.push(...c):s.push(c)}}return{tokens:s,lastIndex:Nt.lastIndex||t.length}}function yl(t){if(t[0]==="\\")return _r(t,{inCharClass:!0});if(t[0]==="["){const e=/\[:(?<negate>\^?)(?<name>[a-z]+):\]/.exec(t);if(!e||!_n.has(e.groups.name))throw new Error(`Invalid POSIX class "${t}"`);return me("posix",t,{value:e.groups.name,negate:!!e.groups.negate})}return t==="-"?wl(t):t==="&&"?Cl(t):se($e(t),t)}function _r(t,{inCharClass:e}){const n=t[1];if(n==="c"||n==="C")return Dl(t);if("dDhHsSwW".includes(n))return Rl(t);if(t.startsWith(O`\o{`))throw new Error(`Incomplete, invalid, or unsupported octal code point "${t}"`);if(/^\\[pP]\{/.test(t)){if(t.length===3)throw new Error(`Incomplete or invalid Unicode property "${t}"`);return $l(t)}if(new RegExp("^\\\\x[89A-Fa-f]\\p{AHex}","u").test(t))try{const s=t.split(/\\x/).slice(1).map(i=>parseInt(i,16)),r=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}).decode(new Uint8Array(s)),a=new TextEncoder;return[...r].map(i=>{const c=[...a.encode(i)].map(l=>`\\x${l.toString(16)}`).join("");return se($e(i),c)})}catch{throw new Error(`Multibyte code "${t}" incomplete or invalid in Oniguruma`)}if(n==="u"||n==="x")return se(Ml(t),t);if(os.has(n))return se(os.get(n),t);if(/\d/.test(n))return _l(e,t);if(t==="\\")throw new Error(O`Incomplete escape "\"`);if(n==="M")throw new Error(`Unsupported meta "${t}"`);if([...t].length===2)return se(t.codePointAt(1),t);throw new Error(`Unexpected escape "${t}"`)}function kl(t){return{type:"Alternator",raw:t}}function as(t,e){return{type:"Assertion",kind:t,raw:e}}function Ar(t){return{type:"Backreference",raw:t}}function se(t,e){return{type:"Character",value:t,raw:e}}function bl(t){return{type:"CharacterClassClose",raw:t}}function wl(t){return{type:"CharacterClassHyphen",raw:t}}function Cl(t){return{type:"CharacterClassIntersector",raw:t}}function is(t,e){return{type:"CharacterClassOpen",negate:t,raw:e}}function me(t,e,n={}){return{type:"CharacterSet",kind:t,...n,raw:e}}function vr(t,e,n={}){return t==="keep"?{type:"Directive",kind:t,raw:e}:{type:"Directive",kind:t,flags:Le(n.flags),raw:e}}function _l(t,e){return{type:"EscapedNumber",inCharClass:t,raw:e}}function Al(t){return{type:"GroupClose",raw:t}}function ve(t,e,n={}){return{type:"GroupOpen",kind:t,...n,raw:e}}function vl(t,e,n,s){return{type:"NamedCallout",kind:t,tag:e,arguments:n,raw:s}}function Sl(t,e,n,s){return{type:"Quantifier",kind:t,min:e,max:n,raw:s}}function El(t){return{type:"Subroutine",raw:t}}const xl=new Set(["COUNT","CMP","ERROR","FAIL","MAX","MISMATCH","SKIP","TOTAL_COUNT"]),os=new Map([["a",7],["b",8],["e",27],["f",12],["n",10],["r",13],["t",9],["v",11]]);function Dl(t){const e=t[1]==="c"?t[2]:t[3];if(!e||!/[A-Za-z]/.test(e))throw new Error(`Unsupported control character "${t}"`);return se($e(e.toUpperCase())-64,t)}function Bl(t,e){let{on:n,off:s}=/^\(\?(?<on>[imx]*)(?:-(?<off>[-imx]*))?/.exec(t).groups;s??="";const r=(e.getCurrentModX()||n.includes("x"))&&!s.includes("x"),a=cs(n),i=cs(s),c={};if(a&&(c.enable=a),i&&(c.disable=i),t.endsWith(")"))return e.replaceCurrentModX(r),vr("flags",t,{flags:c});if(t.endsWith(":"))return e.pushModX(r),e.numOpenGroups++,ve("group",t,{...(a||i)&&{flags:c}});throw new Error(`Unexpected flag modifier "${t}"`)}function Il(t){const e=/\(\*(?<name>[A-Za-z_]\w*)?(?:\[(?<tag>(?:[A-Za-z_]\w*)?)\])?(?:\{(?<args>[^}]*)\})?\)/.exec(t);if(!e)throw new Error(`Incomplete or invalid named callout "${t}"`);const{name:n,tag:s,args:r}=e.groups;if(!n)throw new Error(`Invalid named callout "${t}"`);if(s==="")throw new Error(`Named callout tag with empty value not allowed "${t}"`);const a=r?r.split(",").filter(h=>h!=="").map(h=>/^[+-]?\d+$/.test(h)?+h:h):[],[i,c,l]=a,u=xl.has(n)?n.toLowerCase():"custom";switch(u){case"fail":case"mismatch":case"skip":if(a.length>0)throw new Error(`Named callout arguments not allowed "${a}"`);break;case"error":if(a.length>1)throw new Error(`Named callout allows only one argument "${a}"`);if(typeof i=="string")throw new Error(`Named callout argument must be a number "${i}"`);break;case"max":if(!a.length||a.length>2)throw new Error(`Named callout must have one or two arguments "${a}"`);if(typeof i=="string"&&!/^[A-Za-z_]\w*$/.test(i))throw new Error(`Named callout argument one must be a tag or number "${i}"`);if(a.length===2&&(typeof c=="number"||!/^[<>X]$/.test(c)))throw new Error(`Named callout optional argument two must be '<', '>', or 'X' "${c}"`);break;case"count":case"total_count":if(a.length>1)throw new Error(`Named callout allows only one argument "${a}"`);if(a.length===1&&(typeof i=="number"||!/^[<>X]$/.test(i)))throw new Error(`Named callout optional argument must be '<', '>', or 'X' "${i}"`);break;case"cmp":if(a.length!==3)throw new Error(`Named callout must have three arguments "${a}"`);if(typeof i=="string"&&!/^[A-Za-z_]\w*$/.test(i))throw new Error(`Named callout argument one must be a tag or number "${i}"`);if(typeof c=="number"||!/^(?:[<>!=]=|[<>])$/.test(c))throw new Error(`Named callout argument two must be '==', '!=', '>', '<', '>=', or '<=' "${c}"`);if(typeof l=="string"&&!/^[A-Za-z_]\w*$/.test(l))throw new Error(`Named callout argument three must be a tag or number "${l}"`);break;case"custom":throw new Error(`Undefined callout name "${n}"`);default:throw new Error(`Unexpected named callout kind "${u}"`)}return vl(u,s??null,r?.split(",")??null,t)}function ls(t){let e=null,n,s;if(t[0]==="{"){const{minStr:r,maxStr:a}=/^\{(?<minStr>\d*)(?:,(?<maxStr>\d*))?/.exec(t).groups,i=1e5;if(+r>i||a&&+a>i)throw new Error("Quantifier value unsupported in Oniguruma");if(n=+r,s=a===void 0?+r:a===""?1/0:+a,n>s&&(e="possessive",[n,s]=[s,n]),t.endsWith("?")){if(e==="possessive")throw new Error('Unsupported possessive interval quantifier chain with "?"');e="lazy"}else e||(e="greedy")}else n=t[0]==="+"?1:0,s=t[0]==="?"?1:1/0,e=t[1]==="+"?"possessive":t[1]==="?"?"lazy":"greedy";return Sl(e,n,s,t)}function Rl(t){const e=t[1].toLowerCase();return me({d:"digit",h:"hex",s:"space",w:"word"}[e],t,{negate:t[1]!==e})}function $l(t){const{p:e,neg:n,value:s}=/^\\(?<p>[pP])\{(?<neg>\^?)(?<value>[^}]+)/.exec(t).groups;return me("property",t,{value:s,negate:e==="P"&&!n||e==="p"&&!!n})}function cs(t){const e={};return t.includes("i")&&(e.ignoreCase=!0),t.includes("m")&&(e.dotAll=!0),t.includes("x")&&(e.extended=!0),Object.keys(e).length?e:null}function Ll(t){const e={ignoreCase:!1,dotAll:!1,extended:!1,digitIsAscii:!1,posixIsAscii:!1,spaceIsAscii:!1,wordIsAscii:!1,textSegmentMode:null};for(let n=0;n<t.length;n++){const s=t[n];if(!"imxDPSWy".includes(s))throw new Error(`Invalid flag "${s}"`);if(s==="y"){if(!/^y{[gw]}/.test(t.slice(n)))throw new Error('Invalid or unspecified flag "y" mode');e.textSegmentMode=t[n+2]==="g"?"grapheme":"word",n+=3;continue}e[{i:"ignoreCase",m:"dotAll",x:"extended",D:"digitIsAscii",P:"posixIsAscii",S:"spaceIsAscii",W:"wordIsAscii"}[s]]=!0}return e}function Ml(t){if(new RegExp("^(?:\\\\u(?!\\p{AHex}{4})|\\\\x(?!\\p{AHex}{1,2}|\\{\\p{AHex}{1,8}\\}))","u").test(t))throw new Error(`Incomplete or invalid escape "${t}"`);const e=t[2]==="{"?new RegExp("^\\\\x\\{\\s*(?<hex>\\p{AHex}+)","u").exec(t).groups.hex:t.slice(2);return parseInt(e,16)}function Tl(t,e){const{raw:n,inCharClass:s}=t,r=n.slice(1);if(!s&&(r!=="0"&&r.length===1||r[0]!=="0"&&+r<=e))return[Ar(n)];const a=[],i=r.match(/^[0-7]+|\d/g);for(let c=0;c<i.length;c++){const l=i[c];let u;if(c===0&&l!=="8"&&l!=="9"){if(u=parseInt(l,8),u>127)throw new Error(O`Octal encoded byte above 177 unsupported "${n}"`)}else u=$e(l);a.push(se(u,(c===0?"\\":"")+l))}return a}function Nl(t){const e=[],n=new RegExp(An,"gy");let s;for(;s=n.exec(t);){const r=s[0];if(r[0]==="{"){const a=/^\{(?<min>\d+),(?<max>\d+)\}\??$/.exec(r);if(a){const{min:i,max:c}=a.groups;if(+i>+c&&r.endsWith("?")){n.lastIndex--,e.push(ls(r.slice(0,-1)));continue}}}e.push(ls(r))}return e}function Sr(t,e){if(!Array.isArray(t.body))throw new Error("Expected node with body array");if(t.body.length!==1)return!1;const n=t.body[0];return!e||Object.keys(e).every(s=>e[s]===n[s])}function Pl(t){return Ol.has(t.type)}const Ol=new Set(["AbsenceFunction","Backreference","CapturingGroup","Character","CharacterClass","CharacterSet","Group","Quantifier","Subroutine"]);function Er(t,e={}){const n={flags:"",normalizeUnknownPropertyNames:!1,skipBackrefValidation:!1,skipLookbehindValidation:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...e,rules:{captureGroup:!1,singleline:!1,...e.rules}},s=gl(t,{flags:n.flags,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline}}),r=(g,f)=>{const d=s.tokens[a.nextIndex];switch(a.parent=g,a.nextIndex++,d.type){case"Alternator":return be();case"Assertion":return Gl(d);case"Backreference":return Fl(d,a);case"Character":return _t(d.value,{useLastValid:!!f.isCheckingRangeEnd});case"CharacterClassHyphen":return jl(d,a,f);case"CharacterClassOpen":return Ul(d,a,f);case"CharacterSet":return zl(d,a);case"Directive":return Xl(d.kind,{flags:d.flags});case"GroupOpen":return Wl(d,a,f);case"NamedCallout":return Zl(d.kind,d.tag,d.arguments);case"Quantifier":return Hl(d,a);case"Subroutine":return ql(d,a);default:throw new Error(`Unexpected token type "${d.type}"`)}},a={capturingGroups:[],hasNumberedRef:!1,namedGroupsByName:new Map,nextIndex:0,normalizeUnknownPropertyNames:n.normalizeUnknownPropertyNames,parent:null,skipBackrefValidation:n.skipBackrefValidation,skipLookbehindValidation:n.skipLookbehindValidation,skipPropertyNameValidation:n.skipPropertyNameValidation,subroutines:[],tokens:s.tokens,unicodePropertyMap:n.unicodePropertyMap,walk:r},i=Yl(Ql(s.flags));let c=i.body[0];for(;a.nextIndex<s.tokens.length;){const g=r(c,{});g.type==="Alternative"?(i.body.push(g),c=g):c.body.push(g)}const{capturingGroups:l,hasNumberedRef:u,namedGroupsByName:h,subroutines:p}=a;if(u&&h.size&&!n.rules.captureGroup)throw new Error("Numbered backref/subroutine not allowed when using named capture");for(const{ref:g}of p)if(typeof g=="number"){if(g>l.length)throw new Error("Subroutine uses a group number that's not defined");g&&(l[g-1].isSubroutined=!0)}else if(h.has(g)){if(h.get(g).length>1)throw new Error(O`Subroutine uses a duplicate group name "\g<${g}>"`);h.get(g)[0].isSubroutined=!0}else throw new Error(O`Subroutine uses a group name that's not defined "\g<${g}>"`);return i}function Gl({kind:t}){return rn(Le({"^":"line_start",$:"line_end","\\A":"string_start","\\b":"word_boundary","\\B":"word_boundary","\\G":"search_start","\\y":"text_segment_boundary","\\Y":"text_segment_boundary","\\z":"string_end","\\Z":"string_end_newline"}[t],`Unexpected assertion kind "${t}"`),{negate:t===O`\B`||t===O`\Y`})}function Fl({raw:t},e){const n=/^\\k[<']/.test(t),s=n?t.slice(3,-1):t.slice(1),r=(a,i=!1)=>{const c=e.capturingGroups.length;let l=!1;if(a>c)if(e.skipBackrefValidation)l=!0;else throw new Error(`Not enough capturing groups defined to the left "${t}"`);return e.hasNumberedRef=!0,an(i?c+1-a:a,{orphan:l})};if(n){const a=/^(?<sign>-?)0*(?<num>[1-9]\d*)$/.exec(s);if(a)return r(+a.groups.num,!!a.groups.sign);if(/[-+]/.test(s))throw new Error(`Invalid backref name "${t}"`);if(!e.namedGroupsByName.has(s))throw new Error(`Group name not defined to the left "${t}"`);return an(s)}return r(+s)}function jl(t,e,n){const{tokens:s,walk:r}=e,a=e.parent,i=a.body.at(-1),c=s[e.nextIndex];if(!n.isCheckingRangeEnd&&i&&i.type!=="CharacterClass"&&i.type!=="CharacterClassRange"&&c&&c.type!=="CharacterClassOpen"&&c.type!=="CharacterClassClose"&&c.type!=="CharacterClassIntersector"){const l=r(a,{...n,isCheckingRangeEnd:!0});if(i.type==="Character"&&l.type==="Character")return a.body.pop(),Kl(i,l);throw new Error("Invalid character class range")}return _t($e("-"))}function Ul({negate:t},e,n){const{tokens:s,walk:r}=e,a=s[e.nextIndex],i=[rt()];let c=ps(a);for(;c.type!=="CharacterClassClose";){if(c.type==="CharacterClassIntersector")i.push(rt()),e.nextIndex++;else{const u=i.at(-1);u.body.push(r(u,n))}c=ps(s[e.nextIndex],a)}const l=rt({negate:t});return i.length===1?l.body=i[0].body:(l.kind="intersection",l.body=i.map(u=>u.body.length===1?u.body[0]:u)),e.nextIndex++,l}function zl({kind:t,negate:e,value:n},s){const{normalizeUnknownPropertyNames:r,skipPropertyNameValidation:a,unicodePropertyMap:i}=s;if(t==="property"){const c=At(n);if(_n.has(c)&&!i?.has(c))t="posix",n=c;else return Se(n,{negate:e,normalizeUnknownPropertyNames:r,skipPropertyNameValidation:a,unicodePropertyMap:i})}return t==="posix"?Jl(n,{negate:e}):on(t,{negate:e})}function Wl(t,e,n){const{tokens:s,capturingGroups:r,namedGroupsByName:a,skipLookbehindValidation:i,walk:c}=e,l=ec(t),u=l.type==="AbsenceFunction",h=hs(l),p=h&&l.negate;if(l.type==="CapturingGroup"&&(r.push(l),l.name&&dl(a,l.name,[]).push(l)),u&&n.isInAbsenceFunction)throw new Error("Nested absence function not supported by Oniguruma");let g=ds(s[e.nextIndex]);for(;g.type!=="GroupClose";){if(g.type==="Alternator")l.body.push(be()),e.nextIndex++;else{const f=l.body.at(-1),d=c(f,{...n,isInAbsenceFunction:n.isInAbsenceFunction||u,isInLookbehind:n.isInLookbehind||h,isInNegLookbehind:n.isInNegLookbehind||p});if(f.body.push(d),(h||n.isInLookbehind)&&!i){const k="Lookbehind includes a pattern not allowed by Oniguruma";if(p||n.isInNegLookbehind){if(us(d)||d.type==="CapturingGroup")throw new Error(k)}else if(us(d)||hs(d)&&d.negate)throw new Error(k)}}g=ds(s[e.nextIndex])}return e.nextIndex++,l}function Hl({kind:t,min:e,max:n},s){const r=s.parent,a=r.body.at(-1);if(!a||!Pl(a))throw new Error("Quantifier requires a repeatable token");const i=Dr(t,e,n,a);return r.body.pop(),i}function ql({raw:t},e){const{capturingGroups:n,subroutines:s}=e;let r=t.slice(3,-1);const a=/^(?<sign>[-+]?)0*(?<num>[1-9]\d*)$/.exec(r);if(a){const c=+a.groups.num,l=n.length;if(e.hasNumberedRef=!0,r={"":c,"+":l+c,"-":l+1-c}[a.groups.sign],r<1)throw new Error("Invalid subroutine number")}else r==="0"&&(r=0);const i=Br(r);return s.push(i),i}function Vl(t,e){return{type:"AbsenceFunction",kind:t,body:Ke(e?.body)}}function be(t){return{type:"Alternative",body:Ir(t?.body)}}function rn(t,e){const n={type:"Assertion",kind:t};return(t==="word_boundary"||t==="text_segment_boundary")&&(n.negate=!!e?.negate),n}function an(t,e){const n=!!e?.orphan;return{type:"Backreference",ref:t,...n&&{orphan:n}}}function xr(t,e){const n={name:void 0,isSubroutined:!1,...e};if(n.name!==void 0&&!tc(n.name))throw new Error(`Group name "${n.name}" invalid in Oniguruma`);return{type:"CapturingGroup",number:t,...n.name&&{name:n.name},...n.isSubroutined&&{isSubroutined:n.isSubroutined},body:Ke(e?.body)}}function _t(t,e){const n={useLastValid:!1,...e};if(t>1114111){const s=t.toString(16);if(n.useLastValid)t=1114111;else throw t>1310719?new Error(`Invalid code point out of range "\\x{${s}}"`):new Error(`Invalid code point out of range in JS "\\x{${s}}"`)}return{type:"Character",value:t}}function rt(t){const e={kind:"union",negate:!1,...t};return{type:"CharacterClass",kind:e.kind,negate:e.negate,body:Ir(t?.body)}}function Kl(t,e){if(e.value<t.value)throw new Error("Character class range out of order");return{type:"CharacterClassRange",min:t,max:e}}function on(t,e){const n=!!e?.negate,s={type:"CharacterSet",kind:t};return(t==="digit"||t==="hex"||t==="newline"||t==="space"||t==="word")&&(s.negate=n),(t==="text_segment"||t==="newline"&&!n)&&(s.variableLength=!0),s}function Xl(t,e={}){if(t==="keep")return{type:"Directive",kind:t};if(t==="flags")return{type:"Directive",kind:t,flags:Le(e.flags)};throw new Error(`Unexpected directive kind "${t}"`)}function Ql(t){return{type:"Flags",...t}}function X(t){const e=t?.atomic,n=t?.flags;if(e&&n)throw new Error("Atomic group cannot have flags");return{type:"Group",...e&&{atomic:e},...n&&{flags:n},body:Ke(t?.body)}}function ge(t){const e={behind:!1,negate:!1,...t};return{type:"LookaroundAssertion",kind:e.behind?"lookbehind":"lookahead",negate:e.negate,body:Ke(t?.body)}}function Zl(t,e,n){return{type:"NamedCallout",kind:t,tag:e,arguments:n}}function Jl(t,e){const n=!!e?.negate;if(!_n.has(t))throw new Error(`Invalid POSIX class "${t}"`);return{type:"CharacterSet",kind:"posix",value:t,negate:n}}function Dr(t,e,n,s){if(e>n)throw new Error("Invalid reversed quantifier range");return{type:"Quantifier",kind:t,min:e,max:n,body:s}}function Yl(t,e){return{type:"Regex",body:Ke(e?.body),flags:t}}function Br(t){return{type:"Subroutine",ref:t}}function Se(t,e){const n={negate:!1,normalizeUnknownPropertyNames:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...e};let s=n.unicodePropertyMap?.get(At(t));if(!s){if(n.normalizeUnknownPropertyNames)s=nc(t);else if(n.unicodePropertyMap&&!n.skipPropertyNameValidation)throw new Error(O`Invalid Unicode property "\p{${t}}"`)}return{type:"CharacterSet",kind:"property",value:s??t,negate:n.negate}}function ec({flags:t,kind:e,name:n,negate:s,number:r}){switch(e){case"absence_repeater":return Vl("repeater");case"atomic":return X({atomic:!0});case"capturing":return xr(r,{name:n});case"group":return X({flags:t});case"lookahead":case"lookbehind":return ge({behind:e==="lookbehind",negate:s});default:throw new Error(`Unexpected group kind "${e}"`)}}function Ke(t){if(t===void 0)t=[be()];else if(!Array.isArray(t)||!t.length||!t.every(e=>e.type==="Alternative"))throw new Error("Invalid body; expected array of one or more Alternative nodes");return t}function Ir(t){if(t===void 0)t=[];else if(!Array.isArray(t)||!t.every(e=>!!e.type))throw new Error("Invalid body; expected array of nodes");return t}function us(t){return t.type==="LookaroundAssertion"&&t.kind==="lookahead"}function hs(t){return t.type==="LookaroundAssertion"&&t.kind==="lookbehind"}function tc(t){return/^[\p{Alpha}\p{Pc}][^)]*$/u.test(t)}function nc(t){return t.trim().replace(/[- _]+/g,"_").replace(/[A-Z][a-z]+(?=[A-Z])/g,"$&_").replace(/[A-Za-z]+/g,e=>e[0].toUpperCase()+e.slice(1).toLowerCase())}function At(t){return t.replace(/[- _]+/g,"").toLowerCase()}function ps(t,e){return Le(t,`${e?.type==="Character"&&e.value===93?"Empty":"Unclosed"} character class`)}function ds(t){return Le(t,"Unclosed group")}function Ge(t,e,n=null){function s(a,i){for(let c=0;c<a.length;c++){const l=r(a[c],i,c,a);c=Math.max(-1,c+l)}}function r(a,i=null,c=null,l=null){let u=0,h=!1;const p={node:a,parent:i,key:c,container:l,root:t,remove(){et(l).splice(Math.max(0,_e(c)+u),1),u--,h=!0},removeAllNextSiblings(){return et(l).splice(_e(c)+1)},removeAllPrevSiblings(){const b=_e(c)+u;return u-=b,et(l).splice(0,Math.max(0,b))},replaceWith(b,y={}){const _=!!y.traverse;l?l[Math.max(0,_e(c)+u)]=b:Le(i,"Can't replace root node")[c]=b,_&&r(b,i,c,l),h=!0},replaceWithMultiple(b,y={}){const _=!!y.traverse;if(et(l).splice(Math.max(0,_e(c)+u),1,...b),u+=b.length-1,_){let A=0;for(let v=0;v<b.length;v++)A+=r(b[v],i,_e(c)+v+A,l)}h=!0},skip(){h=!0}},{type:g}=a,f=e["*"],d=e[g],k=typeof f=="function"?f:f?.enter,w=typeof d=="function"?d:d?.enter;if(k?.(p,n),w?.(p,n),!h)switch(g){case"AbsenceFunction":case"CapturingGroup":case"Group":s(a.body,a);break;case"Alternative":case"CharacterClass":s(a.body,a);break;case"Assertion":case"Backreference":case"Character":case"CharacterSet":case"Directive":case"Flags":case"NamedCallout":case"Subroutine":break;case"CharacterClassRange":r(a.min,a,"min"),r(a.max,a,"max");break;case"LookaroundAssertion":s(a.body,a);break;case"Quantifier":r(a.body,a,"body");break;case"Regex":s(a.body,a),r(a.flags,a,"flags");break;default:throw new Error(`Unexpected node type "${g}"`)}return d?.exit?.(p,n),f?.exit?.(p,n),u}return r(t),t}function et(t){if(!Array.isArray(t))throw new Error("Container expected");return t}function _e(t){if(typeof t!="number")throw new Error("Numeric key expected");return t}const sc=String.raw`\(\?(?:[:=!>A-Za-z\-]|<[=!]|\(DEFINE\))`;function rc(t,e){for(let n=0;n<t.length;n++)t[n]>=e&&t[n]++}function ac(t,e,n,s){return t.slice(0,e)+s+t.slice(e+n.length)}const K=Object.freeze({DEFAULT:"DEFAULT",CHAR_CLASS:"CHAR_CLASS"});function vn(t,e,n,s){const r=new RegExp(String.raw`${e}|(?<$skip>\[\^?|\\?.)`,"gsu"),a=[!1];let i=0,c="";for(const l of t.matchAll(r)){const{0:u,groups:{$skip:h}}=l;if(!h&&(!s||s===K.DEFAULT==!i)){n instanceof Function?c+=n(l,{context:i?K.CHAR_CLASS:K.DEFAULT,negated:a[a.length-1]}):c+=n;continue}u[0]==="["?(i++,a.push(u[1]==="^")):u==="]"&&i&&(i--,a.pop()),c+=u}return c}function Rr(t,e,n,s){vn(t,e,n,s)}function ic(t,e,n=0,s){if(!new RegExp(e,"su").test(t))return null;const r=new RegExp(`${e}|(?<$skip>\\\\?.)`,"gsu");r.lastIndex=n;let a=0,i;for(;i=r.exec(t);){const{0:c,groups:{$skip:l}}=i;if(!l&&(!s||s===K.DEFAULT==!a))return i;c==="["?a++:c==="]"&&a&&a--,r.lastIndex==i.index&&r.lastIndex++}return null}function tt(t,e,n){return!!ic(t,e,0,n)}function oc(t,e){const n=/\\?./gsu;n.lastIndex=e;let s=t.length,r=0,a=1,i;for(;i=n.exec(t);){const[c]=i;if(c==="[")r++;else if(r)c==="]"&&r--;else if(c==="(")a++;else if(c===")"&&(a--,!a)){s=i.index;break}}return t.slice(e,s)}const gs=new RegExp(String.raw`(?<noncapturingStart>${sc})|(?<capturingStart>\((?:\?<[^>]+>)?)|\\?.`,"gsu");function lc(t,e){const n=e?.hiddenCaptures??[];let s=e?.captureTransfers??new Map;if(!/\(\?>/.test(t))return{pattern:t,captureTransfers:s,hiddenCaptures:n};const r="(?>",a="(?:(?=(",i=[0],c=[];let l=0,u=0,h=NaN,p;do{p=!1;let g=0,f=0,d=!1,k;for(gs.lastIndex=Number.isNaN(h)?0:h+a.length;k=gs.exec(t);){const{0:w,index:b,groups:{capturingStart:y,noncapturingStart:_}}=k;if(w==="[")g++;else if(g)w==="]"&&g--;else if(w===r&&!d)h=b,d=!0;else if(d&&_)f++;else if(y)d?f++:(l++,i.push(l+u));else if(w===")"&&d){if(!f){u++;const A=l+u;if(t=`${t.slice(0,h)}${a}${t.slice(h+r.length,b)}))<$$${A}>)${t.slice(b+1)}`,p=!0,c.push(A),rc(n,A),s.size){const v=new Map;s.forEach((D,I)=>{v.set(I>=A?I+1:I,D.map(G=>G>=A?G+1:G))}),s=v}break}f--}}}while(p);return n.push(...c),t=vn(t,String.raw`\\(?<backrefNum>[1-9]\d*)|<\$\$(?<wrappedBackrefNum>\d+)>`,({0:g,groups:{backrefNum:f,wrappedBackrefNum:d}})=>{if(f){const k=+f;if(k>i.length-1)throw new Error(`Backref "${g}" greater than number of captures`);return`\\${i[k]}`}return`\\${d}`},K.DEFAULT),{pattern:t,captureTransfers:s,hiddenCaptures:n}}const $r=String.raw`(?:[?*+]|\{\d+(?:,\d*)?\})`,Pt=new RegExp(String.raw`
\\(?: \d+
  | c[A-Za-z]
  | [gk]<[^>]+>
  | [pPu]\{[^\}]+\}
  | u[A-Fa-f\d]{4}
  | x[A-Fa-f\d]{2}
  )
| \((?: \? (?: [:=!>]
  | <(?:[=!]|[^>]+>)
  | [A-Za-z\-]+:
  | \(DEFINE\)
  ))?
| (?<qBase>${$r})(?<qMod>[?+]?)(?<invalidQ>[?*+\{]?)
| \\?.
`.replace(/\s+/g,""),"gsu");function cc(t){if(!new RegExp(`${$r}\\+`).test(t))return{pattern:t};const e=[];let n=null,s=null,r="",a=0,i;for(Pt.lastIndex=0;i=Pt.exec(t);){const{0:c,index:l,groups:{qBase:u,qMod:h,invalidQ:p}}=i;if(c==="[")a||(s=l),a++;else if(c==="]")a?a--:s=null;else if(!a)if(h==="+"&&r&&!r.startsWith("(")){if(p)throw new Error(`Invalid quantifier "${c}"`);let g=-1;if(/^\{\d+\}$/.test(u))t=ac(t,l+u.length,h,"");else{if(r===")"||r==="]"){const f=r===")"?n:s;if(f===null)throw new Error(`Invalid unmatched "${r}"`);t=`${t.slice(0,f)}(?>${t.slice(f,l)}${u})${t.slice(l+c.length)}`}else t=`${t.slice(0,l-r.length)}(?>${r}${u})${t.slice(l+c.length)}`;g+=4}Pt.lastIndex+=g}else c[0]==="("?e.push(l):c===")"&&(n=e.length?e.pop():null);r=c}return{pattern:t}}const q=String.raw,uc=q`\\g<(?<gRNameOrNum>[^>&]+)&R=(?<gRDepth>[^>]+)>`,ln=q`\(\?R=(?<rDepth>[^\)]+)\)|${uc}`,vt=q`\(\?<(?![=!])(?<captureName>[^>]+)>`,Lr=q`${vt}|(?<unnamed>\()(?!\?)`,pe=new RegExp(q`${vt}|${ln}|\(\?|\\?.`,"gsu"),Ot="Cannot use multiple overlapping recursions";function hc(t,e){const{hiddenCaptures:n,mode:s}={hiddenCaptures:[],mode:"plugin",...e};let r=e?.captureTransfers??new Map;if(!new RegExp(ln,"su").test(t))return{pattern:t,captureTransfers:r,hiddenCaptures:n};if(s==="plugin"&&tt(t,q`\(\?\(DEFINE\)`,K.DEFAULT))throw new Error("DEFINE groups cannot be used with recursion");const a=[],i=tt(t,q`\\[1-9]`,K.DEFAULT),c=new Map,l=[];let u=!1,h=0,p=0,g;for(pe.lastIndex=0;g=pe.exec(t);){const{0:f,groups:{captureName:d,rDepth:k,gRNameOrNum:w,gRDepth:b}}=g;if(f==="[")h++;else if(h)f==="]"&&h--;else if(k){if(fs(k),u)throw new Error(Ot);if(i)throw new Error(`${s==="external"?"Backrefs":"Numbered backrefs"} cannot be used with global recursion`);const y=t.slice(0,g.index),_=t.slice(pe.lastIndex);if(tt(_,ln,K.DEFAULT))throw new Error(Ot);const A=+k-1;t=ms(y,_,A,!1,n,a,p),r=ks(r,y,A,a.length,0,p);break}else if(w){fs(b);let y=!1;for(const ae of l)if(ae.name===w||ae.num===+w){if(y=!0,ae.hasRecursedWithin)throw new Error(Ot);break}if(!y)throw new Error(q`Recursive \g cannot be used outside the referenced group "${s==="external"?w:q`\g<${w}&R=${b}>`}"`);const _=c.get(w),A=oc(t,_);if(i&&tt(A,q`${vt}|\((?!\?)`,K.DEFAULT))throw new Error(`${s==="external"?"Backrefs":"Numbered backrefs"} cannot be used with recursion of capturing groups`);const v=t.slice(_,g.index),D=A.slice(v.length+f.length),I=a.length,G=+b-1,Y=ms(v,D,G,!0,n,a,p);r=ks(r,v,G,a.length-I,I,p);const St=t.slice(0,_),Me=t.slice(_+A.length);t=`${St}${Y}${Me}`,pe.lastIndex+=Y.length-f.length-v.length-D.length,l.forEach(ae=>ae.hasRecursedWithin=!0),u=!0}else if(d)p++,c.set(String(p),pe.lastIndex),c.set(d,pe.lastIndex),l.push({num:p,name:d});else if(f[0]==="("){const y=f==="(";y&&(p++,c.set(String(p),pe.lastIndex)),l.push(y?{num:p}:{})}else f===")"&&l.pop()}return n.push(...a),{pattern:t,captureTransfers:r,hiddenCaptures:n}}function fs(t){const e=`Max depth must be integer between 2 and 100; used ${t}`;if(!/^[1-9]\d*$/.test(t))throw new Error(e);if(t=+t,t<2||t>100)throw new Error(e)}function ms(t,e,n,s,r,a,i){const c=new Set;s&&Rr(t+e,vt,({groups:{captureName:u}})=>{c.add(u)},K.DEFAULT);const l=[n,s?c:null,r,a,i];return`${t}${ys(`(?:${t}`,"forward",...l)}(?:)${ys(`${e})`,"backward",...l)}${e}`}function ys(t,e,n,s,r,a,i){const l=h=>e==="forward"?h+2:n-h+2-1;let u="";for(let h=0;h<n;h++){const p=l(h);u+=vn(t,q`${Lr}|\\k<(?<backref>[^>]+)>`,({0:g,groups:{captureName:f,unnamed:d,backref:k}})=>{if(k&&s&&!s.has(k))return g;const w=`_$${p}`;if(d||f){const b=i+a.length+1;return a.push(b),pc(r,b),d?g:`(?<${f}${w}>`}return q`\k<${k}${w}>`},K.DEFAULT)}return u}function pc(t,e){for(let n=0;n<t.length;n++)t[n]>=e&&t[n]++}function ks(t,e,n,s,r,a){if(t.size&&s){let i=0;Rr(e,Lr,()=>i++,K.DEFAULT);const c=a-i+r,l=new Map;return t.forEach((u,h)=>{const p=(s-i*n)/n,g=i*n,f=h>c+i?h+s:h,d=[];for(const k of u)if(k<=c)d.push(k);else if(k>c+i+p)d.push(k+s);else if(k<=c+i)for(let w=0;w<=n;w++)d.push(k+i*w);else for(let w=0;w<=n;w++)d.push(k+g+p*w);l.set(f,d)}),l}return t}var M=String.fromCodePoint,S=String.raw,re={flagGroups:(()=>{try{new RegExp("(?i:)")}catch{return!1}return!0})(),unicodeSets:(()=>{try{new RegExp("","v")}catch{return!1}return!0})()};re.bugFlagVLiteralHyphenIsRange=re.unicodeSets?(()=>{try{new RegExp(S`[\d\-a]`,"v")}catch{return!0}return!1})():!1;re.bugNestedClassIgnoresNegation=re.unicodeSets&&new RegExp("[[^a]]","v").test("a");function yt(t,{enable:e,disable:n}){return{dotAll:!n?.dotAll&&!!(e?.dotAll||t.dotAll),ignoreCase:!n?.ignoreCase&&!!(e?.ignoreCase||t.ignoreCase)}}function He(t,e,n){return t.has(e)||t.set(e,n),t.get(e)}function cn(t,e){return bs[t]>=bs[e]}function dc(t,e){if(t==null)throw new Error(e??"Value expected");return t}var bs={ES2025:2025,ES2024:2024,ES2018:2018},gc={auto:"auto",ES2025:"ES2025",ES2024:"ES2024",ES2018:"ES2018"};function Mr(t={}){if({}.toString.call(t)!=="[object Object]")throw new Error("Unexpected options");if(t.target!==void 0&&!gc[t.target])throw new Error(`Unexpected target "${t.target}"`);const e={accuracy:"default",avoidSubclass:!1,flags:"",global:!1,hasIndices:!1,lazyCompileLength:1/0,target:"auto",verbose:!1,...t,rules:{allowOrphanBackrefs:!1,asciiWordBoundaries:!1,captureGroup:!1,recursionLimit:20,singleline:!1,...t.rules}};return e.target==="auto"&&(e.target=re.flagGroups?"ES2025":re.unicodeSets?"ES2024":"ES2018"),e}var fc="[	-\r ]",mc=new Set([M(304),M(305)]),te=S`[\p{L}\p{M}\p{N}\p{Pc}]`;function Tr(t){if(mc.has(t))return[t];const e=new Set,n=t.toLowerCase(),s=n.toUpperCase(),r=bc.get(n),a=yc.get(n),i=kc.get(n);return[...s].length===1&&e.add(s),i&&e.add(i),r&&e.add(r),e.add(n),a&&e.add(a),[...e]}var Sn=new Map(`C Other
Cc Control cntrl
Cf Format
Cn Unassigned
Co Private_Use
Cs Surrogate
L Letter
LC Cased_Letter
Ll Lowercase_Letter
Lm Modifier_Letter
Lo Other_Letter
Lt Titlecase_Letter
Lu Uppercase_Letter
M Mark Combining_Mark
Mc Spacing_Mark
Me Enclosing_Mark
Mn Nonspacing_Mark
N Number
Nd Decimal_Number digit
Nl Letter_Number
No Other_Number
P Punctuation punct
Pc Connector_Punctuation
Pd Dash_Punctuation
Pe Close_Punctuation
Pf Final_Punctuation
Pi Initial_Punctuation
Po Other_Punctuation
Ps Open_Punctuation
S Symbol
Sc Currency_Symbol
Sk Modifier_Symbol
Sm Math_Symbol
So Other_Symbol
Z Separator
Zl Line_Separator
Zp Paragraph_Separator
Zs Space_Separator
ASCII
ASCII_Hex_Digit AHex
Alphabetic Alpha
Any
Assigned
Bidi_Control Bidi_C
Bidi_Mirrored Bidi_M
Case_Ignorable CI
Cased
Changes_When_Casefolded CWCF
Changes_When_Casemapped CWCM
Changes_When_Lowercased CWL
Changes_When_NFKC_Casefolded CWKCF
Changes_When_Titlecased CWT
Changes_When_Uppercased CWU
Dash
Default_Ignorable_Code_Point DI
Deprecated Dep
Diacritic Dia
Emoji
Emoji_Component EComp
Emoji_Modifier EMod
Emoji_Modifier_Base EBase
Emoji_Presentation EPres
Extended_Pictographic ExtPict
Extender Ext
Grapheme_Base Gr_Base
Grapheme_Extend Gr_Ext
Hex_Digit Hex
IDS_Binary_Operator IDSB
IDS_Trinary_Operator IDST
ID_Continue IDC
ID_Start IDS
Ideographic Ideo
Join_Control Join_C
Logical_Order_Exception LOE
Lowercase Lower
Math
Noncharacter_Code_Point NChar
Pattern_Syntax Pat_Syn
Pattern_White_Space Pat_WS
Quotation_Mark QMark
Radical
Regional_Indicator RI
Sentence_Terminal STerm
Soft_Dotted SD
Terminal_Punctuation Term
Unified_Ideograph UIdeo
Uppercase Upper
Variation_Selector VS
White_Space space
XID_Continue XIDC
XID_Start XIDS`.split(/\s/).map(t=>[At(t),t])),yc=new Map([["s",M(383)],[M(383),"s"]]),kc=new Map([[M(223),M(7838)],[M(107),M(8490)],[M(229),M(8491)],[M(969),M(8486)]]),bc=new Map([ie(453),ie(456),ie(459),ie(498),...Gt(8072,8079),...Gt(8088,8095),...Gt(8104,8111),ie(8124),ie(8140),ie(8188)]),wc=new Map([["alnum",S`[\p{Alpha}\p{Nd}]`],["alpha",S`\p{Alpha}`],["ascii",S`\p{ASCII}`],["blank",S`[\p{Zs}\t]`],["cntrl",S`\p{Cc}`],["digit",S`\p{Nd}`],["graph",S`[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]`],["lower",S`\p{Lower}`],["print",S`[[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]\p{Zs}]`],["punct",S`[\p{P}\p{S}]`],["space",S`\p{space}`],["upper",S`\p{Upper}`],["word",S`[\p{Alpha}\p{M}\p{Nd}\p{Pc}]`],["xdigit",S`\p{AHex}`]]);function Cc(t,e){const n=[];for(let s=t;s<=e;s++)n.push(s);return n}function ie(t){const e=M(t);return[e.toLowerCase(),e]}function Gt(t,e){return Cc(t,e).map(n=>ie(n))}var Nr=new Set(["Lower","Lowercase","Upper","Uppercase","Ll","Lowercase_Letter","Lt","Titlecase_Letter","Lu","Uppercase_Letter"]);function _c(t,e){const n={accuracy:"default",asciiWordBoundaries:!1,avoidSubclass:!1,bestEffortTarget:"ES2025",...e};Pr(t);const s={accuracy:n.accuracy,asciiWordBoundaries:n.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,flagDirectivesByAlt:new Map,jsGroupNameMap:new Map,minTargetEs2024:cn(n.bestEffortTarget,"ES2024"),passedLookbehind:!1,strategy:null,subroutineRefMap:new Map,supportedGNodes:new Set,digitIsAscii:t.flags.digitIsAscii,spaceIsAscii:t.flags.spaceIsAscii,wordIsAscii:t.flags.wordIsAscii};Ge(t,Ac,s);const r={dotAll:t.flags.dotAll,ignoreCase:t.flags.ignoreCase},a={currentFlags:r,prevFlags:null,globalFlags:r,groupOriginByCopy:new Map,groupsByName:new Map,multiplexCapturesToLeftByRef:new Map,openRefs:new Map,reffedNodesByReferencer:new Map,subroutineRefMap:s.subroutineRefMap};Ge(t,vc,a);const i={groupsByName:a.groupsByName,highestOrphanBackref:0,numCapturesToLeft:0,reffedNodesByReferencer:a.reffedNodesByReferencer};return Ge(t,Sc,i),t._originMap=a.groupOriginByCopy,t._strategy=s.strategy,t}var Ac={AbsenceFunction({node:t,parent:e,replaceWith:n}){const{body:s,kind:r}=t;if(r==="repeater"){const a=X();a.body[0].body.push(ge({negate:!0,body:s}),Se("Any"));const i=X();i.body[0].body.push(Dr("greedy",0,1/0,a)),n(R(i,e),{traverse:!0})}else throw new Error('Unsupported absence function "(?~|"')},Alternative:{enter({node:t,parent:e,key:n},{flagDirectivesByAlt:s}){const r=t.body.filter(a=>a.kind==="flags");for(let a=n+1;a<e.body.length;a++){const i=e.body[a];He(s,i,[]).push(...r)}},exit({node:t},{flagDirectivesByAlt:e}){if(e.get(t)?.length){const n=Gr(e.get(t));if(n){const s=X({flags:n});s.body[0].body=t.body,t.body=[R(s,t)]}}}},Assertion({node:t,parent:e,key:n,container:s,root:r,remove:a,replaceWith:i},c){const{kind:l,negate:u}=t,{asciiWordBoundaries:h,avoidSubclass:p,supportedGNodes:g,wordIsAscii:f}=c;if(l==="text_segment_boundary")throw new Error(`Unsupported text segment boundary "\\${u?"Y":"y"}"`);if(l==="line_end")i(R(ge({body:[be({body:[rn("string_end")]}),be({body:[_t(10)]})]}),e));else if(l==="line_start")i(R(ne(S`(?<=\A|\n(?!\z))`,{skipLookbehindValidation:!0}),e));else if(l==="search_start")if(g.has(t))r.flags.sticky=!0,a();else{const d=s[n-1];if(d&&Rc(d))i(R(ge({negate:!0}),e));else{if(p)throw new Error(S`Uses "\G" in a way that requires a subclass`);i(oe(rn("string_start"),e)),c.strategy="clip_search"}}else if(!(l==="string_end"||l==="string_start"))if(l==="string_end_newline")i(R(ne(S`(?=\n?\z)`),e));else if(l==="word_boundary"){if(!f&&!h){const d=`(?:(?<=${te})(?!${te})|(?<!${te})(?=${te}))`,k=`(?:(?<=${te})(?=${te})|(?<!${te})(?!${te}))`;i(R(ne(u?k:d),e))}}else throw new Error(`Unexpected assertion kind "${l}"`)},Backreference({node:t},{jsGroupNameMap:e}){let{ref:n}=t;typeof n=="string"&&!jt(n)&&(n=Ft(n,e),t.ref=n)},CapturingGroup({node:t},{jsGroupNameMap:e,subroutineRefMap:n}){let{name:s}=t;s&&!jt(s)&&(s=Ft(s,e),t.name=s),n.set(t.number,t),s&&n.set(s,t)},CharacterClassRange({node:t,parent:e,replaceWith:n}){if(e.kind==="intersection"){const s=rt({body:[t]});n(R(s,e),{traverse:!0})}},CharacterSet({node:t,parent:e,replaceWith:n},{accuracy:s,minTargetEs2024:r,digitIsAscii:a,spaceIsAscii:i,wordIsAscii:c}){const{kind:l,negate:u,value:h}=t;if(a&&(l==="digit"||h==="digit")){n(oe(on("digit",{negate:u}),e));return}if(i&&(l==="space"||h==="space")){n(R(Ut(ne(fc),u),e));return}if(c&&(l==="word"||h==="word")){n(oe(on("word",{negate:u}),e));return}if(l==="any")n(oe(Se("Any"),e));else if(l==="digit")n(oe(Se("Nd",{negate:u}),e));else if(l!=="dot")if(l==="text_segment"){if(s==="strict")throw new Error(S`Use of "\X" requires non-strict accuracy`);const p="\\p{Emoji}(?:\\p{EMod}|\\uFE0F\\u20E3?|[\\x{E0020}-\\x{E007E}]+\\x{E007F})?",g=S`\p{RI}{2}|${p}(?:\u200D${p})*`;n(R(ne(S`(?>\r\n|${r?S`\p{RGI_Emoji}`:g}|\P{M}\p{M}*)`,{skipPropertyNameValidation:!0}),e))}else if(l==="hex")n(oe(Se("AHex",{negate:u}),e));else if(l==="newline")n(R(ne(u?`[^
]`:`(?>\r
?|[
\v\f\u2028\u2029])`),e));else if(l==="posix")if(!r&&(h==="graph"||h==="print")){if(s==="strict")throw new Error(`POSIX class "${h}" requires min target ES2024 or non-strict accuracy`);let p={graph:"!-~",print:" -~"}[h];u&&(p=`\0-${M(p.codePointAt(0)-1)}${M(p.codePointAt(2)+1)}-􏿿`),n(R(ne(`[${p}]`),e))}else n(R(Ut(ne(wc.get(h)),u),e));else if(l==="property")Sn.has(At(h))||(t.key="sc");else if(l==="space")n(oe(Se("space",{negate:u}),e));else if(l==="word")n(R(Ut(ne(te),u),e));else throw new Error(`Unexpected character set kind "${l}"`)},Directive({node:t,parent:e,root:n,remove:s,replaceWith:r,removeAllPrevSiblings:a,removeAllNextSiblings:i}){const{kind:c,flags:l}=t;if(c==="flags")if(!l.enable&&!l.disable)s();else{const u=X({flags:l});u.body[0].body=i(),r(R(u,e),{traverse:!0})}else if(c==="keep"){const u=n.body[0],p=n.body.length===1&&Sr(u,{type:"Group"})&&u.body[0].body.length===1?u.body[0]:n;if(e.parent!==p||p.body.length>1)throw new Error(S`Uses "\K" in a way that's unsupported`);const g=ge({behind:!0});g.body[0].body=a(),r(R(g,e))}else throw new Error(`Unexpected directive kind "${c}"`)},Flags({node:t,parent:e}){if(t.posixIsAscii)throw new Error('Unsupported flag "P"');if(t.textSegmentMode==="word")throw new Error('Unsupported flag "y{w}"');["digitIsAscii","extended","posixIsAscii","spaceIsAscii","wordIsAscii","textSegmentMode"].forEach(n=>delete t[n]),Object.assign(t,{global:!1,hasIndices:!1,multiline:!1,sticky:t.sticky??!1}),e.options={disable:{x:!0,n:!0},force:{v:!0}}},Group({node:t}){if(!t.flags)return;const{enable:e,disable:n}=t.flags;e?.extended&&delete e.extended,n?.extended&&delete n.extended,e?.dotAll&&n?.dotAll&&delete e.dotAll,e?.ignoreCase&&n?.ignoreCase&&delete e.ignoreCase,e&&!Object.keys(e).length&&delete t.flags.enable,n&&!Object.keys(n).length&&delete t.flags.disable,!t.flags.enable&&!t.flags.disable&&delete t.flags},LookaroundAssertion({node:t},e){const{kind:n}=t;n==="lookbehind"&&(e.passedLookbehind=!0)},NamedCallout({node:t,parent:e,replaceWith:n}){const{kind:s}=t;if(s==="fail")n(R(ge({negate:!0}),e));else throw new Error(`Unsupported named callout "(*${s.toUpperCase()}"`)},Quantifier({node:t}){if(t.body.type==="Quantifier"){const e=X();e.body[0].body.push(t.body),t.body=R(e,t)}},Regex:{enter({node:t},{supportedGNodes:e}){const n=[];let s=!1,r=!1;for(const a of t.body)if(a.body.length===1&&a.body[0].kind==="search_start")a.body.pop();else{const i=jr(a.body);i?(s=!0,Array.isArray(i)?n.push(...i):n.push(i)):r=!0}s&&!r&&n.forEach(a=>e.add(a))},exit(t,{accuracy:e,passedLookbehind:n,strategy:s}){if(e==="strict"&&n&&s)throw new Error(S`Uses "\G" in a way that requires non-strict accuracy`)}},Subroutine({node:t},{jsGroupNameMap:e}){let{ref:n}=t;typeof n=="string"&&!jt(n)&&(n=Ft(n,e),t.ref=n)}},vc={Backreference({node:t},{multiplexCapturesToLeftByRef:e,reffedNodesByReferencer:n}){const{orphan:s,ref:r}=t;s||n.set(t,[...e.get(r).map(({node:a})=>a)])},CapturingGroup:{enter({node:t,parent:e,replaceWith:n,skip:s},{groupOriginByCopy:r,groupsByName:a,multiplexCapturesToLeftByRef:i,openRefs:c,reffedNodesByReferencer:l}){const u=r.get(t);if(u&&c.has(t.number)){const p=oe(ws(t.number),e);l.set(p,c.get(t.number)),n(p);return}c.set(t.number,t),i.set(t.number,[]),t.name&&He(i,t.name,[]);const h=i.get(t.name??t.number);for(let p=0;p<h.length;p++){const g=h[p];if(u===g.node||u&&u===g.origin||t===g.origin){h.splice(p,1);break}}if(i.get(t.number).push({node:t,origin:u}),t.name&&i.get(t.name).push({node:t,origin:u}),t.name){const p=He(a,t.name,new Map);let g=!1;if(u)g=!0;else for(const f of p.values())if(!f.hasDuplicateNameToRemove){g=!0;break}a.get(t.name).set(t,{node:t,hasDuplicateNameToRemove:g})}},exit({node:t},{openRefs:e}){e.delete(t.number)}},Group:{enter({node:t},e){e.prevFlags=e.currentFlags,t.flags&&(e.currentFlags=yt(e.currentFlags,t.flags))},exit(t,e){e.currentFlags=e.prevFlags}},Subroutine({node:t,parent:e,replaceWith:n},s){const{isRecursive:r,ref:a}=t;if(r){let h=e;for(;(h=h.parent)&&!(h.type==="CapturingGroup"&&(h.name===a||h.number===a)););s.reffedNodesByReferencer.set(t,h);return}const i=s.subroutineRefMap.get(a),c=a===0,l=c?ws(0):Or(i,s.groupOriginByCopy,null);let u=l;if(!c){const h=Gr(Dc(i,g=>g.type==="Group"&&!!g.flags)),p=h?yt(s.globalFlags,h):s.globalFlags;Ec(p,s.currentFlags)||(u=X({flags:Bc(p)}),u.body[0].body.push(l))}n(R(u,e),{traverse:!c})}},Sc={Backreference({node:t,parent:e,replaceWith:n},s){if(t.orphan){s.highestOrphanBackref=Math.max(s.highestOrphanBackref,t.ref);return}const a=s.reffedNodesByReferencer.get(t).filter(i=>xc(i,t));if(!a.length)n(R(ge({negate:!0}),e));else if(a.length>1){const i=X({atomic:!0,body:a.reverse().map(c=>be({body:[an(c.number)]}))});n(R(i,e))}else t.ref=a[0].number},CapturingGroup({node:t},e){t.number=++e.numCapturesToLeft,t.name&&e.groupsByName.get(t.name).get(t).hasDuplicateNameToRemove&&delete t.name},Regex:{exit({node:t},e){const n=Math.max(e.highestOrphanBackref-e.numCapturesToLeft,0);for(let s=0;s<n;s++){const r=xr();t.body.at(-1).body.push(r)}}},Subroutine({node:t},e){!t.isRecursive||t.ref===0||(t.ref=e.reffedNodesByReferencer.get(t).number)}};function Pr(t){Ge(t,{"*"({node:e,parent:n}){e.parent=n}})}function Ec(t,e){return t.dotAll===e.dotAll&&t.ignoreCase===e.ignoreCase}function xc(t,e){let n=e;do{if(n.type==="Regex")return!1;if(n.type==="Alternative")continue;if(n===t)return!1;const s=Fr(n.parent);for(const r of s){if(r===n)break;if(r===t||Ur(r,t))return!0}}while(n=n.parent);throw new Error("Unexpected path")}function Or(t,e,n,s){const r=Array.isArray(t)?[]:{};for(const[a,i]of Object.entries(t))a==="parent"?r.parent=Array.isArray(n)?s:n:i&&typeof i=="object"?r[a]=Or(i,e,r,n):(a==="type"&&i==="CapturingGroup"&&e.set(r,e.get(t)??t),r[a]=i);return r}function ws(t){const e=Br(t);return e.isRecursive=!0,e}function Dc(t,e){const n=[];for(;t=t.parent;)(!e||e(t))&&n.push(t);return n}function Ft(t,e){if(e.has(t))return e.get(t);const n=`$${e.size}_${t.replace(/^[^$_\p{IDS}]|[^$\u200C\u200D\p{IDC}]/ug,"_")}`;return e.set(t,n),n}function Gr(t){const e=["dotAll","ignoreCase"],n={enable:{},disable:{}};return t.forEach(({flags:s})=>{e.forEach(r=>{s.enable?.[r]&&(delete n.disable[r],n.enable[r]=!0),s.disable?.[r]&&(n.disable[r]=!0)})}),Object.keys(n.enable).length||delete n.enable,Object.keys(n.disable).length||delete n.disable,n.enable||n.disable?n:null}function Bc({dotAll:t,ignoreCase:e}){const n={};return(t||e)&&(n.enable={},t&&(n.enable.dotAll=!0),e&&(n.enable.ignoreCase=!0)),(!t||!e)&&(n.disable={},!t&&(n.disable.dotAll=!0),!e&&(n.disable.ignoreCase=!0)),n}function Fr(t){if(!t)throw new Error("Node expected");const{body:e}=t;return Array.isArray(e)?e:e?[e]:null}function jr(t){const e=t.find(n=>n.kind==="search_start"||$c(n,{negate:!1})||!Ic(n));if(!e)return null;if(e.kind==="search_start")return e;if(e.type==="LookaroundAssertion")return e.body[0].body[0];if(e.type==="CapturingGroup"||e.type==="Group"){const n=[];for(const s of e.body){const r=jr(s.body);if(!r)return null;Array.isArray(r)?n.push(...r):n.push(r)}return n}return null}function Ur(t,e){const n=Fr(t)??[];for(const s of n)if(s===e||Ur(s,e))return!0;return!1}function Ic({type:t}){return t==="Assertion"||t==="Directive"||t==="LookaroundAssertion"}function Rc(t){const e=["Character","CharacterClass","CharacterSet"];return e.includes(t.type)||t.type==="Quantifier"&&t.min&&e.includes(t.body.type)}function $c(t,e){const n={negate:null,...e};return t.type==="LookaroundAssertion"&&(n.negate===null||t.negate===n.negate)&&t.body.length===1&&Sr(t.body[0],{type:"Assertion",kind:"search_start"})}function jt(t){return/^[$_\p{IDS}][$\u200C\u200D\p{IDC}]*$/u.test(t)}function ne(t,e){const s=Er(t,{...e,unicodePropertyMap:Sn}).body;return s.length>1||s[0].body.length>1?X({body:s}):s[0].body[0]}function Ut(t,e){return t.negate=e,t}function oe(t,e){return t.parent=e,t}function R(t,e){return Pr(t),t.parent=e,t}function Lc(t,e){const n=Mr(e),s=cn(n.target,"ES2024"),r=cn(n.target,"ES2025"),a=n.rules.recursionLimit;if(!Number.isInteger(a)||a<2||a>20)throw new Error("Invalid recursionLimit; use 2-20");let i=null,c=null;if(!r){const f=[t.flags.ignoreCase];Ge(t,Mc,{getCurrentModI:()=>f.at(-1),popModI(){f.pop()},pushModI(d){f.push(d)},setHasCasedChar(){f.at(-1)?i=!0:c=!0}})}const l={dotAll:t.flags.dotAll,ignoreCase:!!((t.flags.ignoreCase||i)&&!c)};let u=t;const h={accuracy:n.accuracy,appliedGlobalFlags:l,captureMap:new Map,currentFlags:{dotAll:t.flags.dotAll,ignoreCase:t.flags.ignoreCase},inCharClass:!1,lastNode:u,originMap:t._originMap,recursionLimit:a,useAppliedIgnoreCase:!!(!r&&i&&c),useFlagMods:r,useFlagV:s,verbose:n.verbose};function p(f){return h.lastNode=u,u=f,dc(Tc[f.type],`Unexpected node type "${f.type}"`)(f,h,p)}const g={pattern:t.body.map(p).join("|"),flags:p(t.flags),options:{...t.options}};return s||(delete g.options.force.v,g.options.disable.v=!0,g.options.unicodeSetsPlugin=null),g._captureTransfers=new Map,g._hiddenCaptures=[],h.captureMap.forEach((f,d)=>{f.hidden&&g._hiddenCaptures.push(d),f.transferTo&&He(g._captureTransfers,f.transferTo,[]).push(d)}),g}var Mc={"*":{enter({node:t},e){if(_s(t)){const n=e.getCurrentModI();e.pushModI(t.flags?yt({ignoreCase:n},t.flags).ignoreCase:n)}},exit({node:t},e){_s(t)&&e.popModI()}},Backreference(t,e){e.setHasCasedChar()},Character({node:t},e){En(M(t.value))&&e.setHasCasedChar()},CharacterClassRange({node:t,skip:e},n){e(),zr(t,{firstOnly:!0}).length&&n.setHasCasedChar()},CharacterSet({node:t},e){t.kind==="property"&&Nr.has(t.value)&&e.setHasCasedChar()}},Tc={Alternative({body:t},e,n){return t.map(n).join("")},Assertion({kind:t,negate:e}){if(t==="string_end")return"$";if(t==="string_start")return"^";if(t==="word_boundary")return e?S`\B`:S`\b`;throw new Error(`Unexpected assertion kind "${t}"`)},Backreference({ref:t},e){if(typeof t!="number")throw new Error("Unexpected named backref in transformed AST");if(!e.useFlagMods&&e.accuracy==="strict"&&e.currentFlags.ignoreCase&&!e.captureMap.get(t).ignoreCase)throw new Error("Use of case-insensitive backref to case-sensitive group requires target ES2025 or non-strict accuracy");return"\\"+t},CapturingGroup(t,e,n){const{body:s,name:r,number:a}=t,i={ignoreCase:e.currentFlags.ignoreCase},c=e.originMap.get(t);return c&&(i.hidden=!0,a>c.number&&(i.transferTo=c.number)),e.captureMap.set(a,i),`(${r?`?<${r}>`:""}${s.map(n).join("|")})`},Character({value:t},e){const n=M(t),s=Ae(t,{escDigit:e.lastNode.type==="Backreference",inCharClass:e.inCharClass,useFlagV:e.useFlagV});if(s!==n)return s;if(e.useAppliedIgnoreCase&&e.currentFlags.ignoreCase&&En(n)){const r=Tr(n);return e.inCharClass?r.join(""):r.length>1?`[${r.join("")}]`:r[0]}return n},CharacterClass(t,e,n){const{kind:s,negate:r,parent:a}=t;let{body:i}=t;if(s==="intersection"&&!e.useFlagV)throw new Error("Use of class intersection requires min target ES2024");re.bugFlagVLiteralHyphenIsRange&&e.useFlagV&&i.some(As)&&(i=[_t(45),...i.filter(u=>!As(u))]);const c=()=>`[${r?"^":""}${i.map(n).join(s==="intersection"?"&&":"")}]`;if(!e.inCharClass){if((!e.useFlagV||re.bugNestedClassIgnoresNegation)&&!r){const h=i.filter(p=>p.type==="CharacterClass"&&p.kind==="union"&&p.negate);if(h.length){const p=X(),g=p.body[0];return p.parent=a,g.parent=p,i=i.filter(f=>!h.includes(f)),t.body=i,i.length?(t.parent=g,g.body.push(t)):p.body.pop(),h.forEach(f=>{const d=be({body:[f]});f.parent=d,d.parent=p,p.body.push(d)}),n(p)}}e.inCharClass=!0;const u=c();return e.inCharClass=!1,u}const l=i[0];if(s==="union"&&!r&&l&&((!e.useFlagV||!e.verbose)&&a.kind==="union"&&!(re.bugFlagVLiteralHyphenIsRange&&e.useFlagV)||!e.verbose&&a.kind==="intersection"&&i.length===1&&l.type!=="CharacterClassRange"))return i.map(n).join("");if(!e.useFlagV&&a.type==="CharacterClass")throw new Error("Use of nested character class requires min target ES2024");return c()},CharacterClassRange(t,e){const n=t.min.value,s=t.max.value,r={escDigit:!1,inCharClass:!0,useFlagV:e.useFlagV},a=Ae(n,r),i=Ae(s,r),c=new Set;if(e.useAppliedIgnoreCase&&e.currentFlags.ignoreCase){const l=zr(t);Fc(l).forEach(h=>{c.add(Array.isArray(h)?`${Ae(h[0],r)}-${Ae(h[1],r)}`:Ae(h,r))})}return`${a}-${i}${[...c].join("")}`},CharacterSet({kind:t,negate:e,value:n,key:s},r){if(t==="dot")return r.currentFlags.dotAll?r.appliedGlobalFlags.dotAll||r.useFlagMods?".":"[^]":S`[^\n]`;if(t==="digit")return e?S`\D`:S`\d`;if(t==="property"){if(r.useAppliedIgnoreCase&&r.currentFlags.ignoreCase&&Nr.has(n))throw new Error(`Unicode property "${n}" can't be case-insensitive when other chars have specific case`);return`${e?S`\P`:S`\p`}{${s?`${s}=`:""}${n}}`}if(t==="word")return e?S`\W`:S`\w`;throw new Error(`Unexpected character set kind "${t}"`)},Flags(t,e){return(e.appliedGlobalFlags.ignoreCase?"i":"")+(t.dotAll?"s":"")+(t.sticky?"y":"")},Group({atomic:t,body:e,flags:n,parent:s},r,a){const i=r.currentFlags;n&&(r.currentFlags=yt(i,n));const c=e.map(a).join("|"),l=!r.verbose&&e.length===1&&s.type!=="Quantifier"&&!t&&(!r.useFlagMods||!n)?c:`(?${jc(t,n,r.useFlagMods)}${c})`;return r.currentFlags=i,l},LookaroundAssertion({body:t,kind:e,negate:n},s,r){return`(?${`${e==="lookahead"?"":"<"}${n?"!":"="}`}${t.map(r).join("|")})`},Quantifier(t,e,n){return n(t.body)+Uc(t)},Subroutine({isRecursive:t,ref:e},n){if(!t)throw new Error("Unexpected non-recursive subroutine in transformed AST");const s=n.recursionLimit;return e===0?`(?R=${s})`:S`\g<${e}&R=${s}>`}},Nc=new Set(["$","(",")","*","+",".","?","[","\\","]","^","{","|","}"]),Pc=new Set(["-","\\","]","^","["]),Oc=new Set(["(",")","-","/","[","\\","]","^","{","|","}","!","#","$","%","&","*","+",",",".",":",";","<","=",">","?","@","`","~"]),Cs=new Map([[9,S`\t`],[10,S`\n`],[11,S`\v`],[12,S`\f`],[13,S`\r`],[8232,S`\u2028`],[8233,S`\u2029`],[65279,S`\uFEFF`]]),Gc=new RegExp("^\\p{Cased}$","u");function En(t){return Gc.test(t)}function zr(t,e){const n=!!e?.firstOnly,s=t.min.value,r=t.max.value,a=[];if(s<65&&(r===65535||r>=131071)||s===65536&&r>=131071)return a;for(let i=s;i<=r;i++){const c=M(i);if(!En(c))continue;const l=Tr(c).filter(u=>{const h=u.codePointAt(0);return h<s||h>r});if(l.length&&(a.push(...l),n))break}return a}function Ae(t,{escDigit:e,inCharClass:n,useFlagV:s}){if(Cs.has(t))return Cs.get(t);if(t<32||t>126&&t<160||t>262143||e&&zc(t))return t>255?`\\u{${t.toString(16).toUpperCase()}}`:`\\x${t.toString(16).toUpperCase().padStart(2,"0")}`;const r=n?s?Oc:Pc:Nc,a=M(t);return(r.has(a)?"\\":"")+a}function Fc(t){const e=t.map(r=>r.codePointAt(0)).sort((r,a)=>r-a),n=[];let s=null;for(let r=0;r<e.length;r++)e[r+1]===e[r]+1?s??=e[r]:s===null?n.push(e[r]):(n.push([s,e[r]]),s=null);return n}function jc(t,e,n){if(t)return">";let s="";if(e&&n){const{enable:r,disable:a}=e;s=(r?.ignoreCase?"i":"")+(r?.dotAll?"s":"")+(a?"-":"")+(a?.ignoreCase?"i":"")+(a?.dotAll?"s":"")}return`${s}:`}function Uc({kind:t,max:e,min:n}){let s;return!n&&e===1?s="?":!n&&e===1/0?s="*":n===1&&e===1/0?s="+":n===e?s=`{${n}}`:s=`{${n},${e===1/0?"":e}}`,s+{greedy:"",lazy:"?",possessive:"+"}[t]}function _s({type:t}){return t==="CapturingGroup"||t==="Group"||t==="LookaroundAssertion"}function zc(t){return t>47&&t<58}function As({type:t,value:e}){return t==="Character"&&e===45}var Wc=class un extends RegExp{#e=new Map;#t=null;#s;#n=null;#r=null;rawOptions={};get source(){return this.#s||"(?:)"}constructor(e,n,s){const r=!!s?.lazyCompile;if(e instanceof RegExp){if(s)throw new Error("Cannot provide options when copying a regexp");const a=e;super(a,n),this.#s=a.source,a instanceof un&&(this.#e=a.#e,this.#n=a.#n,this.#r=a.#r,this.rawOptions=a.rawOptions)}else{const a={hiddenCaptures:[],strategy:null,transfers:[],...s};super(r?"":e,n),this.#s=e,this.#e=qc(a.hiddenCaptures,a.transfers),this.#r=a.strategy,this.rawOptions=s??{}}r||(this.#t=this)}exec(e){if(!this.#t){const{lazyCompile:r,...a}=this.rawOptions;this.#t=new un(this.#s,this.flags,a)}const n=this.global||this.sticky,s=this.lastIndex;if(this.#r==="clip_search"&&n&&s){this.lastIndex=0;const r=this.#a(e.slice(s));return r&&(Hc(r,s,e,this.hasIndices),this.lastIndex+=s),r}return this.#a(e)}#a(e){this.#t.lastIndex=this.lastIndex;const n=super.exec.call(this.#t,e);if(this.lastIndex=this.#t.lastIndex,!n||!this.#e.size)return n;const s=[...n];n.length=1;let r;this.hasIndices&&(r=[...n.indices],n.indices.length=1);const a=[0];for(let i=1;i<s.length;i++){const{hidden:c,transferTo:l}=this.#e.get(i)??{};if(c?a.push(null):(a.push(n.length),n.push(s[i]),this.hasIndices&&n.indices.push(r[i])),l&&s[i]!==void 0){const u=a[l];if(!u)throw new Error(`Invalid capture transfer to "${u}"`);if(n[u]=s[i],this.hasIndices&&(n.indices[u]=r[i]),n.groups){this.#n||(this.#n=Vc(this.source));const h=this.#n.get(l);h&&(n.groups[h]=s[i],this.hasIndices&&(n.indices.groups[h]=r[i]))}}}return n}};function Hc(t,e,n,s){if(t.index+=e,t.input=n,s){const r=t.indices;for(let i=0;i<r.length;i++){const c=r[i];c&&(r[i]=[c[0]+e,c[1]+e])}const a=r.groups;a&&Object.keys(a).forEach(i=>{const c=a[i];c&&(a[i]=[c[0]+e,c[1]+e])})}}function qc(t,e){const n=new Map;for(const s of t)n.set(s,{hidden:!0});for(const[s,r]of e)for(const a of r)He(n,a,{}).transferTo=s;return n}function Vc(t){const e=/(?<capture>\((?:\?<(?![=!])(?<name>[^>]+)>|(?!\?)))|\\?./gsu,n=new Map;let s=0,r=0,a;for(;a=e.exec(t);){const{0:i,groups:{capture:c,name:l}}=a;i==="["?s++:s?i==="]"&&s--:c&&(r++,l&&n.set(r,l))}return n}function Kc(t,e){const n=Xc(t,e);return n.options?new Wc(n.pattern,n.flags,n.options):new RegExp(n.pattern,n.flags)}function Xc(t,e){const n=Mr(e),s=Er(t,{flags:n.flags,normalizeUnknownPropertyNames:!0,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline},skipBackrefValidation:n.rules.allowOrphanBackrefs,unicodePropertyMap:Sn}),r=_c(s,{accuracy:n.accuracy,asciiWordBoundaries:n.rules.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,bestEffortTarget:n.target}),a=Lc(r,n),i=hc(a.pattern,{captureTransfers:a._captureTransfers,hiddenCaptures:a._hiddenCaptures,mode:"external"}),c=cc(i.pattern),l=lc(c.pattern,{captureTransfers:i.captureTransfers,hiddenCaptures:i.hiddenCaptures}),u={pattern:l.pattern,flags:`${n.hasIndices?"d":""}${n.global?"g":""}${a.flags}${a.options.disable.v?"u":"v"}`};if(n.avoidSubclass){if(n.lazyCompileLength!==1/0)throw new Error("Lazy compilation requires subclass")}else{const h=l.hiddenCaptures.sort((d,k)=>d-k),p=Array.from(l.captureTransfers),g=r._strategy,f=u.pattern.length>=n.lazyCompileLength;(h.length||p.length||g||f)&&(u.options={...h.length&&{hiddenCaptures:h},...p.length&&{transfers:p},...g&&{strategy:g},...f&&{lazyCompile:f}})}return u}const vs=4294967295;class Qc{constructor(e,n={}){this.patterns=e,this.options=n;const{forgiving:s=!1,cache:r,regexConstructor:a}=n;if(!a)throw new Error("Option `regexConstructor` is not provided");this.regexps=e.map(i=>{if(typeof i!="string")return i;const c=r?.get(i);if(c){if(c instanceof RegExp)return c;if(s)return null;throw c}try{const l=a(i);return r?.set(i,l),l}catch(l){if(r?.set(i,l),s)return null;throw l}})}regexps;findNextMatchSync(e,n,s){const r=typeof e=="string"?e:e.content,a=[];function i(c,l,u=0){return{index:c,captureIndices:l.indices.map(h=>h==null?{start:vs,end:vs,length:0}:{start:h[0]+u,end:h[1]+u,length:h[1]-h[0]})}}for(let c=0;c<this.regexps.length;c++){const l=this.regexps[c];if(l)try{l.lastIndex=n;const u=l.exec(r);if(!u)continue;if(u.index===n)return i(c,u,0);a.push([c,u,0])}catch(u){if(this.options.forgiving)continue;throw u}}if(a.length){const c=Math.min(...a.map(l=>l[1].index));for(const[l,u,h]of a)if(u.index===c)return i(l,u,h)}return null}}function Zc(t,e){return Kc(t,{global:!0,hasIndices:!0,lazyCompileLength:3e3,rules:{allowOrphanBackrefs:!0,asciiWordBoundaries:!0,captureGroup:!0,recursionLimit:5,singleline:!0},...e})}function Jc(t={}){const e=Object.assign({target:"auto",cache:new Map},t);return e.regexConstructor||=n=>Zc(n,{target:e.target}),{createScanner(n){return new Qc(n,e)},createString(n){return{content:n}}}}const Wr=Kr("pinia",()=>{const t=qt(),e=kt(()=>Xr.value?"vitesse-dark":"vitesse-light");return typeof window<"u"&&pl({themes:[xt(()=>import("./vitesse-dark-D0r3Knsf.js"),[]),xt(()=>import("./vitesse-light-CVO1_9PV.js"),[])],langs:[xt(()=>import("./vue-CJls5BQS.js"),[])],engine:Jc()}).then(n=>{t.value=n}),{highlighter:t,theme:e}}),Hr=`<script>
import { defineComponent } from 'vue'

export default defineComponent({
  data: () => ({
    count: 1
  }),
  computed: {
    double() {
      return this.count * 2
    }
  },
})
<\/script>

<template>
  <p class="greeting">{{ count }} * 2 = {{ doubled }}</p>
</template>

<style>
.greeting {
  color: red;
  font-weight: bold;
}
</style>`,qr=`<script setup>
import { ref, computed } from 'vue'

const count = ref(1)
const double = computed(() => count.value * 2)
<\/script>

<template>
  <p class="greeting">{{ count }} = {{ doubled / 2 }}</p>
</template>

<style>
.greeting {
  color: red;
  font-weight: bold;
}
</style>`,Yc={key:0},eu=Fe({__name:"ShikiMagicMoveMatch",setup(t){const e=Wr(),n=qt(),s=qt(),r=at(null),a=at(!1),i=kt(()=>r.value?c(r.value):"none");function c(h){const p=n.value?.tokens.find(f=>f.key===h),g=s.value?.tokens.find(f=>f.key===h);return p&&g?"move":p?"leave":g?"enter":"none"}function l(h){if(h!==r.value&&!a.value)return"";const p=c(h);return p==="move"?"bg-blue:35 text-inherit!":p==="leave"?"bg-rose:35 text-inherit!":p==="enter"?"bg-green:35 text-inherit!":""}Is(()=>e.highlighter,h=>{if(!h)return;const p=Ts(g=>Ns(h,g,{lang:"vue",theme:e.theme}));n.value=p.commit(Hr).current,s.value=p.commit(qr).current});const u=Fe({props:{tokens:{type:Array,required:!0},title:{type:String}},setup(h){return()=>ce("pre",{class:"shiki border border-base relative",onMouseleave:()=>r.value=null},[Rs(h.tokens,p=>p.content===`
`?ce("br"):ce("span",{key:p.key,class:[l(p.key),"transition duration-300",a.value?"":"rounded-3px px0.5 mx--0.5"],"data-foo":p.key,style:[p.htmlStyle,{color:p.color}],onMouseenter:()=>r.value=p.key},p.content)),ce("div",{class:"absolute top-2 right-2 op50 z-10 text-sm font-sans pointer-events-none"},h.title||"Tokens")])}});return(h,p)=>(ye(),Pe(Qr,null,[o("ol",null,[o("li",{transition:"",class:H(x(i)!=="none"&&x(i)!=="move"?"op50":"")},[o("strong",{transition:"",class:H(x(i)==="move"||x(a)?"text-blue!":"")},"Move",2),p[2]||(p[2]=m(": The token exists in both before and after, so we just need to move it to the new position. "))],2),o("li",{transition:"",class:H(x(i)!=="none"&&x(i)!=="enter"?"op50":"")},[o("strong",{transition:"",class:H(x(i)==="enter"||x(a)?"text-green!":"")},"Enter",2),p[3]||(p[3]=m(": The token only exists in the ")),p[4]||(p[4]=o("strong",null,"after",-1)),p[5]||(p[5]=m(", we need to animate the element entering the scene. "))],2),o("li",{transition:"",class:H(x(i)!=="none"&&x(i)!=="leave"?"op50":"")},[o("strong",{transition:"",class:H(x(i)==="leave"||x(a)?"text-rose!":"")},"Leave",2),p[6]||(p[6]=m(": The token only exists in the ")),p[7]||(p[7]=o("strong",null,"before",-1)),p[8]||(p[8]=m(", we need to animate the element leaving the scene. "))],2)]),p[11]||(p[11]=o("p",null," Here is a playground for you to inspect the type of each token, hover over to inspect: ",-1)),x(n)&&x(s)?(ye(),Pe("div",Yc,[o("div",{grid:"~ cols-[max-content_1fr] gap-1 gap-x-3","text-sm":"",border:"x t base","rounded-t":"",px4:"",py3:"","ws-nowrap":"",onMouseenter:p[0]||(p[0]=g=>a.value=!0),onMouseleave:p[1]||(p[1]=g=>a.value=!1)},[p[9]||(p[9]=o("span",null,"Transition Type",-1)),o("div",null,[x(r)?(ye(),Pe("span",{key:0,class:H(["capitalize px1 rounded",l(x(r))])},Bn(c(x(r))),3)):Dn("",!0)]),p[10]||(p[10]=o("span",null,"Key",-1)),o("div",null,[o("span",{"font-mono":"",class:H(x(r)?"":"op50")},Bn(x(r)||x(a)?"(showing all tokens)":"(hover code to inspect)"),3)])],32),le(x(u),{tokens:x(n)?.tokens,title:"Before","important-rounded-none":"","important-my-0":"","important-bg-transparent":""},null,8,["tokens"]),le(x(u),{tokens:x(s)?.tokens,title:"After","important-rounded-t-none":"","important-mt-0":"","border-t-0":"","important-bg-transparent":""},null,8,["tokens"])])):Dn("",!0)],64))}}),Q="shiki-magic-move",zt=`${Q}-leave-from`,tu=`${Q}-leave-to`,Ss=`${Q}-leave-active`,Wt=`${Q}-enter-from`,Ht=`${Q}-enter-to`,Es=`${Q}-enter-active`,xs=`${Q}-move`,Ds=`${Q}-container-resize`,Bs=`${Q}-container-restyle`,nu={globalScale:1,duration:500,delayMove:.3,delayLeave:.1,delayEnter:.7,delayContainer:.4,stagger:0,easing:"ease",animateContainer:!0,containerStyle:!0};class su{mapDom=new Map;previousPromises=[];isFirstRender=!0;constructor(e,n={}){this.options={...nu,...n},typeof e=="string"?this.container=document.querySelector(e):this.container=e,this.anchor=document.createElement("span"),this.anchor.style.position="absolute",this.anchor.style.top="0",this.anchor.style.left="0",this.anchor.style.height="1px",this.anchor.style.width="1px",this.container.prepend(this.anchor)}applyElementContent(e,n){n.content!==`
`&&(e.textContent=n.content,e.classList.add(`${Q}-item`))}applyElementStyle(e,n){if(n.htmlStyle)if(typeof n.htmlStyle=="string")e.setAttribute("style",n.htmlStyle);else for(const[s,r]of Object.entries(n.htmlStyle))e.style.setProperty(s,r);n.htmlClass&&(e.className=[`${Q}-item`,n.htmlClass].join(" ")),n.color&&(e.style.color=n.color),n.bgColor&&(e.style.backgroundColor=n.bgColor)}applyElement(e,n){this.applyElementContent(e,n),this.applyElementStyle(e,n)}applyNodeStyle(e,n){if(n.bg&&(e.style.backgroundColor=n.bg),n.fg&&(e.style.color=n.fg),n.rootStyle){const s=n.rootStyle.split(";");for(const r of s){const[a,i]=r.split(":");a&&i&&e.style.setProperty(a.trim(),i.trim())}}}applyContainerStyle(e){this.options.containerStyle&&this.applyNodeStyle(this.container,e)}registerTransitionEnd(e,n){return()=>{let s=!1,r=()=>{};const a=Promise.race([Promise.allSettled(e.getAnimations().map(i=>i.finished)).then(()=>n()),new Promise(i=>{r=()=>{s||(s=!0,n(),i())}})]);return a.resolve=r,a}}setCssVariables(){this.container.style.setProperty("--smm-duration",`${this.options.duration}ms`),this.container.style.setProperty("--smm-delay-move",`${this.options.delayMove}`),this.container.style.setProperty("--smm-delay-leave",`${this.options.delayLeave}`),this.container.style.setProperty("--smm-delay-enter",`${this.options.delayEnter}`),this.container.style.setProperty("--smm-delay-container",`${this.options.delayContainer}`),this.container.style.setProperty("--smm-easing",this.options.easing),this.container.style.setProperty("--smm-stagger","0")}replace(e){const n=new Map,s=e.tokens.map(r=>{if(this.mapDom.has(r.key)){const a=this.mapDom.get(r.key);return this.applyElement(a,r),n.set(r.key,a),this.mapDom.delete(r.key),a}else{const a=document.createElement(r.content===`
`?"br":"span");return this.applyElement(a,r),n.set(r.key,a),a}});this.container.replaceChildren(this.anchor,...s),this.applyContainerStyle(e),this.mapDom=n}render(e){this.setCssVariables();const n=new Map,s=[],r=[],a=[],i=[];this.previousPromises.forEach(d=>d.resolve()),this.previousPromises=[];const c=[],{globalScale:l}=this.options,u=new Map;let h=this.anchor.getBoundingClientRect();const p=this.container.getBoundingClientRect();for(const d of this.mapDom.values()){const k=d.getBoundingClientRect();u.set(d,{x:k.x-h.x,y:k.y-h.y})}const g=e.tokens.map(d=>{if(this.mapDom.has(d.key)){const k=this.mapDom.get(d.key);return this.applyElementContent(k,d),c.push(()=>{this.applyElementStyle(k,d)}),s.push(k),n.set(d.key,k),this.mapDom.delete(d.key),k}else{const k=document.createElement(d.content===`
`?"br":"span");return this.applyElement(k,d),r.push(k),n.set(d.key,k),k}});for(const[d,k]of this.mapDom)k.tagName!=="BR"&&a.push(k);for(const d of a)d.style.position="absolute";if(this.container.replaceChildren(this.anchor,...g,...a),this.mapDom=n,a.forEach((d,k)=>{d.style.position="absolute";const w=u.get(d);d.style.top=`${w.y/l}px`,d.style.left=`${w.x/l}px`,this.options.stagger?d.style.setProperty("--smm-stagger",`${k*this.options.stagger}ms`):d.style.removeProperty("--smm-stagger"),d.classList.add(zt),d.classList.add(Ss),c.unshift(()=>{d.classList.remove(zt),d.classList.add(tu)}),i.push(this.registerTransitionEnd(d,()=>{d.classList.remove(zt),d.classList.remove(Ss),d.classList.remove(Ht),d.remove()}))}),this.isFirstRender||r.forEach((d,k)=>{d.classList.add(Wt),d.classList.add(Es),this.options.stagger?d.style.setProperty("--smm-stagger",`${k*this.options.stagger}ms`):d.style.removeProperty("--smm-stagger"),c.push(()=>{d.classList.remove(Wt),d.classList.add(Ht)}),i.push(this.registerTransitionEnd(d,()=>{d.classList.remove(Wt),d.classList.remove(Es),d.classList.remove(Ht)}))}),h=this.anchor.getBoundingClientRect(),s.forEach((d,k)=>{const w=d.getBoundingClientRect(),b={x:w.x-h.x,y:w.y-h.y},y=u.get(d);d.style.transitionDuration=d.style.transitionDelay="0ms";const _=(y.x-b.x)/l,A=(y.y-b.y)/l;d.style.transform=`translate(${_}px, ${A}px)`,this.options.stagger?d.style.setProperty("--smm-stagger",`${k*this.options.stagger}ms`):d.style.removeProperty("--smm-stagger"),c.unshift(()=>{d.classList.add(xs),d.style.transform=d.style.transitionDuration=d.style.transitionDelay=""}),i.push(this.registerTransitionEnd(d,()=>{d.classList.remove(xs)}))}),this.options.animateContainer&&!this.isFirstRender){const d=this.container.getBoundingClientRect();(d.width!==p.width||d.height!==p.height)&&(this.container.style.transitionDuration=this.container.style.transitionDelay="0ms",this.container.style.height=`${p.height/l}px`,this.container.style.width=`${p.width/l}px`,c.unshift(()=>{this.container.classList.add(Ds),this.container.style.transitionDuration=this.container.style.transitionDelay="",this.container.style.height=`${d.height/l}px`,this.container.style.width=`${d.width/l}px`}),i.push(this.registerTransitionEnd(this.container,()=>{this.container.classList.remove(Ds),this.container.style.height=this.container.style.width=""})))}this.options.containerStyle&&(this.isFirstRender?this.applyContainerStyle(e):(c.push(()=>{this.container.classList.add(Bs),this.applyContainerStyle(e)}),i.push(this.registerTransitionEnd(this.container,()=>{this.container.classList.remove(Bs)})))),ru(),c.forEach(d=>d());const f=i.map(d=>d());return this.isFirstRender=!1,this.previousPromises=f,Promise.all(f).then()}}function ru(){return document.body.offsetHeight}const au=Fe({name:"ShikiMagicMoveRenderer",props:{animate:{type:Boolean,default:!0},tokens:{type:Object,required:!0},previous:{type:Object,required:!1},options:{type:Object}},emits:["end","start"],setup(t,{emit:e}){const n=at();let s=!1;return $s(()=>{n.value.innerHTML="",s=!0;const r=new su(n.value);Is(()=>t.tokens,async a=>{if(Object.assign(r.options,t.options),t.animate){t.previous&&r.replace(t.previous),await In();const i=r.render(a);await In(),e("start"),await i,e("end")}else r.replace(a)},{immediate:!0})}),()=>ce("pre",{ref:n,class:"shiki-magic-move-container"},s?void 0:Rs(t.tokens.tokens,r=>r.content===`
`?ce("br",{key:r.key}):ce("span",{style:[{color:r.color},r.htmlStyle],class:["shiki-magic-move-item",r.htmlClass],key:r.key},r.content)))}}),iu=Fe({name:"ShikiMagicMove",props:{highlighter:{type:Object,required:!0},lang:{type:String,required:!0},theme:{type:String,required:!0},code:{type:String,required:!0},options:{type:Object,default:()=>({})}},emits:["start","end"],setup(t,{emit:e}){const n=Ts(r=>Ns(t.highlighter,r,{lang:t.lang,theme:t.theme},t.options.lineNumbers),t.options),s=kt(()=>n.commit(t.code));return()=>ce(au,{tokens:s.value.current,options:t.options,previous:s.value.previous,onStart:()=>e("start"),onEnd:()=>e("end")})}}),ou={flex:"~",py2:"","mb--2":"","mt--2":""},lu={key:1,class:"font-mono h-95 important-p4 border border-base important-rounded-b-none important-bg-transparent flex items-center justify-center"},cu=Fe({__name:"ShikiMagicMoveDemo",setup(t){const e=at(1),n=kt(()=>e.value===1?Hr:qr);let s=null;function r(){s&&(clearInterval(s),s=null)}const a=Wr();return $s(()=>{s=setInterval(()=>{e.value=e.value===1?2:1},3e3)}),(i,c)=>(ye(),Pe("div",null,[o("div",ou,[o("div",{"flex-1":"","border-b":"","mb--1px":"",class:H(x(e)!==1?"border-base":"border-transparent")},[o("button",{"w-full":"","border-x":"","border-t":"","border-base":"","rounded-t":"",px2:"",py1:"",transition:"","duration-300":"",class:H(x(e)===1?"bg-base":"bg-gray:5 op25 hover:op75"),onClick:c[0]||(c[0]=l=>{e.value=1,r()})}," Options API ",2)],2),o("div",{"flex-1":"","border-b":"","mb--1px":"",class:H(x(e)!==2?"border-base":"border-transparent")},[o("button",{"w-full":"","border-x":"","border-t":"","border-base":"","rounded-t":"",px2:"",py1:"",transition:"","duration-300":"",class:H(x(e)===2?"bg-base":"bg-gray:5 op25 hover:op75"),onClick:c[1]||(c[1]=l=>{e.value=2,r()})}," Composition API ",2)],2)]),x(a).highlighter?(ye(),Ls(x(iu),{key:0,highlighter:x(a).highlighter,code:x(n),lang:"vue",theme:x(a).theme,options:{duration:800,animateContainer:!1,stagger:3},class:"font-mono h-112 important-p4 border-x border-b border-base important-rounded-t-none important-bg-transparent",style:{"scrollbar-gutter":"stable"}},null,8,["highlighter","code","theme"])):(ye(),Pe("div",lu," Loading... "))]))}}),uu={class:"prose m-auto slide-enter-content"},bu={__name:"shiki-magic-move",setup(t){const e={title:"The Magic in Shiki Magic Move",date:"2024-03-04T00:00:00.000Z",lang:"en",duration:"15min",description:"The methodology behind Shiki Magic Move.",image:"https://romanmerk.me/og/shiki-magic-move.png",meta:[{property:"og:title",content:"The Magic in Shiki Magic Move"},{name:"twitter:title",content:"The Magic in Shiki Magic Move"},{name:"description",content:"The methodology behind Shiki Magic Move."},{property:"og:description",content:"The methodology behind Shiki Magic Move."},{name:"twitter:description",content:"The methodology behind Shiki Magic Move."},{property:"og:image",content:"https://romanmerk.me/og/shiki-magic-move.png"},{name:"twitter:image",content:"https://romanmerk.me/og/shiki-magic-move.png"},{name:"twitter:card",content:"summary_large_image"}]};return Zr({title:"The Magic in Shiki Magic Move",meta:[{property:"og:title",content:"The Magic in Shiki Magic Move"},{name:"twitter:title",content:"The Magic in Shiki Magic Move"},{name:"description",content:"The methodology behind Shiki Magic Move."},{property:"og:description",content:"The methodology behind Shiki Magic Move."},{name:"twitter:description",content:"The methodology behind Shiki Magic Move."},{property:"og:image",content:"https://romanmerk.me/og/shiki-magic-move.png"},{name:"twitter:image",content:"https://romanmerk.me/og/shiki-magic-move.png"},{name:"twitter:card",content:"summary_large_image"}]}),(s,r)=>{const a=cu,i=Yr,c=Jr,l=eu,u=Vr;return ye(),Ls(u,{frontmatter:e},{default:Dt(()=>[o("div",uu,[r[8]||(r[8]=o("div",{class:"table-of-contents"},[o("div",{class:"table-of-contents-anchor"},[o("div",{class:"i-ri-menu-2-fill"})]),o("ul",null,[o("li",null,[o("a",{href:"#how-it-works"},"How it works ")]),o("li",null,[o("a",{href:"#transitions"},"Transitions "),o("ul",null,[o("li",null,[o("a",{href:"#enter-transition"},"Enter Transition ")]),o("li",null,[o("a",{href:"#leave-transition"},"Leave Transition ")]),o("li",null,[o("a",{href:"#move-transition"},"Move Transition ")])])]),o("li",null,[o("a",{href:"#integrations"},"Integrations ")])])],-1)),le(a),r[9]||(r[9]=o("p",null,[o("a",{href:"https://support.apple.com/guide/keynote/add-transitions-tanff5ae749e/mac",target:"_blank",rel:"noopener"},"Magic Move is a feature for transition in Keynote"),m(", or it’s called "),o("a",{href:"https://support.microsoft.com/en-us/office/use-the-morph-transition-in-powerpoint-8dd1c7b2-b935-44f5-a74c-741d8d9244ea",target:"_blank",rel:"noopener"},"Morph Transition in PowerPoint"),m(", and it automatically animates the transitions for objects between slides. It is quite impressive, very intuitive and effortless to use, and can be applied to various types of objects. Like you can paste a highlighted code block, or make another in a second slide, Magic Move will do the transition as granular to the tokens level for you.")],-1)),r[10]||(r[10]=o("p",null,[m("The only annoying part of this process is that Keynote does not support code highlighting - so you need to highlight the code somewhere and paste them manually "),o("strong",null,"every single time"),m(". This is one of the reasons I made "),o("a",{href:"https://sli.dev/",target:"_blank",rel:"noopener"},"Slidev"),m(" - to have first-class tooling for developers to make presentations easier. While moving to web technologies with Slidev opens up almost infinite possibilities, on the other hand, it also makes some nice cool features in Keynote and PowerPoint harder to achieve (you need to write quite some extra code) - for example, the Magic Move.")],-1)),r[11]||(r[11]=o("p",null,[m("Browsers’ new "),o("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API",target:"_blank",rel:"noopener"},"View Transitions API"),m(" makes morphing between elements a lot easier, only that it requires some manual work to assign keys to make the pairs. While it’s rather ok to do for a few big elements, doing such manually for every single token in a code block is basically unacceptable.")],-1)),r[12]||(r[12]=o("p",null,[m("Roughly a year ago, "),o("a",{href:"https://github.com/posva",target:"_blank",rel:"noopener"},"Eduardo @posva"),m(" and I came up with the idea of using Shiki combined with Vue’s "),o("a",{href:"https://vuejs.org/guide/built-ins/transition-group",target:"_blank",rel:"noopener"},[o("code",null,"<TransitionGroup>")]),m(" to achieve a similar effect for code blocks:")],-1)),le(i,{"h-650px":""},{default:Dt(()=>r[0]||(r[0]=[o("p",{lang:"en",dir:"ltr"},[m("Do you like Magic Move in Keynote for code?"),o("a",{href:"https://twitter.com/antfu7?ref_src=twsrc%5Etfw"},"@antfu7"),m(" and I are cooking something 😎 "),o("a",{href:"https://t.co/9JxjCzRA1S"},"pic.twitter.com/9JxjCzRA1S")],-1),m("— Eduardo.𝚟𝚞𝚎 (@posva) "),o("a",{href:"https://twitter.com/posva/status/1619083357756821504?ref_src=twsrc%5Etfw"},"January 27, 2023",-1)])),_:1,__:[0]}),r[13]||(r[13]=o("p",null,[m("We managed to make the proof of concept work, as shown in the video. However, due to some hard edge cases, both of us were busy with other things, and we didn’t manage to make it a usable library at that time. It has come to our discussions from time to time but we didn’t come up with a good solution. Until one day, a few weeks ago while I was preparing my slides, my "),o("a",{href:"https://lmddgtfy.net/?q=Productive%20Procrastination",target:"_blank",rel:"noopener"},[o("s",null,"productive"),m(" procrastination")]),m(" kicked in and I decided to give it another try to "),o("s",null,"escape from my slides"),m(".")],-1)),r[14]||(r[14]=o("p",null,"And luck me, I found a quite nice approach and made it happen:",-1)),le(i,{"h-670px":""},{default:Dt(()=>r[1]||(r[1]=[o("p",{lang:"en",dir:"ltr"},[m("The procrastination in preparing talks drove me to bring up the rework of the idea we had last year with "),o("a",{href:"https://twitter.com/posva?ref_src=twsrc%5Etfw"},"@posva"),m(" - animate Shiki tokens like Magic Move! 🪄"),o("br"),o("br"),m("Found a much more reliable approach that could finally come out as a library (soon)"),o("a",{href:"https://t.co/b5SgQtTw2s"},"https://t.co/b5SgQtTw2s"),m(),o("a",{href:"https://t.co/s5LutlYmAK"},"pic.twitter.com/s5LutlYmAK")],-1),m("— Roman Merkulov (@antfu7) "),o("a",{href:"https://twitter.com/antfu7/status/1760751386122211371?ref_src=twsrc%5Etfw"},"February 22, 2024",-1)])),_:1,__:[1]}),o("p",null,[r[2]||(r[2]=m("Made ")),r[3]||(r[3]=o("a",{href:"https://shiki-magic-move.netlify.app/",target:"_blank",rel:"noopener"},"a playground",-1)),r[4]||(r[4]=m(" where you can try it out yourself, and you can find the source code at ")),le(c,{repo:"shikijs/shiki-magic-move"}),r[5]||(r[5]=m("."))]),r[15]||(r[15]=o("p",null,"So today here, let’s break it down and see how it works.",-1)),r[16]||(r[16]=o("h2",{id:"how-it-works",tabindex:"-1"},[m("How it works "),o("a",{class:"header-anchor",href:"#how-it-works","aria-hidden":"true"},"#")],-1)),r[17]||(r[17]=o("p",null,[m("To get started, we could see each word in the code with different colors as a token (they are "),o("code",null,"<span>"),m(" elements in practice). Basically, we can consider them as a set of small objects that we want to animate individually.")],-1)),r[18]||(r[18]=o("p",null,"To break done the animations of Magic Move, we see we are basically trying to find connections between two sets of objects and animate them from one to another. Different from 1-to-1 transitions, here we expect the code before and after to be different, which means we could categorize the type of transitions into 3 categories:",-1)),le(l),r[19]||(r[19]=o("p",null,[m("In the playground above, we assign a key to each token. "),o("code",null,"Move"),m(' tokens come with pairs, so we assign the same key to make the "connection".')],-1)),r[20]||(r[20]=o("p",null,[m("When doing highlighting, "),o("a",{href:"https://github.com/shikijs/shiki",target:"_blank",rel:"noopener"},"Shiki"),m(" turns the input code into an array of tokens. We can run Shiki twice for code before and after to get two collections of tokens. It should be fairly simple to find the "),o("code",null,"Enter"),m(" and "),o("code",null,"Leave"),m(" tokens by running two loops to compare the two collections. However, the challenge is to find good pairs of "),o("code",null,"Move"),m(" tokens. If we only pair them by the content of each token, it would be the case that 1-to-many or many-to-1 might make the pair transition off.")],-1)),r[21]||(r[21]=o("p",null,[m("I came up with the idea of using a text diff algorithm to find the chunks of the code that are matched between the two versions. I ended up using Google’s "),o("a",{href:"https://github.com/google/diff-match-patch",target:"_blank",rel:"noopener"},"Diff Match Patch"),m(" (I later refactored it into ESM as "),o("a",{href:"https://github.com/antfu/diff-match-patch-es",target:"_blank",rel:"noopener"},[o("code",null,"diff-match-patch-es")]),m(") to achieve this. With the diff result, we can now "),o("a",{href:"https://github.com/shikijs/shiki-magic-move/blob/e409aa5cf877a4005cf2b01729f1113beb405d13/src/core.ts#L226-L256",target:"_blank",rel:"noopener"},"reliably find the pairs"),m(" of the "),o("code",null,"Move"),m(" tokens without worrying that tokens might travel to the wrong place.")],-1)),r[22]||(r[22]=o("p",null,[m("With this core logic in place, we can generate the correct keys for each token for the connection. This made the rest of the task clear, we just needed to apply different transitions to different types of tokens. We could feed them into any key-based transition library, for example, Vue provides a built-in "),o("a",{href:"https://vuejs.org/guide/built-ins/transition-group",target:"_blank",rel:"noopener"},[o("code",null,"<TransitionGroup>"),m(" component")]),m(" that does the job perfectly, "),o("a",{href:"https://vuejs.org/examples/#list-transition",target:"_blank",rel:"noopener"},"live example"),m(".")],-1)),r[23]||(r[23]=o("h2",{id:"transitions",tabindex:"-1"},[m("Transitions "),o("a",{class:"header-anchor",href:"#transitions","aria-hidden":"true"},"#")],-1)),r[24]||(r[24]=o("p",null,[m("While Vue’s "),o("code",null,"<TransitionGroup>"),m(" should get the transition done automatically, it’s actually a bit tricky to do in our specific case. The main reason is that the token elements in the code are "),o("code",null,"<span>"),m(" that rely on browsers’ layout engine to calculate the position. During the transition, we want to make each token positioned absolutely to avoid messing up the layout. This means we need to record the position of each token with "),o("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect",target:"_blank",rel:"noopener"},[o("code",null,"getBoundingClientRect()")]),m(" before the transition starts, apply the absolute position to them during transitions, and then restore to the inline layout after the transition ends.")],-1)),r[25]||(r[25]=o("p",null,[m("Ran into some limitations of "),o("code",null,"<TransitionGroup>"),m(" and also with the wish to have this a framework-agnostic solution, I ended up writing "),o("a",{href:"https://github.com/shikijs/shiki-magic-move/blob/5ec48554d87b4f4e2dd2e15f27ef9e51ef00074b/src/renderer.ts#L28",target:"_blank",rel:"noopener"},"a custom renderer"),m(" to do that, referencing a lot of the code from "),o("code",null,"<TransitionGroup>"),m(".")],-1)),r[26]||(r[26]=o("p",null,[m("Because we are relying on the browsers’ layout engine to calculate the position, we need to get the destination position of each token (the position of the final code) before the transition starts. I found this trick in Vue’s code to "),o("a",{href:"https://github.com/vuejs/core/blob/f66a75ea75c8aece065b61e2126b4c5b2338aa6e/packages/runtime-dom/src/components/TransitionGroup.ts#L77-L78",target:"_blank",rel:"noopener"},"force layout reflow"),m(" combined with temporary setting "),o("a",{href:"https://github.com/vuejs/core/blob/f66a75ea75c8aece065b61e2126b4c5b2338aa6e/packages/runtime-dom/src/components/TransitionGroup.ts#L186-L187",target:"_blank",rel:"noopener"},"transition duration to 0"),m(" to get the new position immediately so we could start animating.")],-1)),r[27]||(r[27]=o("p",null,"Then it comes to do the transitions for different types of tokens:",-1)),r[28]||(r[28]=o("h3",{id:"enter-transition",tabindex:"-1"},[m("Enter Transition "),o("a",{class:"header-anchor",href:"#enter-transition","aria-hidden":"true"},"#")],-1)),r[29]||(r[29]=o("p",null,"The enter transition is the most straightforward one. Because the token will stay at the destination position after the transition, we don’t need to do anything with the positioning. We usually just need to apply the opacity transition to make it appear. Here we add/remove classes for users to apply the transition with CSS.",-1)),r[30]||(r[30]=o("p",null,"Pseudo-code below:",-1)),r[31]||(r[31]=o("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[o("code",{class:"language-ts"},[o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," enterElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-enter"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-enter-from"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Replace the children of the container with")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// elements from the new code")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"container"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"replaceChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(..."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Force layout reflow")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"forceReflow"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"()")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," enterElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"remove"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-enter-from"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-enter-to"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Here the transition starts")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// from `.transition-enter-from` to `.transition-enter-to`")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," enterElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Transition Finished")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"addEventListener"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transitionend"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"remove"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-enter-to"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),r[32]||(r[32]=o("p",null,[o("a",{href:"https://github.com/shikijs/shiki-magic-move/blob/5ec48554d87b4f4e2dd2e15f27ef9e51ef00074b/src/renderer.ts#L233-L249",target:"_blank",rel:"noopener"},"[actual source code]")],-1)),r[33]||(r[33]=o("h3",{id:"leave-transition",tabindex:"-1"},[m("Leave Transition "),o("a",{class:"header-anchor",href:"#leave-transition","aria-hidden":"true"},"#")],-1)),r[34]||(r[34]=o("p",null,[m('Since "Leave" tokens eventually disappear after the transition, we need to keep them in the DOM tree for a while for animations but we don’t want them to participate in the layout. We can apply '),o("code",null,"position: absolute"),m(" to them and set the "),o("code",null,"top"),m(" and "),o("code",null,"left"),m(" to the original position to make them stay in place. Then we can apply the opacity transition to make them disappear.")],-1)),r[35]||(r[35]=o("p",null,"Pseudo-code below:",-1)),r[36]||(r[36]=o("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[o("code",{class:"language-ts"},[o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," leaveElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Get the position of the token stored before")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"pos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," position"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"get"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"!")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Set absolute position")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"position"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"absolute"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"top"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," `"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"${"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"pos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"y"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"}"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"px"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"`")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"left"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," `"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"${"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"pos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"x"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"}"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"px"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"`")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-leave"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-leave-from"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Replace the children of the container")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Same as the enter transition")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"container"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"replaceChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(..."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"forceReflow"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"()")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," enterElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"remove"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-leave-from"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-leave-to"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," enterElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"addEventListener"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transitionend"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"remove"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-leave-to"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),r[37]||(r[37]=o("p",null,[o("a",{href:"https://github.com/shikijs/shiki-magic-move/blob/5ec48554d87b4f4e2dd2e15f27ef9e51ef00074b/src/renderer.ts#L206-L229",target:"_blank",rel:"noopener"},"[actual source code]")],-1)),r[38]||(r[38]=o("h3",{id:"move-transition",tabindex:"-1"},[m("Move Transition "),o("a",{class:"header-anchor",href:"#move-transition","aria-hidden":"true"},"#")],-1)),r[39]||(r[39]=o("p",null,[m('To animate "Move" tokens requires a bit more work. We use a technique called '),o("a",{href:"https://aerotwist.com/blog/flip-your-animations/",target:"_blank",rel:"noopener"},'"FLIP"'),m(" (First, Last, Invert, Play) to make the transition smooth. We need to record the position of each token before the transition starts, then apply the absolute position to them during the transition, and then restore it to the inline layout after the transition ends.")],-1)),r[40]||(r[40]=o("p",null,[m("It’s a bit unintuitive to understand at first, but luckily "),o("a",{href:"https://css-tricks.com/author/davidkpiano/",target:"_blank",rel:"noopener"},"David Khourshid"),m(" made a great explanation at "),o("a",{href:"https://css-tricks.com/animating-layouts-with-the-flip-technique/",target:"_blank",rel:"noopener"},"Animating Layouts with the FLIP Technique"),m(", definitely worth reading!")],-1)),r[41]||(r[41]=o("p",null,"Pseudo-code below:",-1)),r[42]||(r[42]=o("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light",style:{"--s-dark":"#dbd7caee","--s-light":"#393a34","--s-dark-bg":"#121212","--s-light-bg":"#ffffff"},tabindex:"0"},[o("code",{class:"language-ts"},[o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," moveElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"getBoundingClientRect"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"()")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"oldPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," position"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"get"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"!")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"dx"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," oldPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"x"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," - "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"x")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"  const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"dy"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," oldPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"y"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," - "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newPos"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"y")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Set duration to 0 to get the new position immediately")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transitionDuration"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"0ms"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transitionDelay"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," '"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"0ms"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Transform new elements to the old position")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transform"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," `"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"translate("),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"${"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"dx"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"}"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"px, "),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"${"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"dy"),o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"}"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"px)"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"`")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"// Replace the children of the container")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"container"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"replaceChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"(..."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"newChildren"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"forceReflow"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"()")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," moveElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // Remove transform overrides,")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#758575DD","--s-light":"#A0ADA0"}},"  // so it will start animating back to the new position")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"add"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-move"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transform"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," ''")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transitionDuration"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," ''")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"style"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"transitionDelay"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ="),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}}," ''")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")]),m(`
`),o("span",{class:"line"}),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#4D9375","--s-light":"#1E754F"}},"for"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ("),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}},"const "),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"el"),o("span",{style:{"--s-dark":"#CB7676","--s-light":"#AB5959"}}," of"),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}}," moveElements"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"  el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"addEventListener"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transitionend"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},","),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," ()"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," =>"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}}," {")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"    el"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#BD976A","--s-light":"#B07D48"}},"classList"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"."),o("span",{style:{"--s-dark":"#80A665","--s-light":"#59873A"}},"remove"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"("),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#C98A7D","--s-light":"#B56959"}},"transition-move"),o("span",{style:{"--s-dark":"#C98A7D77","--s-light":"#B5695977"}},"'"),o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},")")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"  })")]),m(`
`),o("span",{class:"line"},[o("span",{style:{"--s-dark":"#666666","--s-light":"#999999"}},"}")])])],-1)),r[43]||(r[43]=o("p",null,[o("a",{href:"https://github.com/shikijs/shiki-magic-move/blob/5ec48554d87b4f4e2dd2e15f27ef9e51ef00074b/src/renderer.ts#L254-L276",target:"_blank",rel:"noopener"},"[actual source code]")],-1)),r[44]||(r[44]=o("h2",{id:"integrations",tabindex:"-1"},[m("Integrations "),o("a",{class:"header-anchor",href:"#integrations","aria-hidden":"true"},"#")],-1)),o("p",null,[r[6]||(r[6]=m("Shiki Magic Move is open-sourced at ")),le(c,{repo:"shikijs/shiki-magic-move"}),r[7]||(r[7]=m(". The core logic is pretty lightweight and framework-agnostic, despite that the library is a bit low-level. Currently, I only have the bandwidth to make a Vue wrapper for it, and I am counting on you to contribute and add more first-class integrations for other frameworks as well as higher-level integrations."))]),r[45]||(r[45]=o("p",null,[m("If you are using "),o("a",{href:"https://sli.dev/",target:"_blank",rel:"noopener"},"Slidev"),m(", you can "),o("a",{href:"https://sli.dev/guide/syntax#shiki-magic-move",target:"_blank",rel:"noopener"},"try it today"),m(" to enhance your slides with Magic!")],-1)),r[46]||(r[46]=o("p",null,"Hope you enjoy it, happy hacking!",-1))])]),_:1})}}};export{bu as default};
